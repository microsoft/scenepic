// 1.1.2

(()=>{var Is=Object.create;var Tr=Object.defineProperty;var Bs=Object.getOwnPropertyDescriptor;var Ls=Object.getOwnPropertyNames;var Ds=Object.getPrototypeOf,Fs=Object.prototype.hasOwnProperty;var Bt=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var _e=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Lt=(e,t)=>{for(var r in t)Tr(e,r,{get:t[r],enumerable:!0})},Os=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Ls(t))!Fs.call(e,a)&&a!==r&&Tr(e,a,{get:()=>t[a],enumerable:!(i=Bs(t,a))||i.enumerable});return e};var Pr=(e,t,r)=>(r=e!=null?Is(Ds(e)):{},Os(t||!e||!e.__esModule?Tr(r,"default",{value:e,enumerable:!0}):r,e));var je=_e(Se=>{"use strict";var ec=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function tc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}Se.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(var i in r)tc(r,i)&&(e[i]=r[i])}}return e};Se.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var rc={arraySet:function(e,t,r,i,a){if(t.subarray&&e.subarray){e.set(t.subarray(r,r+i),a);return}for(var n=0;n<i;n++)e[a+n]=t[r+n]},flattenChunks:function(e){var t,r,i,a,n,s;for(i=0,t=0,r=e.length;t<r;t++)i+=e[t].length;for(s=new Uint8Array(i),a=0,t=0,r=e.length;t<r;t++)n=e[t],s.set(n,a),a+=n.length;return s}},ic={arraySet:function(e,t,r,i,a){for(var n=0;n<i;n++)e[a+n]=t[r+n]},flattenChunks:function(e){return[].concat.apply([],e)}};Se.setTyped=function(e){e?(Se.Buf8=Uint8Array,Se.Buf16=Uint16Array,Se.Buf32=Int32Array,Se.assign(Se,rc)):(Se.Buf8=Array,Se.Buf16=Array,Se.Buf32=Array,Se.assign(Se,ic))};Se.setTyped(ec)});var Xa=_e(xt=>{"use strict";var ac=je(),nc=4,Ma=0,Ta=1,sc=2;function bt(e){for(var t=e.length;--t>=0;)e[t]=0}var oc=0,Da=1,lc=2,hc=3,cc=258,Wr=29,Gt=256,zt=Gt+1+Wr,gt=30,Vr=19,Fa=2*zt+1,nt=15,Or=16,fc=7,jr=256,Oa=16,za=17,Na=18,Hr=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],lr=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],dc=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ua=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],uc=512,Ze=new Array((zt+2)*2);bt(Ze);var Ot=new Array(gt*2);bt(Ot);var Nt=new Array(uc);bt(Nt);var Ut=new Array(cc-hc+1);bt(Ut);var Zr=new Array(Wr);bt(Zr);var hr=new Array(gt);bt(hr);function zr(e,t,r,i,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=a,this.has_stree=e&&e.length}var Ha,Ga,Wa;function Nr(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function Va(e){return e<256?Nt[e]:Nt[256+(e>>>7)]}function Ht(e,t){e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255}function Ee(e,t,r){e.bi_valid>Or-r?(e.bi_buf|=t<<e.bi_valid&65535,Ht(e,e.bi_buf),e.bi_buf=t>>Or-e.bi_valid,e.bi_valid+=r-Or):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function ze(e,t,r){Ee(e,r[t*2],r[t*2+1])}function ja(e,t){var r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1}function pc(e){e.bi_valid===16?(Ht(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function vc(e,t){var r=t.dyn_tree,i=t.max_code,a=t.stat_desc.static_tree,n=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,c=t.stat_desc.max_length,l,h,d,u,f,v,p=0;for(u=0;u<=nt;u++)e.bl_count[u]=0;for(r[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<Fa;l++)h=e.heap[l],u=r[r[h*2+1]*2+1]+1,u>c&&(u=c,p++),r[h*2+1]=u,!(h>i)&&(e.bl_count[u]++,f=0,h>=o&&(f=s[h-o]),v=r[h*2],e.opt_len+=v*(u+f),n&&(e.static_len+=v*(a[h*2+1]+f)));if(p!==0){do{for(u=c-1;e.bl_count[u]===0;)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[c]--,p-=2}while(p>0);for(u=c;u!==0;u--)for(h=e.bl_count[u];h!==0;)d=e.heap[--l],!(d>i)&&(r[d*2+1]!==u&&(e.opt_len+=(u-r[d*2+1])*r[d*2],r[d*2+1]=u),h--)}}function Za(e,t,r){var i=new Array(nt+1),a=0,n,s;for(n=1;n<=nt;n++)i[n]=a=a+r[n-1]<<1;for(s=0;s<=t;s++){var o=e[s*2+1];o!==0&&(e[s*2]=ja(i[o]++,o))}}function mc(){var e,t,r,i,a,n=new Array(nt+1);for(r=0,i=0;i<Wr-1;i++)for(Zr[i]=r,e=0;e<1<<Hr[i];e++)Ut[r++]=i;for(Ut[r-1]=i,a=0,i=0;i<16;i++)for(hr[i]=a,e=0;e<1<<lr[i];e++)Nt[a++]=i;for(a>>=7;i<gt;i++)for(hr[i]=a<<7,e=0;e<1<<lr[i]-7;e++)Nt[256+a++]=i;for(t=0;t<=nt;t++)n[t]=0;for(e=0;e<=143;)Ze[e*2+1]=8,e++,n[8]++;for(;e<=255;)Ze[e*2+1]=9,e++,n[9]++;for(;e<=279;)Ze[e*2+1]=7,e++,n[7]++;for(;e<=287;)Ze[e*2+1]=8,e++,n[8]++;for(Za(Ze,zt+1,n),e=0;e<gt;e++)Ot[e*2+1]=5,Ot[e*2]=ja(e,5);Ha=new zr(Ze,Hr,Gt+1,zt,nt),Ga=new zr(Ot,lr,0,gt,nt),Wa=new zr(new Array(0),dc,0,Vr,fc)}function Ya(e){var t;for(t=0;t<zt;t++)e.dyn_ltree[t*2]=0;for(t=0;t<gt;t++)e.dyn_dtree[t*2]=0;for(t=0;t<Vr;t++)e.bl_tree[t*2]=0;e.dyn_ltree[jr*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function qa(e){e.bi_valid>8?Ht(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function gc(e,t,r,i){qa(e),i&&(Ht(e,r),Ht(e,~r)),ac.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}function Pa(e,t,r,i){var a=t*2,n=r*2;return e[a]<e[n]||e[a]===e[n]&&i[t]<=i[r]}function Ur(e,t,r){for(var i=e.heap[r],a=r<<1;a<=e.heap_len&&(a<e.heap_len&&Pa(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!Pa(t,i,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=i}function Ra(e,t,r){var i,a,n=0,s,o;if(e.last_lit!==0)do i=e.pending_buf[e.d_buf+n*2]<<8|e.pending_buf[e.d_buf+n*2+1],a=e.pending_buf[e.l_buf+n],n++,i===0?ze(e,a,t):(s=Ut[a],ze(e,s+Gt+1,t),o=Hr[s],o!==0&&(a-=Zr[s],Ee(e,a,o)),i--,s=Va(i),ze(e,s,r),o=lr[s],o!==0&&(i-=hr[s],Ee(e,i,o)));while(n<e.last_lit);ze(e,jr,t)}function Gr(e,t){var r=t.dyn_tree,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,n=t.stat_desc.elems,s,o,c=-1,l;for(e.heap_len=0,e.heap_max=Fa,s=0;s<n;s++)r[s*2]!==0?(e.heap[++e.heap_len]=c=s,e.depth[s]=0):r[s*2+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,r[l*2]=1,e.depth[l]=0,e.opt_len--,a&&(e.static_len-=i[l*2+1]);for(t.max_code=c,s=e.heap_len>>1;s>=1;s--)Ur(e,r,s);l=n;do s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Ur(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,r[l*2]=r[s*2]+r[o*2],e.depth[l]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,r[s*2+1]=r[o*2+1]=l,e.heap[1]=l++,Ur(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],vc(e,t),Za(r,c,e.bl_count)}function Ia(e,t,r){var i,a=-1,n,s=t[1],o=0,c=7,l=4;for(s===0&&(c=138,l=3),t[(r+1)*2+1]=65535,i=0;i<=r;i++)n=s,s=t[(i+1)*2+1],!(++o<c&&n===s)&&(o<l?e.bl_tree[n*2]+=o:n!==0?(n!==a&&e.bl_tree[n*2]++,e.bl_tree[Oa*2]++):o<=10?e.bl_tree[za*2]++:e.bl_tree[Na*2]++,o=0,a=n,s===0?(c=138,l=3):n===s?(c=6,l=3):(c=7,l=4))}function Ba(e,t,r){var i,a=-1,n,s=t[1],o=0,c=7,l=4;for(s===0&&(c=138,l=3),i=0;i<=r;i++)if(n=s,s=t[(i+1)*2+1],!(++o<c&&n===s)){if(o<l)do ze(e,n,e.bl_tree);while(--o!==0);else n!==0?(n!==a&&(ze(e,n,e.bl_tree),o--),ze(e,Oa,e.bl_tree),Ee(e,o-3,2)):o<=10?(ze(e,za,e.bl_tree),Ee(e,o-3,3)):(ze(e,Na,e.bl_tree),Ee(e,o-11,7));o=0,a=n,s===0?(c=138,l=3):n===s?(c=6,l=3):(c=7,l=4)}}function bc(e){var t;for(Ia(e,e.dyn_ltree,e.l_desc.max_code),Ia(e,e.dyn_dtree,e.d_desc.max_code),Gr(e,e.bl_desc),t=Vr-1;t>=3&&e.bl_tree[Ua[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t}function xc(e,t,r,i){var a;for(Ee(e,t-257,5),Ee(e,r-1,5),Ee(e,i-4,4),a=0;a<i;a++)Ee(e,e.bl_tree[Ua[a]*2+1],3);Ba(e,e.dyn_ltree,t-1),Ba(e,e.dyn_dtree,r-1)}function yc(e){var t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return Ma;if(e.dyn_ltree[18]!==0||e.dyn_ltree[20]!==0||e.dyn_ltree[26]!==0)return Ta;for(r=32;r<Gt;r++)if(e.dyn_ltree[r*2]!==0)return Ta;return Ma}var La=!1;function _c(e){La||(mc(),La=!0),e.l_desc=new Nr(e.dyn_ltree,Ha),e.d_desc=new Nr(e.dyn_dtree,Ga),e.bl_desc=new Nr(e.bl_tree,Wa),e.bi_buf=0,e.bi_valid=0,Ya(e)}function Ka(e,t,r,i){Ee(e,(oc<<1)+(i?1:0),3),gc(e,t,r,!0)}function wc(e){Ee(e,Da<<1,3),ze(e,jr,Ze),pc(e)}function Ac(e,t,r,i){var a,n,s=0;e.level>0?(e.strm.data_type===sc&&(e.strm.data_type=yc(e)),Gr(e,e.l_desc),Gr(e,e.d_desc),s=bc(e),a=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=a&&(a=n)):a=n=r+5,r+4<=a&&t!==-1?Ka(e,t,r,i):e.strategy===nc||n===a?(Ee(e,(Da<<1)+(i?1:0),3),Ra(e,Ze,Ot)):(Ee(e,(lc<<1)+(i?1:0),3),xc(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Ra(e,e.dyn_ltree,e.dyn_dtree)),Ya(e),i&&qa(e)}function Sc(e,t,r){return e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=r&255,e.last_lit++,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(Ut[r]+Gt+1)*2]++,e.dyn_dtree[Va(t)*2]++),e.last_lit===e.lit_bufsize-1}xt._tr_init=_c;xt._tr_stored_block=Ka;xt._tr_flush_block=Ac;xt._tr_tally=Sc;xt._tr_align=wc});var Yr=_e((sd,Qa)=>{"use strict";function Cc(e,t,r,i){for(var a=e&65535|0,n=e>>>16&65535|0,s=0;r!==0;){s=r>2e3?2e3:r,r-=s;do a=a+t[i++]|0,n=n+a|0;while(--s);a%=65521,n%=65521}return a|n<<16|0}Qa.exports=Cc});var qr=_e((od,Ja)=>{"use strict";function Ec(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t}var kc=Ec();function Mc(e,t,r,i){var a=kc,n=i+r;e^=-1;for(var s=i;s<n;s++)e=e>>>8^a[(e^t[s])&255];return e^-1}Ja.exports=Mc});var cr=_e((ld,$a)=>{"use strict";$a.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}});var hn=_e(He=>{"use strict";var Ce=je(),Pe=Xa(),an=Yr(),Je=qr(),Tc=cr(),ht=0,Pc=1,Rc=3,it=4,en=5,Ue=0,tn=1,Re=-2,Ic=-3,Kr=-5,Bc=-1,Lc=1,fr=2,Dc=3,Fc=4,Oc=0,zc=2,vr=8,Nc=9,Uc=15,Hc=8,Gc=29,Wc=256,Qr=Wc+1+Gc,Vc=30,jc=19,Zc=2*Qr+1,Yc=15,se=3,tt=258,Le=tt+se+1,qc=32,mr=42,Jr=69,dr=73,ur=91,pr=103,st=113,Vt=666,xe=1,jt=2,ot=3,wt=4,Kc=3;function rt(e,t){return e.msg=Tc[t],t}function rn(e){return(e<<1)-(e>4?9:0)}function et(e){for(var t=e.length;--t>=0;)e[t]=0}function $e(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(Ce.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))}function we(e,t){Pe._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,$e(e.strm)}function le(e,t){e.pending_buf[e.pending++]=t}function Wt(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255}function Xc(e,t,r,i){var a=e.avail_in;return a>i&&(a=i),a===0?0:(e.avail_in-=a,Ce.arraySet(t,e.input,e.next_in,a,r),e.state.wrap===1?e.adler=an(e.adler,t,a,r):e.state.wrap===2&&(e.adler=Je(e.adler,t,a,r)),e.next_in+=a,e.total_in+=a,a)}function nn(e,t){var r=e.max_chain_length,i=e.strstart,a,n,s=e.prev_length,o=e.nice_match,c=e.strstart>e.w_size-Le?e.strstart-(e.w_size-Le):0,l=e.window,h=e.w_mask,d=e.prev,u=e.strstart+tt,f=l[i+s-1],v=l[i+s];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do if(a=t,!(l[a+s]!==v||l[a+s-1]!==f||l[a]!==l[i]||l[++a]!==l[i+1])){i+=2,a++;do;while(l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&i<u);if(n=tt-(u-i),i=u-tt,n>s){if(e.match_start=t,s=n,n>=o)break;f=l[i+s-1],v=l[i+s]}}while((t=d[t&h])>c&&--r!==0);return s<=e.lookahead?s:e.lookahead}function lt(e){var t=e.w_size,r,i,a,n,s;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Le)){Ce.arraySet(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,i=e.hash_size,r=i;do a=e.head[--r],e.head[r]=a>=t?a-t:0;while(--i);i=t,r=i;do a=e.prev[--r],e.prev[r]=a>=t?a-t:0;while(--i);n+=t}if(e.strm.avail_in===0)break;if(i=Xc(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=i,e.lookahead+e.insert>=se)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+se-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<se)););}while(e.lookahead<Le&&e.strm.avail_in!==0)}function Qc(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(lt(e),e.lookahead===0&&t===ht)return xe;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((e.strstart===0||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,we(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-Le&&(we(e,!1),e.strm.avail_out===0))return xe}return e.insert=0,t===it?(we(e,!0),e.strm.avail_out===0?ot:wt):(e.strstart>e.block_start&&(we(e,!1),e.strm.avail_out===0),xe)}function Xr(e,t){for(var r,i;;){if(e.lookahead<Le){if(lt(e),e.lookahead<Le&&t===ht)return xe;if(e.lookahead===0)break}if(r=0,e.lookahead>=se&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Le&&(e.match_length=nn(e,r)),e.match_length>=se)if(i=Pe._tr_tally(e,e.strstart-e.match_start,e.match_length-se),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=se){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=Pe._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(we(e,!1),e.strm.avail_out===0))return xe}return e.insert=e.strstart<se-1?e.strstart:se-1,t===it?(we(e,!0),e.strm.avail_out===0?ot:wt):e.last_lit&&(we(e,!1),e.strm.avail_out===0)?xe:jt}function yt(e,t){for(var r,i,a;;){if(e.lookahead<Le){if(lt(e),e.lookahead<Le&&t===ht)return xe;if(e.lookahead===0)break}if(r=0,e.lookahead>=se&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=se-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Le&&(e.match_length=nn(e,r),e.match_length<=5&&(e.strategy===Lc||e.match_length===se&&e.strstart-e.match_start>4096)&&(e.match_length=se-1)),e.prev_length>=se&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-se,i=Pe._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-se),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=se-1,e.strstart++,i&&(we(e,!1),e.strm.avail_out===0))return xe}else if(e.match_available){if(i=Pe._tr_tally(e,0,e.window[e.strstart-1]),i&&we(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return xe}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Pe._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<se-1?e.strstart:se-1,t===it?(we(e,!0),e.strm.avail_out===0?ot:wt):e.last_lit&&(we(e,!1),e.strm.avail_out===0)?xe:jt}function Jc(e,t){for(var r,i,a,n,s=e.window;;){if(e.lookahead<=tt){if(lt(e),e.lookahead<=tt&&t===ht)return xe;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=se&&e.strstart>0&&(a=e.strstart-1,i=s[a],i===s[++a]&&i===s[++a]&&i===s[++a])){n=e.strstart+tt;do;while(i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&a<n);e.match_length=tt-(n-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=se?(r=Pe._tr_tally(e,1,e.match_length-se),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Pe._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(we(e,!1),e.strm.avail_out===0))return xe}return e.insert=0,t===it?(we(e,!0),e.strm.avail_out===0?ot:wt):e.last_lit&&(we(e,!1),e.strm.avail_out===0)?xe:jt}function $c(e,t){for(var r;;){if(e.lookahead===0&&(lt(e),e.lookahead===0)){if(t===ht)return xe;break}if(e.match_length=0,r=Pe._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(we(e,!1),e.strm.avail_out===0))return xe}return e.insert=0,t===it?(we(e,!0),e.strm.avail_out===0?ot:wt):e.last_lit&&(we(e,!1),e.strm.avail_out===0)?xe:jt}function Ne(e,t,r,i,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=a}var _t;_t=[new Ne(0,0,0,0,Qc),new Ne(4,4,8,4,Xr),new Ne(4,5,16,8,Xr),new Ne(4,6,32,32,Xr),new Ne(4,4,16,16,yt),new Ne(8,16,32,32,yt),new Ne(8,16,128,128,yt),new Ne(8,32,128,256,yt),new Ne(32,128,258,1024,yt),new Ne(32,258,258,4096,yt)];function ef(e){e.window_size=2*e.w_size,et(e.head),e.max_lazy_match=_t[e.level].max_lazy,e.good_match=_t[e.level].good_length,e.nice_match=_t[e.level].nice_length,e.max_chain_length=_t[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=se-1,e.match_available=0,e.ins_h=0}function tf(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=vr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Ce.Buf16(Zc*2),this.dyn_dtree=new Ce.Buf16((2*Vc+1)*2),this.bl_tree=new Ce.Buf16((2*jc+1)*2),et(this.dyn_ltree),et(this.dyn_dtree),et(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Ce.Buf16(Yc+1),this.heap=new Ce.Buf16(2*Qr+1),et(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Ce.Buf16(2*Qr+1),et(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function sn(e){var t;return!e||!e.state?rt(e,Re):(e.total_in=e.total_out=0,e.data_type=zc,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?mr:st,e.adler=t.wrap===2?0:1,t.last_flush=ht,Pe._tr_init(t),Ue)}function on(e){var t=sn(e);return t===Ue&&ef(e.state),t}function rf(e,t){return!e||!e.state||e.state.wrap!==2?Re:(e.state.gzhead=t,Ue)}function ln(e,t,r,i,a,n){if(!e)return Re;var s=1;if(t===Bc&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),a<1||a>Nc||r!==vr||i<8||i>15||t<0||t>9||n<0||n>Fc)return rt(e,Re);i===8&&(i=9);var o=new tf;return e.state=o,o.strm=e,o.wrap=s,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+se-1)/se),o.window=new Ce.Buf8(o.w_size*2),o.head=new Ce.Buf16(o.hash_size),o.prev=new Ce.Buf16(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Ce.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=n,o.method=r,on(e)}function af(e,t){return ln(e,t,vr,Uc,Hc,Oc)}function nf(e,t){var r,i,a,n;if(!e||!e.state||t>en||t<0)return e?rt(e,Re):Re;if(i=e.state,!e.output||!e.input&&e.avail_in!==0||i.status===Vt&&t!==it)return rt(e,e.avail_out===0?Kr:Re);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===mr)if(i.wrap===2)e.adler=0,le(i,31),le(i,139),le(i,8),i.gzhead?(le(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),le(i,i.gzhead.time&255),le(i,i.gzhead.time>>8&255),le(i,i.gzhead.time>>16&255),le(i,i.gzhead.time>>24&255),le(i,i.level===9?2:i.strategy>=fr||i.level<2?4:0),le(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(le(i,i.gzhead.extra.length&255),le(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Je(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=Jr):(le(i,0),le(i,0),le(i,0),le(i,0),le(i,0),le(i,i.level===9?2:i.strategy>=fr||i.level<2?4:0),le(i,Kc),i.status=st);else{var s=vr+(i.w_bits-8<<4)<<8,o=-1;i.strategy>=fr||i.level<2?o=0:i.level<6?o=1:i.level===6?o=2:o=3,s|=o<<6,i.strstart!==0&&(s|=qc),s+=31-s%31,i.status=st,Wt(i,s),i.strstart!==0&&(Wt(i,e.adler>>>16),Wt(i,e.adler&65535)),e.adler=1}if(i.status===Jr)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=Je(e.adler,i.pending_buf,i.pending-a,a)),$e(e),a=i.pending,i.pending===i.pending_buf_size));)le(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(e.adler=Je(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=dr)}else i.status=dr;if(i.status===dr)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=Je(e.adler,i.pending_buf,i.pending-a,a)),$e(e),a=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.name.length?n=i.gzhead.name.charCodeAt(i.gzindex++)&255:n=0,le(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>a&&(e.adler=Je(e.adler,i.pending_buf,i.pending-a,a)),n===0&&(i.gzindex=0,i.status=ur)}else i.status=ur;if(i.status===ur)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=Je(e.adler,i.pending_buf,i.pending-a,a)),$e(e),a=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.comment.length?n=i.gzhead.comment.charCodeAt(i.gzindex++)&255:n=0,le(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>a&&(e.adler=Je(e.adler,i.pending_buf,i.pending-a,a)),n===0&&(i.status=pr)}else i.status=pr;if(i.status===pr&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&$e(e),i.pending+2<=i.pending_buf_size&&(le(i,e.adler&255),le(i,e.adler>>8&255),e.adler=0,i.status=st)):i.status=st),i.pending!==0){if($e(e),e.avail_out===0)return i.last_flush=-1,Ue}else if(e.avail_in===0&&rn(t)<=rn(r)&&t!==it)return rt(e,Kr);if(i.status===Vt&&e.avail_in!==0)return rt(e,Kr);if(e.avail_in!==0||i.lookahead!==0||t!==ht&&i.status!==Vt){var c=i.strategy===fr?$c(i,t):i.strategy===Dc?Jc(i,t):_t[i.level].func(i,t);if((c===ot||c===wt)&&(i.status=Vt),c===xe||c===ot)return e.avail_out===0&&(i.last_flush=-1),Ue;if(c===jt&&(t===Pc?Pe._tr_align(i):t!==en&&(Pe._tr_stored_block(i,0,0,!1),t===Rc&&(et(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),$e(e),e.avail_out===0))return i.last_flush=-1,Ue}return t!==it?Ue:i.wrap<=0?tn:(i.wrap===2?(le(i,e.adler&255),le(i,e.adler>>8&255),le(i,e.adler>>16&255),le(i,e.adler>>24&255),le(i,e.total_in&255),le(i,e.total_in>>8&255),le(i,e.total_in>>16&255),le(i,e.total_in>>24&255)):(Wt(i,e.adler>>>16),Wt(i,e.adler&65535)),$e(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Ue:tn)}function sf(e){var t;return!e||!e.state?Re:(t=e.state.status,t!==mr&&t!==Jr&&t!==dr&&t!==ur&&t!==pr&&t!==st&&t!==Vt?rt(e,Re):(e.state=null,t===st?rt(e,Ic):Ue))}function of(e,t){var r=t.length,i,a,n,s,o,c,l,h;if(!e||!e.state||(i=e.state,s=i.wrap,s===2||s===1&&i.status!==mr||i.lookahead))return Re;for(s===1&&(e.adler=an(e.adler,t,r,0)),i.wrap=0,r>=i.w_size&&(s===0&&(et(i.head),i.strstart=0,i.block_start=0,i.insert=0),h=new Ce.Buf8(i.w_size),Ce.arraySet(h,t,r-i.w_size,i.w_size,0),t=h,r=i.w_size),o=e.avail_in,c=e.next_in,l=e.input,e.avail_in=r,e.next_in=0,e.input=t,lt(i);i.lookahead>=se;){a=i.strstart,n=i.lookahead-(se-1);do i.ins_h=(i.ins_h<<i.hash_shift^i.window[a+se-1])&i.hash_mask,i.prev[a&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=a,a++;while(--n);i.strstart=a,i.lookahead=se-1,lt(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=se-1,i.match_available=0,e.next_in=c,e.input=l,e.avail_in=o,i.wrap=s,Ue}He.deflateInit=af;He.deflateInit2=ln;He.deflateReset=on;He.deflateResetKeep=sn;He.deflateSetHeader=rf;He.deflate=nf;He.deflateEnd=sf;He.deflateSetDictionary=of;He.deflateInfo="pako deflate (from Nodeca project)"});var $r=_e(At=>{"use strict";var gr=je(),cn=!0,fn=!0;try{String.fromCharCode.apply(null,[0])}catch{cn=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{fn=!1}var Zt=new gr.Buf8(256);for(Ye=0;Ye<256;Ye++)Zt[Ye]=Ye>=252?6:Ye>=248?5:Ye>=240?4:Ye>=224?3:Ye>=192?2:1;var Ye;Zt[254]=Zt[254]=1;At.string2buf=function(e){var t,r,i,a,n,s=e.length,o=0;for(a=0;a<s;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<s&&(i=e.charCodeAt(a+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),a++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new gr.Buf8(o),n=0,a=0;n<o;a++)r=e.charCodeAt(a),(r&64512)===55296&&a+1<s&&(i=e.charCodeAt(a+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),a++)),r<128?t[n++]=r:r<2048?(t[n++]=192|r>>>6,t[n++]=128|r&63):r<65536?(t[n++]=224|r>>>12,t[n++]=128|r>>>6&63,t[n++]=128|r&63):(t[n++]=240|r>>>18,t[n++]=128|r>>>12&63,t[n++]=128|r>>>6&63,t[n++]=128|r&63);return t};function dn(e,t){if(t<65534&&(e.subarray&&fn||!e.subarray&&cn))return String.fromCharCode.apply(null,gr.shrinkBuf(e,t));for(var r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r}At.buf2binstring=function(e){return dn(e,e.length)};At.binstring2buf=function(e){for(var t=new gr.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t};At.buf2string=function(e,t){var r,i,a,n,s=t||e.length,o=new Array(s*2);for(i=0,r=0;r<s;){if(a=e[r++],a<128){o[i++]=a;continue}if(n=Zt[a],n>4){o[i++]=65533,r+=n-1;continue}for(a&=n===2?31:n===3?15:7;n>1&&r<s;)a=a<<6|e[r++]&63,n--;if(n>1){o[i++]=65533;continue}a<65536?o[i++]=a:(a-=65536,o[i++]=55296|a>>10&1023,o[i++]=56320|a&1023)}return dn(o,i)};At.utf8border=function(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+Zt[e[r]]>t?r:t}});var ei=_e((fd,un)=>{"use strict";function lf(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}un.exports=lf});var gn=_e(Kt=>{"use strict";var Yt=hn(),qt=je(),ri=$r(),ii=cr(),hf=ei(),mn=Object.prototype.toString,cf=0,ti=4,St=0,pn=1,vn=2,ff=-1,df=0,uf=8;function ct(e){if(!(this instanceof ct))return new ct(e);this.options=qt.assign({level:ff,method:uf,chunkSize:16384,windowBits:15,memLevel:8,strategy:df,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new hf,this.strm.avail_out=0;var r=Yt.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==St)throw new Error(ii[r]);if(t.header&&Yt.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(typeof t.dictionary=="string"?i=ri.string2buf(t.dictionary):mn.call(t.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(t.dictionary):i=t.dictionary,r=Yt.deflateSetDictionary(this.strm,i),r!==St)throw new Error(ii[r]);this._dict_set=!0}}ct.prototype.push=function(e,t){var r=this.strm,i=this.options.chunkSize,a,n;if(this.ended)return!1;n=t===~~t?t:t===!0?ti:cf,typeof e=="string"?r.input=ri.string2buf(e):mn.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(r.avail_out===0&&(r.output=new qt.Buf8(i),r.next_out=0,r.avail_out=i),a=Yt.deflate(r,n),a!==pn&&a!==St)return this.onEnd(a),this.ended=!0,!1;(r.avail_out===0||r.avail_in===0&&(n===ti||n===vn))&&(this.options.to==="string"?this.onData(ri.buf2binstring(qt.shrinkBuf(r.output,r.next_out))):this.onData(qt.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||r.avail_out===0)&&a!==pn);return n===ti?(a=Yt.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===St):(n===vn&&(this.onEnd(St),r.avail_out=0),!0)};ct.prototype.onData=function(e){this.chunks.push(e)};ct.prototype.onEnd=function(e){e===St&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=qt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function ai(e,t){var r=new ct(t);if(r.push(e,!0),r.err)throw r.msg||ii[r.err];return r.result}function pf(e,t){return t=t||{},t.raw=!0,ai(e,t)}function vf(e,t){return t=t||{},t.gzip=!0,ai(e,t)}Kt.Deflate=ct;Kt.deflate=ai;Kt.deflateRaw=pf;Kt.gzip=vf});var xn=_e((ud,bn)=>{"use strict";var br=30,mf=12;bn.exports=function(t,r){var i,a,n,s,o,c,l,h,d,u,f,v,p,g,x,A,_,E,S,M,k,R,O,y,T;i=t.state,a=t.next_in,y=t.input,n=a+(t.avail_in-5),s=t.next_out,T=t.output,o=s-(r-t.avail_out),c=s+(t.avail_out-257),l=i.dmax,h=i.wsize,d=i.whave,u=i.wnext,f=i.window,v=i.hold,p=i.bits,g=i.lencode,x=i.distcode,A=(1<<i.lenbits)-1,_=(1<<i.distbits)-1;e:do{p<15&&(v+=y[a++]<<p,p+=8,v+=y[a++]<<p,p+=8),E=g[v&A];t:for(;;){if(S=E>>>24,v>>>=S,p-=S,S=E>>>16&255,S===0)T[s++]=E&65535;else if(S&16){M=E&65535,S&=15,S&&(p<S&&(v+=y[a++]<<p,p+=8),M+=v&(1<<S)-1,v>>>=S,p-=S),p<15&&(v+=y[a++]<<p,p+=8,v+=y[a++]<<p,p+=8),E=x[v&_];r:for(;;){if(S=E>>>24,v>>>=S,p-=S,S=E>>>16&255,S&16){if(k=E&65535,S&=15,p<S&&(v+=y[a++]<<p,p+=8,p<S&&(v+=y[a++]<<p,p+=8)),k+=v&(1<<S)-1,k>l){t.msg="invalid distance too far back",i.mode=br;break e}if(v>>>=S,p-=S,S=s-o,k>S){if(S=k-S,S>d&&i.sane){t.msg="invalid distance too far back",i.mode=br;break e}if(R=0,O=f,u===0){if(R+=h-S,S<M){M-=S;do T[s++]=f[R++];while(--S);R=s-k,O=T}}else if(u<S){if(R+=h+u-S,S-=u,S<M){M-=S;do T[s++]=f[R++];while(--S);if(R=0,u<M){S=u,M-=S;do T[s++]=f[R++];while(--S);R=s-k,O=T}}}else if(R+=u-S,S<M){M-=S;do T[s++]=f[R++];while(--S);R=s-k,O=T}for(;M>2;)T[s++]=O[R++],T[s++]=O[R++],T[s++]=O[R++],M-=3;M&&(T[s++]=O[R++],M>1&&(T[s++]=O[R++]))}else{R=s-k;do T[s++]=T[R++],T[s++]=T[R++],T[s++]=T[R++],M-=3;while(M>2);M&&(T[s++]=T[R++],M>1&&(T[s++]=T[R++]))}}else if((S&64)===0){E=x[(E&65535)+(v&(1<<S)-1)];continue r}else{t.msg="invalid distance code",i.mode=br;break e}break}}else if((S&64)===0){E=g[(E&65535)+(v&(1<<S)-1)];continue t}else if(S&32){i.mode=mf;break e}else{t.msg="invalid literal/length code",i.mode=br;break e}break}}while(a<n&&s<c);M=p>>3,a-=M,p-=M<<3,v&=(1<<p)-1,t.next_in=a,t.next_out=s,t.avail_in=a<n?5+(n-a):5-(a-n),t.avail_out=s<c?257+(c-s):257-(s-c),i.hold=v,i.bits=p}});var En=_e((pd,Cn)=>{"use strict";var yn=je(),Ct=15,_n=852,wn=592,An=0,ni=1,Sn=2,gf=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],bf=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],xf=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],yf=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];Cn.exports=function(t,r,i,a,n,s,o,c){var l=c.bits,h=0,d=0,u=0,f=0,v=0,p=0,g=0,x=0,A=0,_=0,E,S,M,k,R,O=null,y=0,T,b=new yn.Buf16(Ct+1),I=new yn.Buf16(Ct+1),G=null,z=0,$,U,Q;for(h=0;h<=Ct;h++)b[h]=0;for(d=0;d<a;d++)b[r[i+d]]++;for(v=l,f=Ct;f>=1&&b[f]===0;f--);if(v>f&&(v=f),f===0)return n[s++]=1<<24|64<<16|0,n[s++]=1<<24|64<<16|0,c.bits=1,0;for(u=1;u<f&&b[u]===0;u++);for(v<u&&(v=u),x=1,h=1;h<=Ct;h++)if(x<<=1,x-=b[h],x<0)return-1;if(x>0&&(t===An||f!==1))return-1;for(I[1]=0,h=1;h<Ct;h++)I[h+1]=I[h]+b[h];for(d=0;d<a;d++)r[i+d]!==0&&(o[I[r[i+d]]++]=d);if(t===An?(O=G=o,T=19):t===ni?(O=gf,y-=257,G=bf,z-=257,T=256):(O=xf,G=yf,T=-1),_=0,d=0,h=u,R=s,p=v,g=0,M=-1,A=1<<v,k=A-1,t===ni&&A>_n||t===Sn&&A>wn)return 1;for(;;){$=h-g,o[d]<T?(U=0,Q=o[d]):o[d]>T?(U=G[z+o[d]],Q=O[y+o[d]]):(U=96,Q=0),E=1<<h-g,S=1<<p,u=S;do S-=E,n[R+(_>>g)+S]=$<<24|U<<16|Q|0;while(S!==0);for(E=1<<h-1;_&E;)E>>=1;if(E!==0?(_&=E-1,_+=E):_=0,d++,--b[h]===0){if(h===f)break;h=r[i+o[d]]}if(h>v&&(_&k)!==M){for(g===0&&(g=v),R+=u,p=h-g,x=1<<p;p+g<f&&(x-=b[p+g],!(x<=0));)p++,x<<=1;if(A+=1<<p,t===ni&&A>_n||t===Sn&&A>wn)return 1;M=_&k,n[M]=v<<24|p<<16|R-s|0}}return _!==0&&(n[R+_]=h-g<<24|64<<16|0),c.bits=v,0}});var os=_e(De=>{"use strict";var ke=je(),fi=Yr(),Ge=qr(),_f=xn(),Xt=En(),wf=0,Jn=1,$n=2,kn=4,Af=5,xr=6,ft=0,Sf=1,Cf=2,Ie=-2,es=-3,di=-4,Ef=-5,Mn=8,ts=1,Tn=2,Pn=3,Rn=4,In=5,Bn=6,Ln=7,Dn=8,Fn=9,On=10,wr=11,qe=12,si=13,zn=14,oi=15,Nn=16,Un=17,Hn=18,Gn=19,yr=20,_r=21,Wn=22,Vn=23,jn=24,Zn=25,Yn=26,li=27,qn=28,Kn=29,ue=30,ui=31,kf=32,Mf=852,Tf=592,Pf=15,Rf=Pf;function Xn(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function If(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new ke.Buf16(320),this.work=new ke.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function rs(e){var t;return!e||!e.state?Ie:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=ts,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new ke.Buf32(Mf),t.distcode=t.distdyn=new ke.Buf32(Tf),t.sane=1,t.back=-1,ft)}function is(e){var t;return!e||!e.state?Ie:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,rs(e))}function as(e,t){var r,i;return!e||!e.state||(i=e.state,t<0?(r=0,t=-t):(r=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15))?Ie:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,is(e))}function ns(e,t){var r,i;return e?(i=new If,e.state=i,i.window=null,r=as(e,t),r!==ft&&(e.state=null),r):Ie}function Bf(e){return ns(e,Rf)}var Qn=!0,hi,ci;function Lf(e){if(Qn){var t;for(hi=new ke.Buf32(512),ci=new ke.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Xt(Jn,e.lens,0,288,hi,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Xt($n,e.lens,0,32,ci,0,e.work,{bits:5}),Qn=!1}e.lencode=hi,e.lenbits=9,e.distcode=ci,e.distbits=5}function ss(e,t,r,i){var a,n=e.state;return n.window===null&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new ke.Buf8(n.wsize)),i>=n.wsize?(ke.arraySet(n.window,t,r-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):(a=n.wsize-n.wnext,a>i&&(a=i),ke.arraySet(n.window,t,r-i,a,n.wnext),i-=a,i?(ke.arraySet(n.window,t,r-i,i,0),n.wnext=i,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0}function Df(e,t){var r,i,a,n,s,o,c,l,h,d,u,f,v,p,g=0,x,A,_,E,S,M,k,R,O=new ke.Buf8(4),y,T,b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return Ie;r=e.state,r.mode===qe&&(r.mode=si),s=e.next_out,a=e.output,c=e.avail_out,n=e.next_in,i=e.input,o=e.avail_in,l=r.hold,h=r.bits,d=o,u=c,R=ft;e:for(;;)switch(r.mode){case ts:if(r.wrap===0){r.mode=si;break}for(;h<16;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(r.wrap&2&&l===35615){r.check=0,O[0]=l&255,O[1]=l>>>8&255,r.check=Ge(r.check,O,2,0),l=0,h=0,r.mode=Tn;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((l&255)<<8)+(l>>8))%31){e.msg="incorrect header check",r.mode=ue;break}if((l&15)!==Mn){e.msg="unknown compression method",r.mode=ue;break}if(l>>>=4,h-=4,k=(l&15)+8,r.wbits===0)r.wbits=k;else if(k>r.wbits){e.msg="invalid window size",r.mode=ue;break}r.dmax=1<<k,e.adler=r.check=1,r.mode=l&512?On:qe,l=0,h=0;break;case Tn:for(;h<16;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(r.flags=l,(r.flags&255)!==Mn){e.msg="unknown compression method",r.mode=ue;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=ue;break}r.head&&(r.head.text=l>>8&1),r.flags&512&&(O[0]=l&255,O[1]=l>>>8&255,r.check=Ge(r.check,O,2,0)),l=0,h=0,r.mode=Pn;case Pn:for(;h<32;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.head&&(r.head.time=l),r.flags&512&&(O[0]=l&255,O[1]=l>>>8&255,O[2]=l>>>16&255,O[3]=l>>>24&255,r.check=Ge(r.check,O,4,0)),l=0,h=0,r.mode=Rn;case Rn:for(;h<16;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.head&&(r.head.xflags=l&255,r.head.os=l>>8),r.flags&512&&(O[0]=l&255,O[1]=l>>>8&255,r.check=Ge(r.check,O,2,0)),l=0,h=0,r.mode=In;case In:if(r.flags&1024){for(;h<16;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.length=l,r.head&&(r.head.extra_len=l),r.flags&512&&(O[0]=l&255,O[1]=l>>>8&255,r.check=Ge(r.check,O,2,0)),l=0,h=0}else r.head&&(r.head.extra=null);r.mode=Bn;case Bn:if(r.flags&1024&&(f=r.length,f>o&&(f=o),f&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),ke.arraySet(r.head.extra,i,n,f,k)),r.flags&512&&(r.check=Ge(r.check,i,f,n)),o-=f,n+=f,r.length-=f),r.length))break e;r.length=0,r.mode=Ln;case Ln:if(r.flags&2048){if(o===0)break e;f=0;do k=i[n+f++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k));while(k&&f<o);if(r.flags&512&&(r.check=Ge(r.check,i,f,n)),o-=f,n+=f,k)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=Dn;case Dn:if(r.flags&4096){if(o===0)break e;f=0;do k=i[n+f++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k));while(k&&f<o);if(r.flags&512&&(r.check=Ge(r.check,i,f,n)),o-=f,n+=f,k)break e}else r.head&&(r.head.comment=null);r.mode=Fn;case Fn:if(r.flags&512){for(;h<16;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(l!==(r.check&65535)){e.msg="header crc mismatch",r.mode=ue;break}l=0,h=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=qe;break;case On:for(;h<32;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}e.adler=r.check=Xn(l),l=0,h=0,r.mode=wr;case wr:if(r.havedict===0)return e.next_out=s,e.avail_out=c,e.next_in=n,e.avail_in=o,r.hold=l,r.bits=h,Cf;e.adler=r.check=1,r.mode=qe;case qe:if(t===Af||t===xr)break e;case si:if(r.last){l>>>=h&7,h-=h&7,r.mode=li;break}for(;h<3;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}switch(r.last=l&1,l>>>=1,h-=1,l&3){case 0:r.mode=zn;break;case 1:if(Lf(r),r.mode=yr,t===xr){l>>>=2,h-=2;break e}break;case 2:r.mode=Un;break;case 3:e.msg="invalid block type",r.mode=ue}l>>>=2,h-=2;break;case zn:for(l>>>=h&7,h-=h&7;h<32;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if((l&65535)!==(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=ue;break}if(r.length=l&65535,l=0,h=0,r.mode=oi,t===xr)break e;case oi:r.mode=Nn;case Nn:if(f=r.length,f){if(f>o&&(f=o),f>c&&(f=c),f===0)break e;ke.arraySet(a,i,n,f,s),o-=f,n+=f,c-=f,s+=f,r.length-=f;break}r.mode=qe;break;case Un:for(;h<14;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(r.nlen=(l&31)+257,l>>>=5,h-=5,r.ndist=(l&31)+1,l>>>=5,h-=5,r.ncode=(l&15)+4,l>>>=4,h-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=ue;break}r.have=0,r.mode=Hn;case Hn:for(;r.have<r.ncode;){for(;h<3;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.lens[b[r.have++]]=l&7,l>>>=3,h-=3}for(;r.have<19;)r.lens[b[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,y={bits:r.lenbits},R=Xt(wf,r.lens,0,19,r.lencode,0,r.work,y),r.lenbits=y.bits,R){e.msg="invalid code lengths set",r.mode=ue;break}r.have=0,r.mode=Gn;case Gn:for(;r.have<r.nlen+r.ndist;){for(;g=r.lencode[l&(1<<r.lenbits)-1],x=g>>>24,A=g>>>16&255,_=g&65535,!(x<=h);){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(_<16)l>>>=x,h-=x,r.lens[r.have++]=_;else{if(_===16){for(T=x+2;h<T;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(l>>>=x,h-=x,r.have===0){e.msg="invalid bit length repeat",r.mode=ue;break}k=r.lens[r.have-1],f=3+(l&3),l>>>=2,h-=2}else if(_===17){for(T=x+3;h<T;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}l>>>=x,h-=x,k=0,f=3+(l&7),l>>>=3,h-=3}else{for(T=x+7;h<T;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}l>>>=x,h-=x,k=0,f=11+(l&127),l>>>=7,h-=7}if(r.have+f>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=ue;break}for(;f--;)r.lens[r.have++]=k}}if(r.mode===ue)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=ue;break}if(r.lenbits=9,y={bits:r.lenbits},R=Xt(Jn,r.lens,0,r.nlen,r.lencode,0,r.work,y),r.lenbits=y.bits,R){e.msg="invalid literal/lengths set",r.mode=ue;break}if(r.distbits=6,r.distcode=r.distdyn,y={bits:r.distbits},R=Xt($n,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,y),r.distbits=y.bits,R){e.msg="invalid distances set",r.mode=ue;break}if(r.mode=yr,t===xr)break e;case yr:r.mode=_r;case _r:if(o>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=n,e.avail_in=o,r.hold=l,r.bits=h,_f(e,u),s=e.next_out,a=e.output,c=e.avail_out,n=e.next_in,i=e.input,o=e.avail_in,l=r.hold,h=r.bits,r.mode===qe&&(r.back=-1);break}for(r.back=0;g=r.lencode[l&(1<<r.lenbits)-1],x=g>>>24,A=g>>>16&255,_=g&65535,!(x<=h);){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(A&&(A&240)===0){for(E=x,S=A,M=_;g=r.lencode[M+((l&(1<<E+S)-1)>>E)],x=g>>>24,A=g>>>16&255,_=g&65535,!(E+x<=h);){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}l>>>=E,h-=E,r.back+=E}if(l>>>=x,h-=x,r.back+=x,r.length=_,A===0){r.mode=Yn;break}if(A&32){r.back=-1,r.mode=qe;break}if(A&64){e.msg="invalid literal/length code",r.mode=ue;break}r.extra=A&15,r.mode=Wn;case Wn:if(r.extra){for(T=r.extra;h<T;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,h-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=Vn;case Vn:for(;g=r.distcode[l&(1<<r.distbits)-1],x=g>>>24,A=g>>>16&255,_=g&65535,!(x<=h);){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if((A&240)===0){for(E=x,S=A,M=_;g=r.distcode[M+((l&(1<<E+S)-1)>>E)],x=g>>>24,A=g>>>16&255,_=g&65535,!(E+x<=h);){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}l>>>=E,h-=E,r.back+=E}if(l>>>=x,h-=x,r.back+=x,A&64){e.msg="invalid distance code",r.mode=ue;break}r.offset=_,r.extra=A&15,r.mode=jn;case jn:if(r.extra){for(T=r.extra;h<T;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,h-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=ue;break}r.mode=Zn;case Zn:if(c===0)break e;if(f=u-c,r.offset>f){if(f=r.offset-f,f>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=ue;break}f>r.wnext?(f-=r.wnext,v=r.wsize-f):v=r.wnext-f,f>r.length&&(f=r.length),p=r.window}else p=a,v=s-r.offset,f=r.length;f>c&&(f=c),c-=f,r.length-=f;do a[s++]=p[v++];while(--f);r.length===0&&(r.mode=_r);break;case Yn:if(c===0)break e;a[s++]=r.length,c--,r.mode=_r;break;case li:if(r.wrap){for(;h<32;){if(o===0)break e;o--,l|=i[n++]<<h,h+=8}if(u-=c,e.total_out+=u,r.total+=u,u&&(e.adler=r.check=r.flags?Ge(r.check,a,u,s-u):fi(r.check,a,u,s-u)),u=c,(r.flags?l:Xn(l))!==r.check){e.msg="incorrect data check",r.mode=ue;break}l=0,h=0}r.mode=qn;case qn:if(r.wrap&&r.flags){for(;h<32;){if(o===0)break e;o--,l+=i[n++]<<h,h+=8}if(l!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=ue;break}l=0,h=0}r.mode=Kn;case Kn:R=Sf;break e;case ue:R=es;break e;case ui:return di;case kf:default:return Ie}return e.next_out=s,e.avail_out=c,e.next_in=n,e.avail_in=o,r.hold=l,r.bits=h,(r.wsize||u!==e.avail_out&&r.mode<ue&&(r.mode<li||t!==kn))&&ss(e,e.output,e.next_out,u-e.avail_out)?(r.mode=ui,di):(d-=e.avail_in,u-=e.avail_out,e.total_in+=d,e.total_out+=u,r.total+=u,r.wrap&&u&&(e.adler=r.check=r.flags?Ge(r.check,a,u,e.next_out-u):fi(r.check,a,u,e.next_out-u)),e.data_type=r.bits+(r.last?64:0)+(r.mode===qe?128:0)+(r.mode===yr||r.mode===oi?256:0),(d===0&&u===0||t===kn)&&R===ft&&(R=Ef),R)}function Ff(e){if(!e||!e.state)return Ie;var t=e.state;return t.window&&(t.window=null),e.state=null,ft}function Of(e,t){var r;return!e||!e.state||(r=e.state,(r.wrap&2)===0)?Ie:(r.head=t,t.done=!1,ft)}function zf(e,t){var r=t.length,i,a,n;return!e||!e.state||(i=e.state,i.wrap!==0&&i.mode!==wr)?Ie:i.mode===wr&&(a=1,a=fi(a,t,r,0),a!==i.check)?es:(n=ss(e,t,r,r),n?(i.mode=ui,di):(i.havedict=1,ft))}De.inflateReset=is;De.inflateReset2=as;De.inflateResetKeep=rs;De.inflateInit=Bf;De.inflateInit2=ns;De.inflate=Df;De.inflateEnd=Ff;De.inflateGetHeader=Of;De.inflateSetDictionary=zf;De.inflateInfo="pako inflate (from Nodeca project)"});var pi=_e((md,ls)=>{"use strict";ls.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}});var cs=_e((gd,hs)=>{"use strict";function Nf(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}hs.exports=Nf});var ds=_e(Jt=>{"use strict";var Et=os(),Qt=je(),Ar=$r(),ge=pi(),vi=cr(),Uf=ei(),Hf=cs(),fs=Object.prototype.toString;function dt(e){if(!(this instanceof dt))return new dt(e);this.options=Qt.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Uf,this.strm.avail_out=0;var r=Et.inflateInit2(this.strm,t.windowBits);if(r!==ge.Z_OK)throw new Error(vi[r]);if(this.header=new Hf,Et.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Ar.string2buf(t.dictionary):fs.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Et.inflateSetDictionary(this.strm,t.dictionary),r!==ge.Z_OK)))throw new Error(vi[r])}dt.prototype.push=function(e,t){var r=this.strm,i=this.options.chunkSize,a=this.options.dictionary,n,s,o,c,l,h=!1;if(this.ended)return!1;s=t===~~t?t:t===!0?ge.Z_FINISH:ge.Z_NO_FLUSH,typeof e=="string"?r.input=Ar.binstring2buf(e):fs.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(r.avail_out===0&&(r.output=new Qt.Buf8(i),r.next_out=0,r.avail_out=i),n=Et.inflate(r,ge.Z_NO_FLUSH),n===ge.Z_NEED_DICT&&a&&(n=Et.inflateSetDictionary(this.strm,a)),n===ge.Z_BUF_ERROR&&h===!0&&(n=ge.Z_OK,h=!1),n!==ge.Z_STREAM_END&&n!==ge.Z_OK)return this.onEnd(n),this.ended=!0,!1;r.next_out&&(r.avail_out===0||n===ge.Z_STREAM_END||r.avail_in===0&&(s===ge.Z_FINISH||s===ge.Z_SYNC_FLUSH))&&(this.options.to==="string"?(o=Ar.utf8border(r.output,r.next_out),c=r.next_out-o,l=Ar.buf2string(r.output,o),r.next_out=c,r.avail_out=i-c,c&&Qt.arraySet(r.output,r.output,o,c,0),this.onData(l)):this.onData(Qt.shrinkBuf(r.output,r.next_out))),r.avail_in===0&&r.avail_out===0&&(h=!0)}while((r.avail_in>0||r.avail_out===0)&&n!==ge.Z_STREAM_END);return n===ge.Z_STREAM_END&&(s=ge.Z_FINISH),s===ge.Z_FINISH?(n=Et.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===ge.Z_OK):(s===ge.Z_SYNC_FLUSH&&(this.onEnd(ge.Z_OK),r.avail_out=0),!0)};dt.prototype.onData=function(e){this.chunks.push(e)};dt.prototype.onEnd=function(e){e===ge.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Qt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function mi(e,t){var r=new dt(t);if(r.push(e,!0),r.err)throw r.msg||vi[r.err];return r.result}function Gf(e,t){return t=t||{},t.raw=!0,mi(e,t)}Jt.Inflate=dt;Jt.inflate=mi;Jt.inflateRaw=Gf;Jt.ungzip=mi});var vs=_e((xd,ps)=>{"use strict";var Wf=je().assign,Vf=gn(),jf=ds(),Zf=pi(),us={};Wf(us,Vf,jf,Zf);ps.exports=us});var _s=_e((Ri,Ii)=>{(function(e,t){typeof define=="function"&&define.amd?define([],t):typeof Ri<"u"?t():(t(),e.FileSaver={})})(Ri,function(){"use strict";function e(o,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function t(o,c,l){var h=new XMLHttpRequest;h.open("GET",o),h.responseType="blob",h.onload=function(){s(h.response,c,l)},h.onerror=function(){console.error("could not download file")},h.send()}function r(o){var c=new XMLHttpRequest;c.open("HEAD",o,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function i(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(c)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,n=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!n?function(o,c,l){var h=a.URL||a.webkitURL,d=document.createElement("a");c=c||o.name||"download",d.download=c,d.rel="noopener",typeof o=="string"?(d.href=o,d.origin===location.origin?i(d):r(d.href)?t(o,c,l):i(d,d.target="_blank")):(d.href=h.createObjectURL(o),setTimeout(function(){h.revokeObjectURL(d.href)},4e4),setTimeout(function(){i(d)},0))}:"msSaveOrOpenBlob"in navigator?function(o,c,l){if(c=c||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(e(o,l),c);else if(r(o))t(o,c,l);else{var h=document.createElement("a");h.href=o,h.target="_blank",setTimeout(function(){i(h)})}}:function(o,c,l,h){if(h=h||open("","_blank"),h&&(h.document.title=h.document.body.innerText="downloading..."),typeof o=="string")return t(o,c,l);var d=o.type==="application/octet-stream",u=/constructor/i.test(a.HTMLElement)||a.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||d&&u||n)&&typeof FileReader<"u"){var v=new FileReader;v.onloadend=function(){var x=v.result;x=f?x:x.replace(/^data:[^;]*;/,"data:attachment/file;"),h?h.location.href=x:location=x,h=null},v.readAsDataURL(o)}else{var p=a.URL||a.webkitURL,g=p.createObjectURL(o);h?h.location=g:location.href=g,h=null,setTimeout(function(){p.revokeObjectURL(g)},4e4)}});a.saveAs=s.saveAs=s,typeof Ii<"u"&&(Ii.exports=s)})});var As=_e((ws,Bi)=>{(function(e){typeof ws=="object"&&typeof Bi<"u"?Bi.exports=e():typeof define=="function"&&define.amd?define([],e):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).JSZip=e()})(function(){return(function e(t,r,i){function a(o,c){if(!r[o]){if(!t[o]){var l=typeof Bt=="function"&&Bt;if(!c&&l)return l(o,!0);if(n)return n(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var d=r[o]={exports:{}};t[o][0].call(d.exports,function(u){var f=t[o][1][u];return a(f||u)},d,d.exports,e,t,r,i)}return r[o].exports}for(var n=typeof Bt=="function"&&Bt,s=0;s<i.length;s++)a(i[s]);return a})({1:[function(e,t,r){"use strict";var i=e("./utils"),a=e("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(s){for(var o,c,l,h,d,u,f,v=[],p=0,g=s.length,x=g,A=i.getTypeOf(s)!=="string";p<s.length;)x=g-p,l=A?(o=s[p++],c=p<g?s[p++]:0,p<g?s[p++]:0):(o=s.charCodeAt(p++),c=p<g?s.charCodeAt(p++):0,p<g?s.charCodeAt(p++):0),h=o>>2,d=(3&o)<<4|c>>4,u=1<x?(15&c)<<2|l>>6:64,f=2<x?63&l:64,v.push(n.charAt(h)+n.charAt(d)+n.charAt(u)+n.charAt(f));return v.join("")},r.decode=function(s){var o,c,l,h,d,u,f=0,v=0,p="data:";if(s.substr(0,p.length)===p)throw new Error("Invalid base64 input, it looks like a data url.");var g,x=3*(s=s.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(s.charAt(s.length-1)===n.charAt(64)&&x--,s.charAt(s.length-2)===n.charAt(64)&&x--,x%1!=0)throw new Error("Invalid base64 input, bad content length.");for(g=a.uint8array?new Uint8Array(0|x):new Array(0|x);f<s.length;)o=n.indexOf(s.charAt(f++))<<2|(h=n.indexOf(s.charAt(f++)))>>4,c=(15&h)<<4|(d=n.indexOf(s.charAt(f++)))>>2,l=(3&d)<<6|(u=n.indexOf(s.charAt(f++))),g[v++]=o,d!==64&&(g[v++]=c),u!==64&&(g[v++]=l);return g}},{"./support":30,"./utils":32}],2:[function(e,t,r){"use strict";var i=e("./external"),a=e("./stream/DataWorker"),n=e("./stream/Crc32Probe"),s=e("./stream/DataLengthProbe");function o(c,l,h,d,u){this.compressedSize=c,this.uncompressedSize=l,this.crc32=h,this.compression=d,this.compressedContent=u}o.prototype={getContentWorker:function(){var c=new a(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),l=this;return c.on("end",function(){if(this.streamInfo.data_length!==l.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new a(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(c,l,h){return c.pipe(new n).pipe(new s("uncompressedSize")).pipe(l.compressWorker(h)).pipe(new s("compressedSize")).withStreamInfo("compression",l)},t.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,r){"use strict";var i=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,r){"use strict";var i=e("./utils"),a=(function(){for(var n,s=[],o=0;o<256;o++){n=o;for(var c=0;c<8;c++)n=1&n?3988292384^n>>>1:n>>>1;s[o]=n}return s})();t.exports=function(n,s){return n!==void 0&&n.length?i.getTypeOf(n)!=="string"?(function(o,c,l,h){var d=a,u=h+l;o^=-1;for(var f=h;f<u;f++)o=o>>>8^d[255&(o^c[f])];return-1^o})(0|s,n,n.length,0):(function(o,c,l,h){var d=a,u=h+l;o^=-1;for(var f=h;f<u;f++)o=o>>>8^d[255&(o^c.charCodeAt(f))];return-1^o})(0|s,n,n.length,0):0}},{"./utils":32}],5:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){"use strict";var i=null;i=typeof Promise<"u"?Promise:e("lie"),t.exports={Promise:i}},{lie:37}],7:[function(e,t,r){"use strict";var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=e("pako"),n=e("./utils"),s=e("./stream/GenericWorker"),o=i?"uint8array":"array";function c(l,h){s.call(this,"FlateWorker/"+l),this._pako=null,this._pakoAction=l,this._pakoOptions=h,this.meta={}}r.magic="\b\0",n.inherits(c,s),c.prototype.processChunk=function(l){this.meta=l.meta,this._pako===null&&this._createPako(),this._pako.push(n.transformTo(o,l.data),!1)},c.prototype.flush=function(){s.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var l=this;this._pako.onData=function(h){l.push({data:h,meta:l.meta})}},r.compressWorker=function(l){return new c("Deflate",l)},r.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,r){"use strict";function i(d,u){var f,v="";for(f=0;f<u;f++)v+=String.fromCharCode(255&d),d>>>=8;return v}function a(d,u,f,v,p,g){var x,A,_=d.file,E=d.compression,S=g!==o.utf8encode,M=n.transformTo("string",g(_.name)),k=n.transformTo("string",o.utf8encode(_.name)),R=_.comment,O=n.transformTo("string",g(R)),y=n.transformTo("string",o.utf8encode(R)),T=k.length!==_.name.length,b=y.length!==R.length,I="",G="",z="",$=_.dir,U=_.date,Q={crc32:0,compressedSize:0,uncompressedSize:0};u&&!f||(Q.crc32=d.crc32,Q.compressedSize=d.compressedSize,Q.uncompressedSize=d.uncompressedSize);var L=0;u&&(L|=8),S||!T&&!b||(L|=2048);var D=0,ee=0;$&&(D|=16),p==="UNIX"?(ee=798,D|=(function(Z,ce){var fe=Z;return Z||(fe=ce?16893:33204),(65535&fe)<<16})(_.unixPermissions,$)):(ee=20,D|=(function(Z){return 63&(Z||0)})(_.dosPermissions)),x=U.getUTCHours(),x<<=6,x|=U.getUTCMinutes(),x<<=5,x|=U.getUTCSeconds()/2,A=U.getUTCFullYear()-1980,A<<=4,A|=U.getUTCMonth()+1,A<<=5,A|=U.getUTCDate(),T&&(G=i(1,1)+i(c(M),4)+k,I+="up"+i(G.length,2)+G),b&&(z=i(1,1)+i(c(O),4)+y,I+="uc"+i(z.length,2)+z);var K="";return K+=`
\0`,K+=i(L,2),K+=E.magic,K+=i(x,2),K+=i(A,2),K+=i(Q.crc32,4),K+=i(Q.compressedSize,4),K+=i(Q.uncompressedSize,4),K+=i(M.length,2),K+=i(I.length,2),{fileRecord:l.LOCAL_FILE_HEADER+K+M+I,dirRecord:l.CENTRAL_FILE_HEADER+i(ee,2)+K+i(O.length,2)+"\0\0\0\0"+i(D,4)+i(v,4)+M+I+O}}var n=e("../utils"),s=e("../stream/GenericWorker"),o=e("../utf8"),c=e("../crc32"),l=e("../signature");function h(d,u,f,v){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=u,this.zipPlatform=f,this.encodeFileName=v,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(h,s),h.prototype.push=function(d){var u=d.meta.percent||0,f=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,s.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:f?(u+100*(f-v-1))/f:100}}))},h.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var u=this.streamFiles&&!d.file.dir;if(u){var f=a(d,u,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:f.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(d){this.accumulate=!1;var u=this.streamFiles&&!d.file.dir,f=a(d,u,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(f.dirRecord),u)this.push({data:(function(v){return l.DATA_DESCRIPTOR+i(v.crc32,4)+i(v.compressedSize,4)+i(v.uncompressedSize,4)})(d),meta:{percent:100}});else for(this.push({data:f.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var d=this.bytesWritten,u=0;u<this.dirRecords.length;u++)this.push({data:this.dirRecords[u],meta:{percent:100}});var f=this.bytesWritten-d,v=(function(p,g,x,A,_){var E=n.transformTo("string",_(A));return l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(p,2)+i(p,2)+i(g,4)+i(x,4)+i(E.length,2)+E})(this.dirRecords.length,f,d,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(d){this._sources.push(d);var u=this;return d.on("data",function(f){u.processChunk(f)}),d.on("end",function(){u.closedSource(u.previous.streamInfo),u._sources.length?u.prepareNextSource():u.end()}),d.on("error",function(f){u.error(f)}),this},h.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(d){var u=this._sources;if(!s.prototype.error.call(this,d))return!1;for(var f=0;f<u.length;f++)try{u[f].error(d)}catch{}return!0},h.prototype.lock=function(){s.prototype.lock.call(this);for(var d=this._sources,u=0;u<d.length;u++)d[u].lock()},t.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,r){"use strict";var i=e("../compressions"),a=e("./ZipFileWorker");r.generateWorker=function(n,s,o){var c=new a(s.streamFiles,o,s.platform,s.encodeFileName),l=0;try{n.forEach(function(h,d){l++;var u=(function(g,x){var A=g||x,_=i[A];if(!_)throw new Error(A+" is not a valid compression method !");return _})(d.options.compression,s.compression),f=d.options.compressionOptions||s.compressionOptions||{},v=d.dir,p=d.date;d._compressWorker(u,f).withStreamInfo("file",{name:h,dir:v,date:p,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(c)}),c.entriesCount=l}catch(h){c.error(h)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,r){"use strict";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new i;for(var n in this)typeof this[n]!="function"&&(a[n]=this[n]);return a}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.10.1",i.loadAsync=function(a,n){return new i().loadAsync(a,n)},i.external=e("./external"),t.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,r){"use strict";var i=e("./utils"),a=e("./external"),n=e("./utf8"),s=e("./zipEntries"),o=e("./stream/Crc32Probe"),c=e("./nodejsUtils");function l(h){return new a.Promise(function(d,u){var f=h.decompressed.getContentWorker().pipe(new o);f.on("error",function(v){u(v)}).on("end",function(){f.streamInfo.crc32!==h.decompressed.crc32?u(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}t.exports=function(h,d){var u=this;return d=i.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),c.isNode&&c.isStream(h)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",h,!0,d.optimizedBinaryString,d.base64).then(function(f){var v=new s(d);return v.load(f),v}).then(function(f){var v=[a.Promise.resolve(f)],p=f.files;if(d.checkCRC32)for(var g=0;g<p.length;g++)v.push(l(p[g]));return a.Promise.all(v)}).then(function(f){for(var v=f.shift(),p=v.files,g=0;g<p.length;g++){var x=p[g],A=x.fileNameStr,_=i.resolve(x.fileNameStr);u.file(_,x.decompressed,{binary:!0,optimizedBinaryString:!0,date:x.date,dir:x.dir,comment:x.fileCommentStr.length?x.fileCommentStr:null,unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions,createFolders:d.createFolders}),x.dir||(u.file(_).unsafeOriginalName=A)}return v.zipComment.length&&(u.comment=v.zipComment),u})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,r){"use strict";var i=e("../utils"),a=e("../stream/GenericWorker");function n(s,o){a.call(this,"Nodejs stream input adapter for "+s),this._upstreamEnded=!1,this._bindStream(o)}i.inherits(n,a),n.prototype._bindStream=function(s){var o=this;(this._stream=s).pause(),s.on("data",function(c){o.push({data:c,meta:{percent:0}})}).on("error",function(c){o.isPaused?this.generatedError=c:o.error(c)}).on("end",function(){o.isPaused?o._upstreamEnded=!0:o.end()})},n.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,r){"use strict";var i=e("readable-stream").Readable;function a(n,s,o){i.call(this,s),this._helper=n;var c=this;n.on("data",function(l,h){c.push(l)||c._helper.pause(),o&&o(h)}).on("error",function(l){c.emit("error",l)}).on("end",function(){c.push(null)})}e("../utils").inherits(a,i),a.prototype._read=function(){this._helper.resume()},t.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,t,r){"use strict";t.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,a);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,a)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var a=new Buffer(i);return a.fill(0),a},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(e,t,r){"use strict";function i(_,E,S){var M,k=n.getTypeOf(E),R=n.extend(S||{},c);R.date=R.date||new Date,R.compression!==null&&(R.compression=R.compression.toUpperCase()),typeof R.unixPermissions=="string"&&(R.unixPermissions=parseInt(R.unixPermissions,8)),R.unixPermissions&&16384&R.unixPermissions&&(R.dir=!0),R.dosPermissions&&16&R.dosPermissions&&(R.dir=!0),R.dir&&(_=p(_)),R.createFolders&&(M=v(_))&&g.call(this,M,!0);var O=k==="string"&&R.binary===!1&&R.base64===!1;S&&S.binary!==void 0||(R.binary=!O),(E instanceof l&&E.uncompressedSize===0||R.dir||!E||E.length===0)&&(R.base64=!1,R.binary=!0,E="",R.compression="STORE",k="string");var y=null;y=E instanceof l||E instanceof s?E:u.isNode&&u.isStream(E)?new f(_,E):n.prepareContent(_,E,R.binary,R.optimizedBinaryString,R.base64);var T=new h(_,y,R);this.files[_]=T}var a=e("./utf8"),n=e("./utils"),s=e("./stream/GenericWorker"),o=e("./stream/StreamHelper"),c=e("./defaults"),l=e("./compressedObject"),h=e("./zipObject"),d=e("./generate"),u=e("./nodejsUtils"),f=e("./nodejs/NodejsStreamInputAdapter"),v=function(_){_.slice(-1)==="/"&&(_=_.substring(0,_.length-1));var E=_.lastIndexOf("/");return 0<E?_.substring(0,E):""},p=function(_){return _.slice(-1)!=="/"&&(_+="/"),_},g=function(_,E){return E=E!==void 0?E:c.createFolders,_=p(_),this.files[_]||i.call(this,_,null,{dir:!0,createFolders:E}),this.files[_]};function x(_){return Object.prototype.toString.call(_)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(_){var E,S,M;for(E in this.files)M=this.files[E],(S=E.slice(this.root.length,E.length))&&E.slice(0,this.root.length)===this.root&&_(S,M)},filter:function(_){var E=[];return this.forEach(function(S,M){_(S,M)&&E.push(M)}),E},file:function(_,E,S){if(arguments.length!==1)return _=this.root+_,i.call(this,_,E,S),this;if(x(_)){var M=_;return this.filter(function(R,O){return!O.dir&&M.test(R)})}var k=this.files[this.root+_];return k&&!k.dir?k:null},folder:function(_){if(!_)return this;if(x(_))return this.filter(function(k,R){return R.dir&&_.test(k)});var E=this.root+_,S=g.call(this,E),M=this.clone();return M.root=S.name,M},remove:function(_){_=this.root+_;var E=this.files[_];if(E||(_.slice(-1)!=="/"&&(_+="/"),E=this.files[_]),E&&!E.dir)delete this.files[_];else for(var S=this.filter(function(k,R){return R.name.slice(0,_.length)===_}),M=0;M<S.length;M++)delete this.files[S[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(_){var E,S={};try{if((S=n.extend(_||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");n.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var M=S.comment||this.comment||"";E=d.generateWorker(this,S,M)}catch(k){(E=new s("error")).error(k)}return new o(E,S.type||"string",S.mimeType)},generateAsync:function(_,E){return this.generateInternalStream(_).accumulate(E)},generateNodeStream:function(_,E){return(_=_||{}).type||(_.type="nodebuffer"),this.generateInternalStream(_).toNodejsStream(E)}};t.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,r){"use strict";t.exports=e("stream")},{stream:void 0}],17:[function(e,t,r){"use strict";var i=e("./DataReader");function a(n){i.call(this,n);for(var s=0;s<this.data.length;s++)n[s]=255&n[s]}e("../utils").inherits(a,i),a.prototype.byteAt=function(n){return this.data[this.zero+n]},a.prototype.lastIndexOfSignature=function(n){for(var s=n.charCodeAt(0),o=n.charCodeAt(1),c=n.charCodeAt(2),l=n.charCodeAt(3),h=this.length-4;0<=h;--h)if(this.data[h]===s&&this.data[h+1]===o&&this.data[h+2]===c&&this.data[h+3]===l)return h-this.zero;return-1},a.prototype.readAndCheckSignature=function(n){var s=n.charCodeAt(0),o=n.charCodeAt(1),c=n.charCodeAt(2),l=n.charCodeAt(3),h=this.readData(4);return s===h[0]&&o===h[1]&&c===h[2]&&l===h[3]},a.prototype.readData=function(n){if(this.checkOffset(n),n===0)return[];var s=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,s},t.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,t,r){"use strict";var i=e("../utils");function a(n){this.data=n,this.length=n.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(n){this.checkIndex(this.index+n)},checkIndex:function(n){if(this.length<this.zero+n||n<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+n+"). Corrupted zip ?")},setIndex:function(n){this.checkIndex(n),this.index=n},skip:function(n){this.setIndex(this.index+n)},byteAt:function(){},readInt:function(n){var s,o=0;for(this.checkOffset(n),s=this.index+n-1;s>=this.index;s--)o=(o<<8)+this.byteAt(s);return this.index+=n,o},readString:function(n){return i.transformTo("string",this.readData(n))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var n=this.readInt(4);return new Date(Date.UTC(1980+(n>>25&127),(n>>21&15)-1,n>>16&31,n>>11&31,n>>5&63,(31&n)<<1))}},t.exports=a},{"../utils":32}],19:[function(e,t,r){"use strict";var i=e("./Uint8ArrayReader");function a(n){i.call(this,n)}e("../utils").inherits(a,i),a.prototype.readData=function(n){this.checkOffset(n);var s=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,s},t.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,r){"use strict";var i=e("./DataReader");function a(n){i.call(this,n)}e("../utils").inherits(a,i),a.prototype.byteAt=function(n){return this.data.charCodeAt(this.zero+n)},a.prototype.lastIndexOfSignature=function(n){return this.data.lastIndexOf(n)-this.zero},a.prototype.readAndCheckSignature=function(n){return n===this.readData(4)},a.prototype.readData=function(n){this.checkOffset(n);var s=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,s},t.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,t,r){"use strict";var i=e("./ArrayReader");function a(n){i.call(this,n)}e("../utils").inherits(a,i),a.prototype.readData=function(n){if(this.checkOffset(n),n===0)return new Uint8Array(0);var s=this.data.subarray(this.zero+this.index,this.zero+this.index+n);return this.index+=n,s},t.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,r){"use strict";var i=e("../utils"),a=e("../support"),n=e("./ArrayReader"),s=e("./StringReader"),o=e("./NodeBufferReader"),c=e("./Uint8ArrayReader");t.exports=function(l){var h=i.getTypeOf(l);return i.checkSupport(h),h!=="string"||a.uint8array?h==="nodebuffer"?new o(l):a.uint8array?new c(i.transformTo("uint8array",l)):new n(i.transformTo("array",l)):new s(l)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,t,r){"use strict";var i=e("./GenericWorker"),a=e("../utils");function n(s){i.call(this,"ConvertWorker to "+s),this.destType=s}a.inherits(n,i),n.prototype.processChunk=function(s){this.push({data:a.transformTo(this.destType,s.data),meta:s.meta})},t.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,r){"use strict";var i=e("./GenericWorker"),a=e("../crc32");function n(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(n,i),n.prototype.processChunk=function(s){this.streamInfo.crc32=a(s.data,this.streamInfo.crc32||0),this.push(s)},t.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,r){"use strict";var i=e("../utils"),a=e("./GenericWorker");function n(s){a.call(this,"DataLengthProbe for "+s),this.propName=s,this.withStreamInfo(s,0)}i.inherits(n,a),n.prototype.processChunk=function(s){if(s){var o=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=o+s.data.length}a.prototype.processChunk.call(this,s)},t.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,r){"use strict";var i=e("../utils"),a=e("./GenericWorker");function n(s){a.call(this,"DataWorker");var o=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,s.then(function(c){o.dataIsReady=!0,o.data=c,o.max=c&&c.length||0,o.type=i.getTypeOf(c),o.isPaused||o._tickAndRepeat()},function(c){o.error(c)})}i.inherits(n,a),n.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var s=null,o=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":s=this.data.substring(this.index,o);break;case"uint8array":s=this.data.subarray(this.index,o);break;case"array":case"nodebuffer":s=this.data.slice(this.index,o)}return this.index=o,this.push({data:s,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,r){"use strict";function i(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,n){return this._listeners[a].push(n),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,n){if(this._listeners[a])for(var s=0;s<this._listeners[a].length;s++)this._listeners[a][s].call(this,n)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var n=this;return a.on("data",function(s){n.processChunk(s)}),a.on("end",function(){n.end()}),a.on("error",function(s){n.error(s)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,n){return this.extraStreamInfo[a]=n,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},t.exports=i},{}],29:[function(e,t,r){"use strict";var i=e("../utils"),a=e("./ConvertWorker"),n=e("./GenericWorker"),s=e("../base64"),o=e("../support"),c=e("../external"),l=null;if(o.nodestream)try{l=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function h(u,f){return new c.Promise(function(v,p){var g=[],x=u._internalType,A=u._outputType,_=u._mimeType;u.on("data",function(E,S){g.push(E),f&&f(S)}).on("error",function(E){g=[],p(E)}).on("end",function(){try{var E=(function(S,M,k){switch(S){case"blob":return i.newBlob(i.transformTo("arraybuffer",M),k);case"base64":return s.encode(M);default:return i.transformTo(S,M)}})(A,(function(S,M){var k,R=0,O=null,y=0;for(k=0;k<M.length;k++)y+=M[k].length;switch(S){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(O=new Uint8Array(y),k=0;k<M.length;k++)O.set(M[k],R),R+=M[k].length;return O;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+S+"'")}})(x,g),_);v(E)}catch(S){p(S)}g=[]}).resume()})}function d(u,f,v){var p=f;switch(f){case"blob":case"arraybuffer":p="uint8array";break;case"base64":p="string"}try{this._internalType=p,this._outputType=f,this._mimeType=v,i.checkSupport(p),this._worker=u.pipe(new a(p)),u.lock()}catch(g){this._worker=new n("error"),this._worker.error(g)}}d.prototype={accumulate:function(u){return h(this,u)},on:function(u,f){var v=this;return u==="data"?this._worker.on(u,function(p){f.call(v,p.data,p.meta)}):this._worker.on(u,function(){i.delay(f,arguments,v)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(u){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:this._outputType!=="nodebuffer"},u)}},t.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,r){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(i),r.blob=a.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,r){"use strict";for(var i=e("./utils"),a=e("./support"),n=e("./nodejsUtils"),s=e("./stream/GenericWorker"),o=new Array(256),c=0;c<256;c++)o[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;o[254]=o[254]=1;function l(){s.call(this,"utf-8 decode"),this.leftOver=null}function h(){s.call(this,"utf-8 encode")}r.utf8encode=function(d){return a.nodebuffer?n.newBufferFrom(d,"utf-8"):(function(u){var f,v,p,g,x,A=u.length,_=0;for(g=0;g<A;g++)(64512&(v=u.charCodeAt(g)))==55296&&g+1<A&&(64512&(p=u.charCodeAt(g+1)))==56320&&(v=65536+(v-55296<<10)+(p-56320),g++),_+=v<128?1:v<2048?2:v<65536?3:4;for(f=a.uint8array?new Uint8Array(_):new Array(_),g=x=0;x<_;g++)(64512&(v=u.charCodeAt(g)))==55296&&g+1<A&&(64512&(p=u.charCodeAt(g+1)))==56320&&(v=65536+(v-55296<<10)+(p-56320),g++),v<128?f[x++]=v:(v<2048?f[x++]=192|v>>>6:(v<65536?f[x++]=224|v>>>12:(f[x++]=240|v>>>18,f[x++]=128|v>>>12&63),f[x++]=128|v>>>6&63),f[x++]=128|63&v);return f})(d)},r.utf8decode=function(d){return a.nodebuffer?i.transformTo("nodebuffer",d).toString("utf-8"):(function(u){var f,v,p,g,x=u.length,A=new Array(2*x);for(f=v=0;f<x;)if((p=u[f++])<128)A[v++]=p;else if(4<(g=o[p]))A[v++]=65533,f+=g-1;else{for(p&=g===2?31:g===3?15:7;1<g&&f<x;)p=p<<6|63&u[f++],g--;1<g?A[v++]=65533:p<65536?A[v++]=p:(p-=65536,A[v++]=55296|p>>10&1023,A[v++]=56320|1023&p)}return A.length!==v&&(A.subarray?A=A.subarray(0,v):A.length=v),i.applyFromCharCode(A)})(d=i.transformTo(a.uint8array?"uint8array":"array",d))},i.inherits(l,s),l.prototype.processChunk=function(d){var u=i.transformTo(a.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var f=u;(u=new Uint8Array(f.length+this.leftOver.length)).set(this.leftOver,0),u.set(f,this.leftOver.length)}else u=this.leftOver.concat(u);this.leftOver=null}var v=(function(g,x){var A;for((x=x||g.length)>g.length&&(x=g.length),A=x-1;0<=A&&(192&g[A])==128;)A--;return A<0||A===0?x:A+o[g[A]]>x?A:x})(u),p=u;v!==u.length&&(a.uint8array?(p=u.subarray(0,v),this.leftOver=u.subarray(v,u.length)):(p=u.slice(0,v),this.leftOver=u.slice(v,u.length))),this.push({data:r.utf8decode(p),meta:d.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=l,i.inherits(h,s),h.prototype.processChunk=function(d){this.push({data:r.utf8encode(d.data),meta:d.meta})},r.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,r){"use strict";var i=e("./support"),a=e("./base64"),n=e("./nodejsUtils"),s=e("./external");function o(f){return f}function c(f,v){for(var p=0;p<f.length;++p)v[p]=255&f.charCodeAt(p);return v}e("setimmediate"),r.newBlob=function(f,v){r.checkSupport("blob");try{return new Blob([f],{type:v})}catch{try{var p=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return p.append(f),p.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(f,v,p){var g=[],x=0,A=f.length;if(A<=p)return String.fromCharCode.apply(null,f);for(;x<A;)v==="array"||v==="nodebuffer"?g.push(String.fromCharCode.apply(null,f.slice(x,Math.min(x+p,A)))):g.push(String.fromCharCode.apply(null,f.subarray(x,Math.min(x+p,A)))),x+=p;return g.join("")},stringifyByChar:function(f){for(var v="",p=0;p<f.length;p++)v+=String.fromCharCode(f[p]);return v},applyCanBeUsed:{uint8array:(function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,n.allocBuffer(1)).length===1}catch{return!1}})()}};function h(f){var v=65536,p=r.getTypeOf(f),g=!0;if(p==="uint8array"?g=l.applyCanBeUsed.uint8array:p==="nodebuffer"&&(g=l.applyCanBeUsed.nodebuffer),g)for(;1<v;)try{return l.stringifyByChunk(f,p,v)}catch{v=Math.floor(v/2)}return l.stringifyByChar(f)}function d(f,v){for(var p=0;p<f.length;p++)v[p]=f[p];return v}r.applyFromCharCode=h;var u={};u.string={string:o,array:function(f){return c(f,new Array(f.length))},arraybuffer:function(f){return u.string.uint8array(f).buffer},uint8array:function(f){return c(f,new Uint8Array(f.length))},nodebuffer:function(f){return c(f,n.allocBuffer(f.length))}},u.array={string:h,array:o,arraybuffer:function(f){return new Uint8Array(f).buffer},uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return n.newBufferFrom(f)}},u.arraybuffer={string:function(f){return h(new Uint8Array(f))},array:function(f){return d(new Uint8Array(f),new Array(f.byteLength))},arraybuffer:o,uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return n.newBufferFrom(new Uint8Array(f))}},u.uint8array={string:h,array:function(f){return d(f,new Array(f.length))},arraybuffer:function(f){return f.buffer},uint8array:o,nodebuffer:function(f){return n.newBufferFrom(f)}},u.nodebuffer={string:h,array:function(f){return d(f,new Array(f.length))},arraybuffer:function(f){return u.nodebuffer.uint8array(f).buffer},uint8array:function(f){return d(f,new Uint8Array(f.length))},nodebuffer:o},r.transformTo=function(f,v){if(v=v||"",!f)return v;r.checkSupport(f);var p=r.getTypeOf(v);return u[p][f](v)},r.resolve=function(f){for(var v=f.split("/"),p=[],g=0;g<v.length;g++){var x=v[g];x==="."||x===""&&g!==0&&g!==v.length-1||(x===".."?p.pop():p.push(x))}return p.join("/")},r.getTypeOf=function(f){return typeof f=="string"?"string":Object.prototype.toString.call(f)==="[object Array]"?"array":i.nodebuffer&&n.isBuffer(f)?"nodebuffer":i.uint8array&&f instanceof Uint8Array?"uint8array":i.arraybuffer&&f instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(f){if(!i[f.toLowerCase()])throw new Error(f+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(f){var v,p,g="";for(p=0;p<(f||"").length;p++)g+="\\x"+((v=f.charCodeAt(p))<16?"0":"")+v.toString(16).toUpperCase();return g},r.delay=function(f,v,p){setImmediate(function(){f.apply(p||null,v||[])})},r.inherits=function(f,v){function p(){}p.prototype=v.prototype,f.prototype=new p},r.extend=function(){var f,v,p={};for(f=0;f<arguments.length;f++)for(v in arguments[f])Object.prototype.hasOwnProperty.call(arguments[f],v)&&p[v]===void 0&&(p[v]=arguments[f][v]);return p},r.prepareContent=function(f,v,p,g,x){return s.Promise.resolve(v).then(function(A){return i.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new s.Promise(function(_,E){var S=new FileReader;S.onload=function(M){_(M.target.result)},S.onerror=function(M){E(M.target.error)},S.readAsArrayBuffer(A)}):A}).then(function(A){var _=r.getTypeOf(A);return _?(_==="arraybuffer"?A=r.transformTo("uint8array",A):_==="string"&&(x?A=a.decode(A):p&&g!==!0&&(A=(function(E){return c(E,i.uint8array?new Uint8Array(E.length):new Array(E.length))})(A))),A):s.Promise.reject(new Error("Can't read the data of '"+f+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,r){"use strict";var i=e("./reader/readerFor"),a=e("./utils"),n=e("./signature"),s=e("./zipEntry"),o=e("./support");function c(l){this.files=[],this.loadOptions=l}c.prototype={checkSignature:function(l){if(!this.reader.readAndCheckSignature(l)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(h)+", expected "+a.pretty(l)+")")}},isSignature:function(l,h){var d=this.reader.index;this.reader.setIndex(l);var u=this.reader.readString(4)===h;return this.reader.setIndex(d),u},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var l=this.reader.readData(this.zipCommentLength),h=o.uint8array?"uint8array":"array",d=a.transformTo(h,l);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var l,h,d,u=this.zip64EndOfCentralSize-44;0<u;)l=this.reader.readInt(2),h=this.reader.readInt(4),d=this.reader.readData(h),this.zip64ExtensibleData[l]={id:l,length:h,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var l,h;for(l=0;l<this.files.length;l++)h=this.files[l],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var l;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(l=new s({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(l);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var l=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(l<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(l);var h=l;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(l=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(l),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var u=h-d;if(0<u)this.isSignature(h,n.CENTRAL_FILE_HEADER)||(this.reader.zero=u);else if(u<0)throw new Error("Corrupted zip: missing "+Math.abs(u)+" bytes.")},prepareReader:function(l){this.reader=i(l)},load:function(l){this.prepareReader(l),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,r){"use strict";var i=e("./reader/readerFor"),a=e("./utils"),n=e("./compressedObject"),s=e("./crc32"),o=e("./utf8"),c=e("./compressions"),l=e("./support");function h(d,u){this.options=d,this.loadOptions=u}h.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var u,f;if(d.skip(22),this.fileNameLength=d.readInt(2),f=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(f),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((u=(function(v){for(var p in c)if(Object.prototype.hasOwnProperty.call(c,p)&&c[p].magic===v)return c[p];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,u,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var u=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(u),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=i(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var u,f,v,p=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<p;)u=d.readInt(2),f=d.readInt(2),v=d.readData(f),this.extraFields[u]={id:u,length:f,value:v};d.setIndex(p)},handleUTF8:function(){var d=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var u=this.findExtraFieldUnicodePath();if(u!==null)this.fileNameStr=u;else{var f=a.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(f)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var p=a.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(p)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var u=i(d.value);return u.readInt(1)!==1||s(this.fileName)!==u.readInt(4)?null:o.utf8decode(u.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var u=i(d.value);return u.readInt(1)!==1||s(this.fileComment)!==u.readInt(4)?null:o.utf8decode(u.readData(d.length-5))}return null}},t.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,r){"use strict";function i(u,f,v){this.name=u,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=f,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var a=e("./stream/StreamHelper"),n=e("./stream/DataWorker"),s=e("./utf8"),o=e("./compressedObject"),c=e("./stream/GenericWorker");i.prototype={internalStream:function(u){var f=null,v="string";try{if(!u)throw new Error("No output type specified.");var p=(v=u.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),f=this._decompressWorker();var g=!this._dataBinary;g&&!p&&(f=f.pipe(new s.Utf8EncodeWorker)),!g&&p&&(f=f.pipe(new s.Utf8DecodeWorker))}catch(x){(f=new c("error")).error(x)}return new a(f,v,"")},async:function(u,f){return this.internalStream(u).accumulate(f)},nodeStream:function(u,f){return this.internalStream(u||"nodebuffer").toNodejsStream(f)},_compressWorker:function(u,f){if(this._data instanceof o&&this._data.compression.magic===u.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new s.Utf8EncodeWorker)),o.createWorkerFrom(v,u,f)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof c?this._data:new n(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<l.length;d++)i.prototype[l[d]]=h;t.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,r){(function(i){"use strict";var a,n,s=i.MutationObserver||i.WebKitMutationObserver;if(s){var o=0,c=new s(u),l=i.document.createTextNode("");c.observe(l,{characterData:!0}),a=function(){l.data=o=++o%2}}else if(i.setImmediate||i.MessageChannel===void 0)a="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var f=i.document.createElement("script");f.onreadystatechange=function(){u(),f.onreadystatechange=null,f.parentNode.removeChild(f),f=null},i.document.documentElement.appendChild(f)}:function(){setTimeout(u,0)};else{var h=new i.MessageChannel;h.port1.onmessage=u,a=function(){h.port2.postMessage(0)}}var d=[];function u(){var f,v;n=!0;for(var p=d.length;p;){for(v=d,d=[],f=-1;++f<p;)v[f]();p=d.length}n=!1}t.exports=function(f){d.push(f)!==1||n||a()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,t,r){"use strict";var i=e("immediate");function a(){}var n={},s=["REJECTED"],o=["FULFILLED"],c=["PENDING"];function l(p){if(typeof p!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,p!==a&&f(this,p)}function h(p,g,x){this.promise=p,typeof g=="function"&&(this.onFulfilled=g,this.callFulfilled=this.otherCallFulfilled),typeof x=="function"&&(this.onRejected=x,this.callRejected=this.otherCallRejected)}function d(p,g,x){i(function(){var A;try{A=g(x)}catch(_){return n.reject(p,_)}A===p?n.reject(p,new TypeError("Cannot resolve promise with itself")):n.resolve(p,A)})}function u(p){var g=p&&p.then;if(p&&(typeof p=="object"||typeof p=="function")&&typeof g=="function")return function(){g.apply(p,arguments)}}function f(p,g){var x=!1;function A(S){x||(x=!0,n.reject(p,S))}function _(S){x||(x=!0,n.resolve(p,S))}var E=v(function(){g(_,A)});E.status==="error"&&A(E.value)}function v(p,g){var x={};try{x.value=p(g),x.status="success"}catch(A){x.status="error",x.value=A}return x}(t.exports=l).prototype.finally=function(p){if(typeof p!="function")return this;var g=this.constructor;return this.then(function(x){return g.resolve(p()).then(function(){return x})},function(x){return g.resolve(p()).then(function(){throw x})})},l.prototype.catch=function(p){return this.then(null,p)},l.prototype.then=function(p,g){if(typeof p!="function"&&this.state===o||typeof g!="function"&&this.state===s)return this;var x=new this.constructor(a);return this.state!==c?d(x,this.state===o?p:g,this.outcome):this.queue.push(new h(x,p,g)),x},h.prototype.callFulfilled=function(p){n.resolve(this.promise,p)},h.prototype.otherCallFulfilled=function(p){d(this.promise,this.onFulfilled,p)},h.prototype.callRejected=function(p){n.reject(this.promise,p)},h.prototype.otherCallRejected=function(p){d(this.promise,this.onRejected,p)},n.resolve=function(p,g){var x=v(u,g);if(x.status==="error")return n.reject(p,x.value);var A=x.value;if(A)f(p,A);else{p.state=o,p.outcome=g;for(var _=-1,E=p.queue.length;++_<E;)p.queue[_].callFulfilled(g)}return p},n.reject=function(p,g){p.state=s,p.outcome=g;for(var x=-1,A=p.queue.length;++x<A;)p.queue[x].callRejected(g);return p},l.resolve=function(p){return p instanceof this?p:n.resolve(new this(a),p)},l.reject=function(p){var g=new this(a);return n.reject(g,p)},l.all=function(p){var g=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=p.length,A=!1;if(!x)return this.resolve([]);for(var _=new Array(x),E=0,S=-1,M=new this(a);++S<x;)k(p[S],S);return M;function k(R,O){g.resolve(R).then(function(y){_[O]=y,++E!==x||A||(A=!0,n.resolve(M,_))},function(y){A||(A=!0,n.reject(M,y))})}},l.race=function(p){var g=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=p.length,A=!1;if(!x)return this.resolve([]);for(var _=-1,E=new this(a);++_<x;)S=p[_],g.resolve(S).then(function(M){A||(A=!0,n.resolve(E,M))},function(M){A||(A=!0,n.reject(E,M))});var S;return E}},{immediate:36}],38:[function(e,t,r){"use strict";var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,r){"use strict";var i=e("./zlib/deflate"),a=e("./utils/common"),n=e("./utils/strings"),s=e("./zlib/messages"),o=e("./zlib/zstream"),c=Object.prototype.toString,l=0,h=-1,d=0,u=8;function f(p){if(!(this instanceof f))return new f(p);this.options=a.assign({level:h,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},p||{});var g=this.options;g.raw&&0<g.windowBits?g.windowBits=-g.windowBits:g.gzip&&0<g.windowBits&&g.windowBits<16&&(g.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var x=i.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(x!==l)throw new Error(s[x]);if(g.header&&i.deflateSetHeader(this.strm,g.header),g.dictionary){var A;if(A=typeof g.dictionary=="string"?n.string2buf(g.dictionary):c.call(g.dictionary)==="[object ArrayBuffer]"?new Uint8Array(g.dictionary):g.dictionary,(x=i.deflateSetDictionary(this.strm,A))!==l)throw new Error(s[x]);this._dict_set=!0}}function v(p,g){var x=new f(g);if(x.push(p,!0),x.err)throw x.msg||s[x.err];return x.result}f.prototype.push=function(p,g){var x,A,_=this.strm,E=this.options.chunkSize;if(this.ended)return!1;A=g===~~g?g:g===!0?4:0,typeof p=="string"?_.input=n.string2buf(p):c.call(p)==="[object ArrayBuffer]"?_.input=new Uint8Array(p):_.input=p,_.next_in=0,_.avail_in=_.input.length;do{if(_.avail_out===0&&(_.output=new a.Buf8(E),_.next_out=0,_.avail_out=E),(x=i.deflate(_,A))!==1&&x!==l)return this.onEnd(x),!(this.ended=!0);_.avail_out!==0&&(_.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(n.buf2binstring(a.shrinkBuf(_.output,_.next_out))):this.onData(a.shrinkBuf(_.output,_.next_out)))}while((0<_.avail_in||_.avail_out===0)&&x!==1);return A===4?(x=i.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===l):A!==2||(this.onEnd(l),!(_.avail_out=0))},f.prototype.onData=function(p){this.chunks.push(p)},f.prototype.onEnd=function(p){p===l&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},r.Deflate=f,r.deflate=v,r.deflateRaw=function(p,g){return(g=g||{}).raw=!0,v(p,g)},r.gzip=function(p,g){return(g=g||{}).gzip=!0,v(p,g)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,r){"use strict";var i=e("./zlib/inflate"),a=e("./utils/common"),n=e("./utils/strings"),s=e("./zlib/constants"),o=e("./zlib/messages"),c=e("./zlib/zstream"),l=e("./zlib/gzheader"),h=Object.prototype.toString;function d(f){if(!(this instanceof d))return new d(f);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},f||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||f&&f.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&(15&v.windowBits)==0&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var p=i.inflateInit2(this.strm,v.windowBits);if(p!==s.Z_OK)throw new Error(o[p]);this.header=new l,i.inflateGetHeader(this.strm,this.header)}function u(f,v){var p=new d(v);if(p.push(f,!0),p.err)throw p.msg||o[p.err];return p.result}d.prototype.push=function(f,v){var p,g,x,A,_,E,S=this.strm,M=this.options.chunkSize,k=this.options.dictionary,R=!1;if(this.ended)return!1;g=v===~~v?v:v===!0?s.Z_FINISH:s.Z_NO_FLUSH,typeof f=="string"?S.input=n.binstring2buf(f):h.call(f)==="[object ArrayBuffer]"?S.input=new Uint8Array(f):S.input=f,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new a.Buf8(M),S.next_out=0,S.avail_out=M),(p=i.inflate(S,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&k&&(E=typeof k=="string"?n.string2buf(k):h.call(k)==="[object ArrayBuffer]"?new Uint8Array(k):k,p=i.inflateSetDictionary(this.strm,E)),p===s.Z_BUF_ERROR&&R===!0&&(p=s.Z_OK,R=!1),p!==s.Z_STREAM_END&&p!==s.Z_OK)return this.onEnd(p),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&p!==s.Z_STREAM_END&&(S.avail_in!==0||g!==s.Z_FINISH&&g!==s.Z_SYNC_FLUSH)||(this.options.to==="string"?(x=n.utf8border(S.output,S.next_out),A=S.next_out-x,_=n.buf2string(S.output,x),S.next_out=A,S.avail_out=M-A,A&&a.arraySet(S.output,S.output,x,A,0),this.onData(_)):this.onData(a.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(R=!0)}while((0<S.avail_in||S.avail_out===0)&&p!==s.Z_STREAM_END);return p===s.Z_STREAM_END&&(g=s.Z_FINISH),g===s.Z_FINISH?(p=i.inflateEnd(this.strm),this.onEnd(p),this.ended=!0,p===s.Z_OK):g!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),!(S.avail_out=0))},d.prototype.onData=function(f){this.chunks.push(f)},d.prototype.onEnd=function(f){f===s.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},r.Inflate=d,r.inflate=u,r.inflateRaw=function(f,v){return(v=v||{}).raw=!0,u(f,v)},r.ungzip=u},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,r){"use strict";var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(s){for(var o=Array.prototype.slice.call(arguments,1);o.length;){var c=o.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var l in c)c.hasOwnProperty(l)&&(s[l]=c[l])}}return s},r.shrinkBuf=function(s,o){return s.length===o?s:s.subarray?s.subarray(0,o):(s.length=o,s)};var a={arraySet:function(s,o,c,l,h){if(o.subarray&&s.subarray)s.set(o.subarray(c,c+l),h);else for(var d=0;d<l;d++)s[h+d]=o[c+d]},flattenChunks:function(s){var o,c,l,h,d,u;for(o=l=0,c=s.length;o<c;o++)l+=s[o].length;for(u=new Uint8Array(l),o=h=0,c=s.length;o<c;o++)d=s[o],u.set(d,h),h+=d.length;return u}},n={arraySet:function(s,o,c,l,h){for(var d=0;d<l;d++)s[h+d]=o[c+d]},flattenChunks:function(s){return[].concat.apply([],s)}};r.setTyped=function(s){s?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,a)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,n))},r.setTyped(i)},{}],42:[function(e,t,r){"use strict";var i=e("./common"),a=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n=!1}for(var s=new i.Buf8(256),o=0;o<256;o++)s[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;function c(l,h){if(h<65537&&(l.subarray&&n||!l.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(l,h));for(var d="",u=0;u<h;u++)d+=String.fromCharCode(l[u]);return d}s[254]=s[254]=1,r.string2buf=function(l){var h,d,u,f,v,p=l.length,g=0;for(f=0;f<p;f++)(64512&(d=l.charCodeAt(f)))==55296&&f+1<p&&(64512&(u=l.charCodeAt(f+1)))==56320&&(d=65536+(d-55296<<10)+(u-56320),f++),g+=d<128?1:d<2048?2:d<65536?3:4;for(h=new i.Buf8(g),f=v=0;v<g;f++)(64512&(d=l.charCodeAt(f)))==55296&&f+1<p&&(64512&(u=l.charCodeAt(f+1)))==56320&&(d=65536+(d-55296<<10)+(u-56320),f++),d<128?h[v++]=d:(d<2048?h[v++]=192|d>>>6:(d<65536?h[v++]=224|d>>>12:(h[v++]=240|d>>>18,h[v++]=128|d>>>12&63),h[v++]=128|d>>>6&63),h[v++]=128|63&d);return h},r.buf2binstring=function(l){return c(l,l.length)},r.binstring2buf=function(l){for(var h=new i.Buf8(l.length),d=0,u=h.length;d<u;d++)h[d]=l.charCodeAt(d);return h},r.buf2string=function(l,h){var d,u,f,v,p=h||l.length,g=new Array(2*p);for(d=u=0;d<p;)if((f=l[d++])<128)g[u++]=f;else if(4<(v=s[f]))g[u++]=65533,d+=v-1;else{for(f&=v===2?31:v===3?15:7;1<v&&d<p;)f=f<<6|63&l[d++],v--;1<v?g[u++]=65533:f<65536?g[u++]=f:(f-=65536,g[u++]=55296|f>>10&1023,g[u++]=56320|1023&f)}return c(g,u)},r.utf8border=function(l,h){var d;for((h=h||l.length)>l.length&&(h=l.length),d=h-1;0<=d&&(192&l[d])==128;)d--;return d<0||d===0?h:d+s[l[d]]>h?d:h}},{"./common":41}],43:[function(e,t,r){"use strict";t.exports=function(i,a,n,s){for(var o=65535&i|0,c=i>>>16&65535|0,l=0;n!==0;){for(n-=l=2e3<n?2e3:n;c=c+(o=o+a[s++]|0)|0,--l;);o%=65521,c%=65521}return o|c<<16|0}},{}],44:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){"use strict";var i=(function(){for(var a,n=[],s=0;s<256;s++){a=s;for(var o=0;o<8;o++)a=1&a?3988292384^a>>>1:a>>>1;n[s]=a}return n})();t.exports=function(a,n,s,o){var c=i,l=o+s;a^=-1;for(var h=o;h<l;h++)a=a>>>8^c[255&(a^n[h])];return-1^a}},{}],46:[function(e,t,r){"use strict";var i,a=e("../utils/common"),n=e("./trees"),s=e("./adler32"),o=e("./crc32"),c=e("./messages"),l=0,h=4,d=0,u=-2,f=-1,v=4,p=2,g=8,x=9,A=286,_=30,E=19,S=2*A+1,M=15,k=3,R=258,O=R+k+1,y=42,T=113,b=1,I=2,G=3,z=4;function $(m,N){return m.msg=c[N],N}function U(m){return(m<<1)-(4<m?9:0)}function Q(m){for(var N=m.length;0<=--N;)m[N]=0}function L(m){var N=m.state,F=N.pending;F>m.avail_out&&(F=m.avail_out),F!==0&&(a.arraySet(m.output,N.pending_buf,N.pending_out,F,m.next_out),m.next_out+=F,N.pending_out+=F,m.total_out+=F,m.avail_out-=F,N.pending-=F,N.pending===0&&(N.pending_out=0))}function D(m,N){n._tr_flush_block(m,0<=m.block_start?m.block_start:-1,m.strstart-m.block_start,N),m.block_start=m.strstart,L(m.strm)}function ee(m,N){m.pending_buf[m.pending++]=N}function K(m,N){m.pending_buf[m.pending++]=N>>>8&255,m.pending_buf[m.pending++]=255&N}function Z(m,N){var F,C,w=m.max_chain_length,P=m.strstart,H=m.prev_length,W=m.nice_match,B=m.strstart>m.w_size-O?m.strstart-(m.w_size-O):0,j=m.window,X=m.w_mask,Y=m.prev,te=m.strstart+R,de=j[P+H-1],oe=j[P+H];m.prev_length>=m.good_match&&(w>>=2),W>m.lookahead&&(W=m.lookahead);do if(j[(F=N)+H]===oe&&j[F+H-1]===de&&j[F]===j[P]&&j[++F]===j[P+1]){P+=2,F++;do;while(j[++P]===j[++F]&&j[++P]===j[++F]&&j[++P]===j[++F]&&j[++P]===j[++F]&&j[++P]===j[++F]&&j[++P]===j[++F]&&j[++P]===j[++F]&&j[++P]===j[++F]&&P<te);if(C=R-(te-P),P=te-R,H<C){if(m.match_start=N,W<=(H=C))break;de=j[P+H-1],oe=j[P+H]}}while((N=Y[N&X])>B&&--w!=0);return H<=m.lookahead?H:m.lookahead}function ce(m){var N,F,C,w,P,H,W,B,j,X,Y=m.w_size;do{if(w=m.window_size-m.lookahead-m.strstart,m.strstart>=Y+(Y-O)){for(a.arraySet(m.window,m.window,Y,Y,0),m.match_start-=Y,m.strstart-=Y,m.block_start-=Y,N=F=m.hash_size;C=m.head[--N],m.head[N]=Y<=C?C-Y:0,--F;);for(N=F=Y;C=m.prev[--N],m.prev[N]=Y<=C?C-Y:0,--F;);w+=Y}if(m.strm.avail_in===0)break;if(H=m.strm,W=m.window,B=m.strstart+m.lookahead,j=w,X=void 0,X=H.avail_in,j<X&&(X=j),F=X===0?0:(H.avail_in-=X,a.arraySet(W,H.input,H.next_in,X,B),H.state.wrap===1?H.adler=s(H.adler,W,X,B):H.state.wrap===2&&(H.adler=o(H.adler,W,X,B)),H.next_in+=X,H.total_in+=X,X),m.lookahead+=F,m.lookahead+m.insert>=k)for(P=m.strstart-m.insert,m.ins_h=m.window[P],m.ins_h=(m.ins_h<<m.hash_shift^m.window[P+1])&m.hash_mask;m.insert&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[P+k-1])&m.hash_mask,m.prev[P&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=P,P++,m.insert--,!(m.lookahead+m.insert<k)););}while(m.lookahead<O&&m.strm.avail_in!==0)}function fe(m,N){for(var F,C;;){if(m.lookahead<O){if(ce(m),m.lookahead<O&&N===l)return b;if(m.lookahead===0)break}if(F=0,m.lookahead>=k&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+k-1])&m.hash_mask,F=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),F!==0&&m.strstart-F<=m.w_size-O&&(m.match_length=Z(m,F)),m.match_length>=k)if(C=n._tr_tally(m,m.strstart-m.match_start,m.match_length-k),m.lookahead-=m.match_length,m.match_length<=m.max_lazy_match&&m.lookahead>=k){for(m.match_length--;m.strstart++,m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+k-1])&m.hash_mask,F=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart,--m.match_length!=0;);m.strstart++}else m.strstart+=m.match_length,m.match_length=0,m.ins_h=m.window[m.strstart],m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+1])&m.hash_mask;else C=n._tr_tally(m,0,m.window[m.strstart]),m.lookahead--,m.strstart++;if(C&&(D(m,!1),m.strm.avail_out===0))return b}return m.insert=m.strstart<k-1?m.strstart:k-1,N===h?(D(m,!0),m.strm.avail_out===0?G:z):m.last_lit&&(D(m,!1),m.strm.avail_out===0)?b:I}function ne(m,N){for(var F,C,w;;){if(m.lookahead<O){if(ce(m),m.lookahead<O&&N===l)return b;if(m.lookahead===0)break}if(F=0,m.lookahead>=k&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+k-1])&m.hash_mask,F=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),m.prev_length=m.match_length,m.prev_match=m.match_start,m.match_length=k-1,F!==0&&m.prev_length<m.max_lazy_match&&m.strstart-F<=m.w_size-O&&(m.match_length=Z(m,F),m.match_length<=5&&(m.strategy===1||m.match_length===k&&4096<m.strstart-m.match_start)&&(m.match_length=k-1)),m.prev_length>=k&&m.match_length<=m.prev_length){for(w=m.strstart+m.lookahead-k,C=n._tr_tally(m,m.strstart-1-m.prev_match,m.prev_length-k),m.lookahead-=m.prev_length-1,m.prev_length-=2;++m.strstart<=w&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+k-1])&m.hash_mask,F=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),--m.prev_length!=0;);if(m.match_available=0,m.match_length=k-1,m.strstart++,C&&(D(m,!1),m.strm.avail_out===0))return b}else if(m.match_available){if((C=n._tr_tally(m,0,m.window[m.strstart-1]))&&D(m,!1),m.strstart++,m.lookahead--,m.strm.avail_out===0)return b}else m.match_available=1,m.strstart++,m.lookahead--}return m.match_available&&(C=n._tr_tally(m,0,m.window[m.strstart-1]),m.match_available=0),m.insert=m.strstart<k-1?m.strstart:k-1,N===h?(D(m,!0),m.strm.avail_out===0?G:z):m.last_lit&&(D(m,!1),m.strm.avail_out===0)?b:I}function ae(m,N,F,C,w){this.good_length=m,this.max_lazy=N,this.nice_length=F,this.max_chain=C,this.func=w}function be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*S),this.dyn_dtree=new a.Buf16(2*(2*_+1)),this.bl_tree=new a.Buf16(2*(2*E+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(M+1),this.heap=new a.Buf16(2*A+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*A+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(m){var N;return m&&m.state?(m.total_in=m.total_out=0,m.data_type=p,(N=m.state).pending=0,N.pending_out=0,N.wrap<0&&(N.wrap=-N.wrap),N.status=N.wrap?y:T,m.adler=N.wrap===2?0:1,N.last_flush=l,n._tr_init(N),d):$(m,u)}function ye(m){var N=pe(m);return N===d&&(function(F){F.window_size=2*F.w_size,Q(F.head),F.max_lazy_match=i[F.level].max_lazy,F.good_match=i[F.level].good_length,F.nice_match=i[F.level].nice_length,F.max_chain_length=i[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=k-1,F.match_available=0,F.ins_h=0})(m.state),N}function Ae(m,N,F,C,w,P){if(!m)return u;var H=1;if(N===f&&(N=6),C<0?(H=0,C=-C):15<C&&(H=2,C-=16),w<1||x<w||F!==g||C<8||15<C||N<0||9<N||P<0||v<P)return $(m,u);C===8&&(C=9);var W=new be;return(m.state=W).strm=m,W.wrap=H,W.gzhead=null,W.w_bits=C,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=w+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+k-1)/k),W.window=new a.Buf8(2*W.w_size),W.head=new a.Buf16(W.hash_size),W.prev=new a.Buf16(W.w_size),W.lit_bufsize=1<<w+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new a.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=N,W.strategy=P,W.method=F,ye(m)}i=[new ae(0,0,0,0,function(m,N){var F=65535;for(F>m.pending_buf_size-5&&(F=m.pending_buf_size-5);;){if(m.lookahead<=1){if(ce(m),m.lookahead===0&&N===l)return b;if(m.lookahead===0)break}m.strstart+=m.lookahead,m.lookahead=0;var C=m.block_start+F;if((m.strstart===0||m.strstart>=C)&&(m.lookahead=m.strstart-C,m.strstart=C,D(m,!1),m.strm.avail_out===0)||m.strstart-m.block_start>=m.w_size-O&&(D(m,!1),m.strm.avail_out===0))return b}return m.insert=0,N===h?(D(m,!0),m.strm.avail_out===0?G:z):(m.strstart>m.block_start&&(D(m,!1),m.strm.avail_out),b)}),new ae(4,4,8,4,fe),new ae(4,5,16,8,fe),new ae(4,6,32,32,fe),new ae(4,4,16,16,ne),new ae(8,16,32,32,ne),new ae(8,16,128,128,ne),new ae(8,32,128,256,ne),new ae(32,128,258,1024,ne),new ae(32,258,258,4096,ne)],r.deflateInit=function(m,N){return Ae(m,N,g,15,8,0)},r.deflateInit2=Ae,r.deflateReset=ye,r.deflateResetKeep=pe,r.deflateSetHeader=function(m,N){return m&&m.state?m.state.wrap!==2?u:(m.state.gzhead=N,d):u},r.deflate=function(m,N){var F,C,w,P;if(!m||!m.state||5<N||N<0)return m?$(m,u):u;if(C=m.state,!m.output||!m.input&&m.avail_in!==0||C.status===666&&N!==h)return $(m,m.avail_out===0?-5:u);if(C.strm=m,F=C.last_flush,C.last_flush=N,C.status===y)if(C.wrap===2)m.adler=0,ee(C,31),ee(C,139),ee(C,8),C.gzhead?(ee(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),ee(C,255&C.gzhead.time),ee(C,C.gzhead.time>>8&255),ee(C,C.gzhead.time>>16&255),ee(C,C.gzhead.time>>24&255),ee(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),ee(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(ee(C,255&C.gzhead.extra.length),ee(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(m.adler=o(m.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(ee(C,0),ee(C,0),ee(C,0),ee(C,0),ee(C,0),ee(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),ee(C,3),C.status=T);else{var H=g+(C.w_bits-8<<4)<<8;H|=(2<=C.strategy||C.level<2?0:C.level<6?1:C.level===6?2:3)<<6,C.strstart!==0&&(H|=32),H+=31-H%31,C.status=T,K(C,H),C.strstart!==0&&(K(C,m.adler>>>16),K(C,65535&m.adler)),m.adler=1}if(C.status===69)if(C.gzhead.extra){for(w=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>w&&(m.adler=o(m.adler,C.pending_buf,C.pending-w,w)),L(m),w=C.pending,C.pending!==C.pending_buf_size));)ee(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>w&&(m.adler=o(m.adler,C.pending_buf,C.pending-w,w)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(C.status===73)if(C.gzhead.name){w=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>w&&(m.adler=o(m.adler,C.pending_buf,C.pending-w,w)),L(m),w=C.pending,C.pending===C.pending_buf_size)){P=1;break}P=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,ee(C,P)}while(P!==0);C.gzhead.hcrc&&C.pending>w&&(m.adler=o(m.adler,C.pending_buf,C.pending-w,w)),P===0&&(C.gzindex=0,C.status=91)}else C.status=91;if(C.status===91)if(C.gzhead.comment){w=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>w&&(m.adler=o(m.adler,C.pending_buf,C.pending-w,w)),L(m),w=C.pending,C.pending===C.pending_buf_size)){P=1;break}P=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,ee(C,P)}while(P!==0);C.gzhead.hcrc&&C.pending>w&&(m.adler=o(m.adler,C.pending_buf,C.pending-w,w)),P===0&&(C.status=103)}else C.status=103;if(C.status===103&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&L(m),C.pending+2<=C.pending_buf_size&&(ee(C,255&m.adler),ee(C,m.adler>>8&255),m.adler=0,C.status=T)):C.status=T),C.pending!==0){if(L(m),m.avail_out===0)return C.last_flush=-1,d}else if(m.avail_in===0&&U(N)<=U(F)&&N!==h)return $(m,-5);if(C.status===666&&m.avail_in!==0)return $(m,-5);if(m.avail_in!==0||C.lookahead!==0||N!==l&&C.status!==666){var W=C.strategy===2?(function(B,j){for(var X;;){if(B.lookahead===0&&(ce(B),B.lookahead===0)){if(j===l)return b;break}if(B.match_length=0,X=n._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++,X&&(D(B,!1),B.strm.avail_out===0))return b}return B.insert=0,j===h?(D(B,!0),B.strm.avail_out===0?G:z):B.last_lit&&(D(B,!1),B.strm.avail_out===0)?b:I})(C,N):C.strategy===3?(function(B,j){for(var X,Y,te,de,oe=B.window;;){if(B.lookahead<=R){if(ce(B),B.lookahead<=R&&j===l)return b;if(B.lookahead===0)break}if(B.match_length=0,B.lookahead>=k&&0<B.strstart&&(Y=oe[te=B.strstart-1])===oe[++te]&&Y===oe[++te]&&Y===oe[++te]){de=B.strstart+R;do;while(Y===oe[++te]&&Y===oe[++te]&&Y===oe[++te]&&Y===oe[++te]&&Y===oe[++te]&&Y===oe[++te]&&Y===oe[++te]&&Y===oe[++te]&&te<de);B.match_length=R-(de-te),B.match_length>B.lookahead&&(B.match_length=B.lookahead)}if(B.match_length>=k?(X=n._tr_tally(B,1,B.match_length-k),B.lookahead-=B.match_length,B.strstart+=B.match_length,B.match_length=0):(X=n._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++),X&&(D(B,!1),B.strm.avail_out===0))return b}return B.insert=0,j===h?(D(B,!0),B.strm.avail_out===0?G:z):B.last_lit&&(D(B,!1),B.strm.avail_out===0)?b:I})(C,N):i[C.level].func(C,N);if(W!==G&&W!==z||(C.status=666),W===b||W===G)return m.avail_out===0&&(C.last_flush=-1),d;if(W===I&&(N===1?n._tr_align(C):N!==5&&(n._tr_stored_block(C,0,0,!1),N===3&&(Q(C.head),C.lookahead===0&&(C.strstart=0,C.block_start=0,C.insert=0))),L(m),m.avail_out===0))return C.last_flush=-1,d}return N!==h?d:C.wrap<=0?1:(C.wrap===2?(ee(C,255&m.adler),ee(C,m.adler>>8&255),ee(C,m.adler>>16&255),ee(C,m.adler>>24&255),ee(C,255&m.total_in),ee(C,m.total_in>>8&255),ee(C,m.total_in>>16&255),ee(C,m.total_in>>24&255)):(K(C,m.adler>>>16),K(C,65535&m.adler)),L(m),0<C.wrap&&(C.wrap=-C.wrap),C.pending!==0?d:1)},r.deflateEnd=function(m){var N;return m&&m.state?(N=m.state.status)!==y&&N!==69&&N!==73&&N!==91&&N!==103&&N!==T&&N!==666?$(m,u):(m.state=null,N===T?$(m,-3):d):u},r.deflateSetDictionary=function(m,N){var F,C,w,P,H,W,B,j,X=N.length;if(!m||!m.state||(P=(F=m.state).wrap)===2||P===1&&F.status!==y||F.lookahead)return u;for(P===1&&(m.adler=s(m.adler,N,X,0)),F.wrap=0,X>=F.w_size&&(P===0&&(Q(F.head),F.strstart=0,F.block_start=0,F.insert=0),j=new a.Buf8(F.w_size),a.arraySet(j,N,X-F.w_size,F.w_size,0),N=j,X=F.w_size),H=m.avail_in,W=m.next_in,B=m.input,m.avail_in=X,m.next_in=0,m.input=N,ce(F);F.lookahead>=k;){for(C=F.strstart,w=F.lookahead-(k-1);F.ins_h=(F.ins_h<<F.hash_shift^F.window[C+k-1])&F.hash_mask,F.prev[C&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=C,C++,--w;);F.strstart=C,F.lookahead=k-1,ce(F)}return F.strstart+=F.lookahead,F.block_start=F.strstart,F.insert=F.lookahead,F.lookahead=0,F.match_length=F.prev_length=k-1,F.match_available=0,m.next_in=W,m.input=B,m.avail_in=H,F.wrap=P,d},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,r){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){"use strict";t.exports=function(i,a){var n,s,o,c,l,h,d,u,f,v,p,g,x,A,_,E,S,M,k,R,O,y,T,b,I;n=i.state,s=i.next_in,b=i.input,o=s+(i.avail_in-5),c=i.next_out,I=i.output,l=c-(a-i.avail_out),h=c+(i.avail_out-257),d=n.dmax,u=n.wsize,f=n.whave,v=n.wnext,p=n.window,g=n.hold,x=n.bits,A=n.lencode,_=n.distcode,E=(1<<n.lenbits)-1,S=(1<<n.distbits)-1;e:do{x<15&&(g+=b[s++]<<x,x+=8,g+=b[s++]<<x,x+=8),M=A[g&E];t:for(;;){if(g>>>=k=M>>>24,x-=k,(k=M>>>16&255)===0)I[c++]=65535&M;else{if(!(16&k)){if((64&k)==0){M=A[(65535&M)+(g&(1<<k)-1)];continue t}if(32&k){n.mode=12;break e}i.msg="invalid literal/length code",n.mode=30;break e}R=65535&M,(k&=15)&&(x<k&&(g+=b[s++]<<x,x+=8),R+=g&(1<<k)-1,g>>>=k,x-=k),x<15&&(g+=b[s++]<<x,x+=8,g+=b[s++]<<x,x+=8),M=_[g&S];r:for(;;){if(g>>>=k=M>>>24,x-=k,!(16&(k=M>>>16&255))){if((64&k)==0){M=_[(65535&M)+(g&(1<<k)-1)];continue r}i.msg="invalid distance code",n.mode=30;break e}if(O=65535&M,x<(k&=15)&&(g+=b[s++]<<x,(x+=8)<k&&(g+=b[s++]<<x,x+=8)),d<(O+=g&(1<<k)-1)){i.msg="invalid distance too far back",n.mode=30;break e}if(g>>>=k,x-=k,(k=c-l)<O){if(f<(k=O-k)&&n.sane){i.msg="invalid distance too far back",n.mode=30;break e}if(T=p,(y=0)===v){if(y+=u-k,k<R){for(R-=k;I[c++]=p[y++],--k;);y=c-O,T=I}}else if(v<k){if(y+=u+v-k,(k-=v)<R){for(R-=k;I[c++]=p[y++],--k;);if(y=0,v<R){for(R-=k=v;I[c++]=p[y++],--k;);y=c-O,T=I}}}else if(y+=v-k,k<R){for(R-=k;I[c++]=p[y++],--k;);y=c-O,T=I}for(;2<R;)I[c++]=T[y++],I[c++]=T[y++],I[c++]=T[y++],R-=3;R&&(I[c++]=T[y++],1<R&&(I[c++]=T[y++]))}else{for(y=c-O;I[c++]=I[y++],I[c++]=I[y++],I[c++]=I[y++],2<(R-=3););R&&(I[c++]=I[y++],1<R&&(I[c++]=I[y++]))}break}}break}}while(s<o&&c<h);s-=R=x>>3,g&=(1<<(x-=R<<3))-1,i.next_in=s,i.next_out=c,i.avail_in=s<o?o-s+5:5-(s-o),i.avail_out=c<h?h-c+257:257-(c-h),n.hold=g,n.bits=x}},{}],49:[function(e,t,r){"use strict";var i=e("../utils/common"),a=e("./adler32"),n=e("./crc32"),s=e("./inffast"),o=e("./inftrees"),c=1,l=2,h=0,d=-2,u=1,f=852,v=592;function p(y){return(y>>>24&255)+(y>>>8&65280)+((65280&y)<<8)+((255&y)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function x(y){var T;return y&&y.state?(T=y.state,y.total_in=y.total_out=T.total=0,y.msg="",T.wrap&&(y.adler=1&T.wrap),T.mode=u,T.last=0,T.havedict=0,T.dmax=32768,T.head=null,T.hold=0,T.bits=0,T.lencode=T.lendyn=new i.Buf32(f),T.distcode=T.distdyn=new i.Buf32(v),T.sane=1,T.back=-1,h):d}function A(y){var T;return y&&y.state?((T=y.state).wsize=0,T.whave=0,T.wnext=0,x(y)):d}function _(y,T){var b,I;return y&&y.state?(I=y.state,T<0?(b=0,T=-T):(b=1+(T>>4),T<48&&(T&=15)),T&&(T<8||15<T)?d:(I.window!==null&&I.wbits!==T&&(I.window=null),I.wrap=b,I.wbits=T,A(y))):d}function E(y,T){var b,I;return y?(I=new g,(y.state=I).window=null,(b=_(y,T))!==h&&(y.state=null),b):d}var S,M,k=!0;function R(y){if(k){var T;for(S=new i.Buf32(512),M=new i.Buf32(32),T=0;T<144;)y.lens[T++]=8;for(;T<256;)y.lens[T++]=9;for(;T<280;)y.lens[T++]=7;for(;T<288;)y.lens[T++]=8;for(o(c,y.lens,0,288,S,0,y.work,{bits:9}),T=0;T<32;)y.lens[T++]=5;o(l,y.lens,0,32,M,0,y.work,{bits:5}),k=!1}y.lencode=S,y.lenbits=9,y.distcode=M,y.distbits=5}function O(y,T,b,I){var G,z=y.state;return z.window===null&&(z.wsize=1<<z.wbits,z.wnext=0,z.whave=0,z.window=new i.Buf8(z.wsize)),I>=z.wsize?(i.arraySet(z.window,T,b-z.wsize,z.wsize,0),z.wnext=0,z.whave=z.wsize):(I<(G=z.wsize-z.wnext)&&(G=I),i.arraySet(z.window,T,b-I,G,z.wnext),(I-=G)?(i.arraySet(z.window,T,b-I,I,0),z.wnext=I,z.whave=z.wsize):(z.wnext+=G,z.wnext===z.wsize&&(z.wnext=0),z.whave<z.wsize&&(z.whave+=G))),0}r.inflateReset=A,r.inflateReset2=_,r.inflateResetKeep=x,r.inflateInit=function(y){return E(y,15)},r.inflateInit2=E,r.inflate=function(y,T){var b,I,G,z,$,U,Q,L,D,ee,K,Z,ce,fe,ne,ae,be,pe,ye,Ae,m,N,F,C,w=0,P=new i.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!y||!y.state||!y.output||!y.input&&y.avail_in!==0)return d;(b=y.state).mode===12&&(b.mode=13),$=y.next_out,G=y.output,Q=y.avail_out,z=y.next_in,I=y.input,U=y.avail_in,L=b.hold,D=b.bits,ee=U,K=Q,N=h;e:for(;;)switch(b.mode){case u:if(b.wrap===0){b.mode=13;break}for(;D<16;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}if(2&b.wrap&&L===35615){P[b.check=0]=255&L,P[1]=L>>>8&255,b.check=n(b.check,P,2,0),D=L=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&L)<<8)+(L>>8))%31){y.msg="incorrect header check",b.mode=30;break}if((15&L)!=8){y.msg="unknown compression method",b.mode=30;break}if(D-=4,m=8+(15&(L>>>=4)),b.wbits===0)b.wbits=m;else if(m>b.wbits){y.msg="invalid window size",b.mode=30;break}b.dmax=1<<m,y.adler=b.check=1,b.mode=512&L?10:12,D=L=0;break;case 2:for(;D<16;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}if(b.flags=L,(255&b.flags)!=8){y.msg="unknown compression method",b.mode=30;break}if(57344&b.flags){y.msg="unknown header flags set",b.mode=30;break}b.head&&(b.head.text=L>>8&1),512&b.flags&&(P[0]=255&L,P[1]=L>>>8&255,b.check=n(b.check,P,2,0)),D=L=0,b.mode=3;case 3:for(;D<32;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}b.head&&(b.head.time=L),512&b.flags&&(P[0]=255&L,P[1]=L>>>8&255,P[2]=L>>>16&255,P[3]=L>>>24&255,b.check=n(b.check,P,4,0)),D=L=0,b.mode=4;case 4:for(;D<16;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}b.head&&(b.head.xflags=255&L,b.head.os=L>>8),512&b.flags&&(P[0]=255&L,P[1]=L>>>8&255,b.check=n(b.check,P,2,0)),D=L=0,b.mode=5;case 5:if(1024&b.flags){for(;D<16;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}b.length=L,b.head&&(b.head.extra_len=L),512&b.flags&&(P[0]=255&L,P[1]=L>>>8&255,b.check=n(b.check,P,2,0)),D=L=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(U<(Z=b.length)&&(Z=U),Z&&(b.head&&(m=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Array(b.head.extra_len)),i.arraySet(b.head.extra,I,z,Z,m)),512&b.flags&&(b.check=n(b.check,I,Z,z)),U-=Z,z+=Z,b.length-=Z),b.length))break e;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(U===0)break e;for(Z=0;m=I[z+Z++],b.head&&m&&b.length<65536&&(b.head.name+=String.fromCharCode(m)),m&&Z<U;);if(512&b.flags&&(b.check=n(b.check,I,Z,z)),U-=Z,z+=Z,m)break e}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(U===0)break e;for(Z=0;m=I[z+Z++],b.head&&m&&b.length<65536&&(b.head.comment+=String.fromCharCode(m)),m&&Z<U;);if(512&b.flags&&(b.check=n(b.check,I,Z,z)),U-=Z,z+=Z,m)break e}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;D<16;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}if(L!==(65535&b.check)){y.msg="header crc mismatch",b.mode=30;break}D=L=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),y.adler=b.check=0,b.mode=12;break;case 10:for(;D<32;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}y.adler=b.check=p(L),D=L=0,b.mode=11;case 11:if(b.havedict===0)return y.next_out=$,y.avail_out=Q,y.next_in=z,y.avail_in=U,b.hold=L,b.bits=D,2;y.adler=b.check=1,b.mode=12;case 12:if(T===5||T===6)break e;case 13:if(b.last){L>>>=7&D,D-=7&D,b.mode=27;break}for(;D<3;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}switch(b.last=1&L,D-=1,3&(L>>>=1)){case 0:b.mode=14;break;case 1:if(R(b),b.mode=20,T!==6)break;L>>>=2,D-=2;break e;case 2:b.mode=17;break;case 3:y.msg="invalid block type",b.mode=30}L>>>=2,D-=2;break;case 14:for(L>>>=7&D,D-=7&D;D<32;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}if((65535&L)!=(L>>>16^65535)){y.msg="invalid stored block lengths",b.mode=30;break}if(b.length=65535&L,D=L=0,b.mode=15,T===6)break e;case 15:b.mode=16;case 16:if(Z=b.length){if(U<Z&&(Z=U),Q<Z&&(Z=Q),Z===0)break e;i.arraySet(G,I,z,Z,$),U-=Z,z+=Z,Q-=Z,$+=Z,b.length-=Z;break}b.mode=12;break;case 17:for(;D<14;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}if(b.nlen=257+(31&L),L>>>=5,D-=5,b.ndist=1+(31&L),L>>>=5,D-=5,b.ncode=4+(15&L),L>>>=4,D-=4,286<b.nlen||30<b.ndist){y.msg="too many length or distance symbols",b.mode=30;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;D<3;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}b.lens[H[b.have++]]=7&L,L>>>=3,D-=3}for(;b.have<19;)b.lens[H[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,F={bits:b.lenbits},N=o(0,b.lens,0,19,b.lencode,0,b.work,F),b.lenbits=F.bits,N){y.msg="invalid code lengths set",b.mode=30;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;ae=(w=b.lencode[L&(1<<b.lenbits)-1])>>>16&255,be=65535&w,!((ne=w>>>24)<=D);){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}if(be<16)L>>>=ne,D-=ne,b.lens[b.have++]=be;else{if(be===16){for(C=ne+2;D<C;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}if(L>>>=ne,D-=ne,b.have===0){y.msg="invalid bit length repeat",b.mode=30;break}m=b.lens[b.have-1],Z=3+(3&L),L>>>=2,D-=2}else if(be===17){for(C=ne+3;D<C;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}D-=ne,m=0,Z=3+(7&(L>>>=ne)),L>>>=3,D-=3}else{for(C=ne+7;D<C;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}D-=ne,m=0,Z=11+(127&(L>>>=ne)),L>>>=7,D-=7}if(b.have+Z>b.nlen+b.ndist){y.msg="invalid bit length repeat",b.mode=30;break}for(;Z--;)b.lens[b.have++]=m}}if(b.mode===30)break;if(b.lens[256]===0){y.msg="invalid code -- missing end-of-block",b.mode=30;break}if(b.lenbits=9,F={bits:b.lenbits},N=o(c,b.lens,0,b.nlen,b.lencode,0,b.work,F),b.lenbits=F.bits,N){y.msg="invalid literal/lengths set",b.mode=30;break}if(b.distbits=6,b.distcode=b.distdyn,F={bits:b.distbits},N=o(l,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,F),b.distbits=F.bits,N){y.msg="invalid distances set",b.mode=30;break}if(b.mode=20,T===6)break e;case 20:b.mode=21;case 21:if(6<=U&&258<=Q){y.next_out=$,y.avail_out=Q,y.next_in=z,y.avail_in=U,b.hold=L,b.bits=D,s(y,K),$=y.next_out,G=y.output,Q=y.avail_out,z=y.next_in,I=y.input,U=y.avail_in,L=b.hold,D=b.bits,b.mode===12&&(b.back=-1);break}for(b.back=0;ae=(w=b.lencode[L&(1<<b.lenbits)-1])>>>16&255,be=65535&w,!((ne=w>>>24)<=D);){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}if(ae&&(240&ae)==0){for(pe=ne,ye=ae,Ae=be;ae=(w=b.lencode[Ae+((L&(1<<pe+ye)-1)>>pe)])>>>16&255,be=65535&w,!(pe+(ne=w>>>24)<=D);){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}L>>>=pe,D-=pe,b.back+=pe}if(L>>>=ne,D-=ne,b.back+=ne,b.length=be,ae===0){b.mode=26;break}if(32&ae){b.back=-1,b.mode=12;break}if(64&ae){y.msg="invalid literal/length code",b.mode=30;break}b.extra=15&ae,b.mode=22;case 22:if(b.extra){for(C=b.extra;D<C;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}b.length+=L&(1<<b.extra)-1,L>>>=b.extra,D-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;ae=(w=b.distcode[L&(1<<b.distbits)-1])>>>16&255,be=65535&w,!((ne=w>>>24)<=D);){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}if((240&ae)==0){for(pe=ne,ye=ae,Ae=be;ae=(w=b.distcode[Ae+((L&(1<<pe+ye)-1)>>pe)])>>>16&255,be=65535&w,!(pe+(ne=w>>>24)<=D);){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}L>>>=pe,D-=pe,b.back+=pe}if(L>>>=ne,D-=ne,b.back+=ne,64&ae){y.msg="invalid distance code",b.mode=30;break}b.offset=be,b.extra=15&ae,b.mode=24;case 24:if(b.extra){for(C=b.extra;D<C;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}b.offset+=L&(1<<b.extra)-1,L>>>=b.extra,D-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){y.msg="invalid distance too far back",b.mode=30;break}b.mode=25;case 25:if(Q===0)break e;if(Z=K-Q,b.offset>Z){if((Z=b.offset-Z)>b.whave&&b.sane){y.msg="invalid distance too far back",b.mode=30;break}ce=Z>b.wnext?(Z-=b.wnext,b.wsize-Z):b.wnext-Z,Z>b.length&&(Z=b.length),fe=b.window}else fe=G,ce=$-b.offset,Z=b.length;for(Q<Z&&(Z=Q),Q-=Z,b.length-=Z;G[$++]=fe[ce++],--Z;);b.length===0&&(b.mode=21);break;case 26:if(Q===0)break e;G[$++]=b.length,Q--,b.mode=21;break;case 27:if(b.wrap){for(;D<32;){if(U===0)break e;U--,L|=I[z++]<<D,D+=8}if(K-=Q,y.total_out+=K,b.total+=K,K&&(y.adler=b.check=b.flags?n(b.check,G,K,$-K):a(b.check,G,K,$-K)),K=Q,(b.flags?L:p(L))!==b.check){y.msg="incorrect data check",b.mode=30;break}D=L=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;D<32;){if(U===0)break e;U--,L+=I[z++]<<D,D+=8}if(L!==(4294967295&b.total)){y.msg="incorrect length check",b.mode=30;break}D=L=0}b.mode=29;case 29:N=1;break e;case 30:N=-3;break e;case 31:return-4;default:return d}return y.next_out=$,y.avail_out=Q,y.next_in=z,y.avail_in=U,b.hold=L,b.bits=D,(b.wsize||K!==y.avail_out&&b.mode<30&&(b.mode<27||T!==4))&&O(y,y.output,y.next_out,K-y.avail_out)?(b.mode=31,-4):(ee-=y.avail_in,K-=y.avail_out,y.total_in+=ee,y.total_out+=K,b.total+=K,b.wrap&&K&&(y.adler=b.check=b.flags?n(b.check,G,K,y.next_out-K):a(b.check,G,K,y.next_out-K)),y.data_type=b.bits+(b.last?64:0)+(b.mode===12?128:0)+(b.mode===20||b.mode===15?256:0),(ee==0&&K===0||T===4)&&N===h&&(N=-5),N)},r.inflateEnd=function(y){if(!y||!y.state)return d;var T=y.state;return T.window&&(T.window=null),y.state=null,h},r.inflateGetHeader=function(y,T){var b;return y&&y.state?(2&(b=y.state).wrap)==0?d:((b.head=T).done=!1,h):d},r.inflateSetDictionary=function(y,T){var b,I=T.length;return y&&y.state?(b=y.state).wrap!==0&&b.mode!==11?d:b.mode===11&&a(1,T,I,0)!==b.check?-3:O(y,T,I,I)?(b.mode=31,-4):(b.havedict=1,h):d},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,r){"use strict";var i=e("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(c,l,h,d,u,f,v,p){var g,x,A,_,E,S,M,k,R,O=p.bits,y=0,T=0,b=0,I=0,G=0,z=0,$=0,U=0,Q=0,L=0,D=null,ee=0,K=new i.Buf16(16),Z=new i.Buf16(16),ce=null,fe=0;for(y=0;y<=15;y++)K[y]=0;for(T=0;T<d;T++)K[l[h+T]]++;for(G=O,I=15;1<=I&&K[I]===0;I--);if(I<G&&(G=I),I===0)return u[f++]=20971520,u[f++]=20971520,p.bits=1,0;for(b=1;b<I&&K[b]===0;b++);for(G<b&&(G=b),y=U=1;y<=15;y++)if(U<<=1,(U-=K[y])<0)return-1;if(0<U&&(c===0||I!==1))return-1;for(Z[1]=0,y=1;y<15;y++)Z[y+1]=Z[y]+K[y];for(T=0;T<d;T++)l[h+T]!==0&&(v[Z[l[h+T]]++]=T);if(S=c===0?(D=ce=v,19):c===1?(D=a,ee-=257,ce=n,fe-=257,256):(D=s,ce=o,-1),y=b,E=f,$=T=L=0,A=-1,_=(Q=1<<(z=G))-1,c===1&&852<Q||c===2&&592<Q)return 1;for(;;){for(M=y-$,R=v[T]<S?(k=0,v[T]):v[T]>S?(k=ce[fe+v[T]],D[ee+v[T]]):(k=96,0),g=1<<y-$,b=x=1<<z;u[E+(L>>$)+(x-=g)]=M<<24|k<<16|R|0,x!==0;);for(g=1<<y-1;L&g;)g>>=1;if(g!==0?(L&=g-1,L+=g):L=0,T++,--K[y]==0){if(y===I)break;y=l[h+v[T]]}if(G<y&&(L&_)!==A){for($===0&&($=G),E+=b,U=1<<(z=y-$);z+$<I&&!((U-=K[z+$])<=0);)z++,U<<=1;if(Q+=1<<z,c===1&&852<Q||c===2&&592<Q)return 1;u[A=L&_]=G<<24|z<<16|E-f|0}}return L!==0&&(u[E+L]=y-$<<24|64<<16|0),p.bits=G,0}},{"../utils/common":41}],51:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,r){"use strict";var i=e("../utils/common"),a=0,n=1;function s(w){for(var P=w.length;0<=--P;)w[P]=0}var o=0,c=29,l=256,h=l+1+c,d=30,u=19,f=2*h+1,v=15,p=16,g=7,x=256,A=16,_=17,E=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=new Array(2*(h+2));s(O);var y=new Array(2*d);s(y);var T=new Array(512);s(T);var b=new Array(256);s(b);var I=new Array(c);s(I);var G,z,$,U=new Array(d);function Q(w,P,H,W,B){this.static_tree=w,this.extra_bits=P,this.extra_base=H,this.elems=W,this.max_length=B,this.has_stree=w&&w.length}function L(w,P){this.dyn_tree=w,this.max_code=0,this.stat_desc=P}function D(w){return w<256?T[w]:T[256+(w>>>7)]}function ee(w,P){w.pending_buf[w.pending++]=255&P,w.pending_buf[w.pending++]=P>>>8&255}function K(w,P,H){w.bi_valid>p-H?(w.bi_buf|=P<<w.bi_valid&65535,ee(w,w.bi_buf),w.bi_buf=P>>p-w.bi_valid,w.bi_valid+=H-p):(w.bi_buf|=P<<w.bi_valid&65535,w.bi_valid+=H)}function Z(w,P,H){K(w,H[2*P],H[2*P+1])}function ce(w,P){for(var H=0;H|=1&w,w>>>=1,H<<=1,0<--P;);return H>>>1}function fe(w,P,H){var W,B,j=new Array(v+1),X=0;for(W=1;W<=v;W++)j[W]=X=X+H[W-1]<<1;for(B=0;B<=P;B++){var Y=w[2*B+1];Y!==0&&(w[2*B]=ce(j[Y]++,Y))}}function ne(w){var P;for(P=0;P<h;P++)w.dyn_ltree[2*P]=0;for(P=0;P<d;P++)w.dyn_dtree[2*P]=0;for(P=0;P<u;P++)w.bl_tree[2*P]=0;w.dyn_ltree[2*x]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0}function ae(w){8<w.bi_valid?ee(w,w.bi_buf):0<w.bi_valid&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0}function be(w,P,H,W){var B=2*P,j=2*H;return w[B]<w[j]||w[B]===w[j]&&W[P]<=W[H]}function pe(w,P,H){for(var W=w.heap[H],B=H<<1;B<=w.heap_len&&(B<w.heap_len&&be(P,w.heap[B+1],w.heap[B],w.depth)&&B++,!be(P,W,w.heap[B],w.depth));)w.heap[H]=w.heap[B],H=B,B<<=1;w.heap[H]=W}function ye(w,P,H){var W,B,j,X,Y=0;if(w.last_lit!==0)for(;W=w.pending_buf[w.d_buf+2*Y]<<8|w.pending_buf[w.d_buf+2*Y+1],B=w.pending_buf[w.l_buf+Y],Y++,W===0?Z(w,B,P):(Z(w,(j=b[B])+l+1,P),(X=S[j])!==0&&K(w,B-=I[j],X),Z(w,j=D(--W),H),(X=M[j])!==0&&K(w,W-=U[j],X)),Y<w.last_lit;);Z(w,x,P)}function Ae(w,P){var H,W,B,j=P.dyn_tree,X=P.stat_desc.static_tree,Y=P.stat_desc.has_stree,te=P.stat_desc.elems,de=-1;for(w.heap_len=0,w.heap_max=f,H=0;H<te;H++)j[2*H]!==0?(w.heap[++w.heap_len]=de=H,w.depth[H]=0):j[2*H+1]=0;for(;w.heap_len<2;)j[2*(B=w.heap[++w.heap_len]=de<2?++de:0)]=1,w.depth[B]=0,w.opt_len--,Y&&(w.static_len-=X[2*B+1]);for(P.max_code=de,H=w.heap_len>>1;1<=H;H--)pe(w,j,H);for(B=te;H=w.heap[1],w.heap[1]=w.heap[w.heap_len--],pe(w,j,1),W=w.heap[1],w.heap[--w.heap_max]=H,w.heap[--w.heap_max]=W,j[2*B]=j[2*H]+j[2*W],w.depth[B]=(w.depth[H]>=w.depth[W]?w.depth[H]:w.depth[W])+1,j[2*H+1]=j[2*W+1]=B,w.heap[1]=B++,pe(w,j,1),2<=w.heap_len;);w.heap[--w.heap_max]=w.heap[1],(function(oe,Te){var Pt,Fe,Rt,me,ir,Mr,Ve=Te.dyn_tree,Di=Te.max_code,Ts=Te.stat_desc.static_tree,Ps=Te.stat_desc.has_stree,Rs=Te.stat_desc.extra_bits,Fi=Te.stat_desc.extra_base,It=Te.stat_desc.max_length,ar=0;for(me=0;me<=v;me++)oe.bl_count[me]=0;for(Ve[2*oe.heap[oe.heap_max]+1]=0,Pt=oe.heap_max+1;Pt<f;Pt++)It<(me=Ve[2*Ve[2*(Fe=oe.heap[Pt])+1]+1]+1)&&(me=It,ar++),Ve[2*Fe+1]=me,Di<Fe||(oe.bl_count[me]++,ir=0,Fi<=Fe&&(ir=Rs[Fe-Fi]),Mr=Ve[2*Fe],oe.opt_len+=Mr*(me+ir),Ps&&(oe.static_len+=Mr*(Ts[2*Fe+1]+ir)));if(ar!==0){do{for(me=It-1;oe.bl_count[me]===0;)me--;oe.bl_count[me]--,oe.bl_count[me+1]+=2,oe.bl_count[It]--,ar-=2}while(0<ar);for(me=It;me!==0;me--)for(Fe=oe.bl_count[me];Fe!==0;)Di<(Rt=oe.heap[--Pt])||(Ve[2*Rt+1]!==me&&(oe.opt_len+=(me-Ve[2*Rt+1])*Ve[2*Rt],Ve[2*Rt+1]=me),Fe--)}})(w,P),fe(j,de,w.bl_count)}function m(w,P,H){var W,B,j=-1,X=P[1],Y=0,te=7,de=4;for(X===0&&(te=138,de=3),P[2*(H+1)+1]=65535,W=0;W<=H;W++)B=X,X=P[2*(W+1)+1],++Y<te&&B===X||(Y<de?w.bl_tree[2*B]+=Y:B!==0?(B!==j&&w.bl_tree[2*B]++,w.bl_tree[2*A]++):Y<=10?w.bl_tree[2*_]++:w.bl_tree[2*E]++,j=B,de=(Y=0)===X?(te=138,3):B===X?(te=6,3):(te=7,4))}function N(w,P,H){var W,B,j=-1,X=P[1],Y=0,te=7,de=4;for(X===0&&(te=138,de=3),W=0;W<=H;W++)if(B=X,X=P[2*(W+1)+1],!(++Y<te&&B===X)){if(Y<de)for(;Z(w,B,w.bl_tree),--Y!=0;);else B!==0?(B!==j&&(Z(w,B,w.bl_tree),Y--),Z(w,A,w.bl_tree),K(w,Y-3,2)):Y<=10?(Z(w,_,w.bl_tree),K(w,Y-3,3)):(Z(w,E,w.bl_tree),K(w,Y-11,7));j=B,de=(Y=0)===X?(te=138,3):B===X?(te=6,3):(te=7,4)}}s(U);var F=!1;function C(w,P,H,W){K(w,(o<<1)+(W?1:0),3),(function(B,j,X,Y){ae(B),Y&&(ee(B,X),ee(B,~X)),i.arraySet(B.pending_buf,B.window,j,X,B.pending),B.pending+=X})(w,P,H,!0)}r._tr_init=function(w){F||((function(){var P,H,W,B,j,X=new Array(v+1);for(B=W=0;B<c-1;B++)for(I[B]=W,P=0;P<1<<S[B];P++)b[W++]=B;for(b[W-1]=B,B=j=0;B<16;B++)for(U[B]=j,P=0;P<1<<M[B];P++)T[j++]=B;for(j>>=7;B<d;B++)for(U[B]=j<<7,P=0;P<1<<M[B]-7;P++)T[256+j++]=B;for(H=0;H<=v;H++)X[H]=0;for(P=0;P<=143;)O[2*P+1]=8,P++,X[8]++;for(;P<=255;)O[2*P+1]=9,P++,X[9]++;for(;P<=279;)O[2*P+1]=7,P++,X[7]++;for(;P<=287;)O[2*P+1]=8,P++,X[8]++;for(fe(O,h+1,X),P=0;P<d;P++)y[2*P+1]=5,y[2*P]=ce(P,5);G=new Q(O,S,l+1,h,v),z=new Q(y,M,0,d,v),$=new Q(new Array(0),k,0,u,g)})(),F=!0),w.l_desc=new L(w.dyn_ltree,G),w.d_desc=new L(w.dyn_dtree,z),w.bl_desc=new L(w.bl_tree,$),w.bi_buf=0,w.bi_valid=0,ne(w)},r._tr_stored_block=C,r._tr_flush_block=function(w,P,H,W){var B,j,X=0;0<w.level?(w.strm.data_type===2&&(w.strm.data_type=(function(Y){var te,de=4093624447;for(te=0;te<=31;te++,de>>>=1)if(1&de&&Y.dyn_ltree[2*te]!==0)return a;if(Y.dyn_ltree[18]!==0||Y.dyn_ltree[20]!==0||Y.dyn_ltree[26]!==0)return n;for(te=32;te<l;te++)if(Y.dyn_ltree[2*te]!==0)return n;return a})(w)),Ae(w,w.l_desc),Ae(w,w.d_desc),X=(function(Y){var te;for(m(Y,Y.dyn_ltree,Y.l_desc.max_code),m(Y,Y.dyn_dtree,Y.d_desc.max_code),Ae(Y,Y.bl_desc),te=u-1;3<=te&&Y.bl_tree[2*R[te]+1]===0;te--);return Y.opt_len+=3*(te+1)+5+5+4,te})(w),B=w.opt_len+3+7>>>3,(j=w.static_len+3+7>>>3)<=B&&(B=j)):B=j=H+5,H+4<=B&&P!==-1?C(w,P,H,W):w.strategy===4||j===B?(K(w,2+(W?1:0),3),ye(w,O,y)):(K(w,4+(W?1:0),3),(function(Y,te,de,oe){var Te;for(K(Y,te-257,5),K(Y,de-1,5),K(Y,oe-4,4),Te=0;Te<oe;Te++)K(Y,Y.bl_tree[2*R[Te]+1],3);N(Y,Y.dyn_ltree,te-1),N(Y,Y.dyn_dtree,de-1)})(w,w.l_desc.max_code+1,w.d_desc.max_code+1,X+1),ye(w,w.dyn_ltree,w.dyn_dtree)),ne(w),W&&ae(w)},r._tr_tally=function(w,P,H){return w.pending_buf[w.d_buf+2*w.last_lit]=P>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&P,w.pending_buf[w.l_buf+w.last_lit]=255&H,w.last_lit++,P===0?w.dyn_ltree[2*H]++:(w.matches++,P--,w.dyn_ltree[2*(b[H]+l+1)]++,w.dyn_dtree[2*D(P)]++),w.last_lit===w.lit_bufsize-1},r._tr_align=function(w){K(w,2,3),Z(w,x,O),(function(P){P.bi_valid===16?(ee(P,P.bi_buf),P.bi_buf=0,P.bi_valid=0):8<=P.bi_valid&&(P.pending_buf[P.pending++]=255&P.bi_buf,P.bi_buf>>=8,P.bi_valid-=8)})(w)}},{"../utils/common":41}],53:[function(e,t,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,r){(function(i){(function(a,n){"use strict";if(!a.setImmediate){var s,o,c,l,h=1,d={},u=!1,f=a.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(a);v=v&&v.setTimeout?v:a,s={}.toString.call(a.process)==="[object process]"?function(A){process.nextTick(function(){g(A)})}:(function(){if(a.postMessage&&!a.importScripts){var A=!0,_=a.onmessage;return a.onmessage=function(){A=!1},a.postMessage("","*"),a.onmessage=_,A}})()?(l="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",x,!1):a.attachEvent("onmessage",x),function(A){a.postMessage(l+A,"*")}):a.MessageChannel?((c=new MessageChannel).port1.onmessage=function(A){g(A.data)},function(A){c.port2.postMessage(A)}):f&&"onreadystatechange"in f.createElement("script")?(o=f.documentElement,function(A){var _=f.createElement("script");_.onreadystatechange=function(){g(A),_.onreadystatechange=null,o.removeChild(_),_=null},o.appendChild(_)}):function(A){setTimeout(g,0,A)},v.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var _=new Array(arguments.length-1),E=0;E<_.length;E++)_[E]=arguments[E+1];var S={callback:A,args:_};return d[h]=S,s(h),h++},v.clearImmediate=p}function p(A){delete d[A]}function g(A){if(u)setTimeout(g,0,A);else{var _=d[A];if(_){u=!0;try{(function(E){var S=E.callback,M=E.args;switch(M.length){case 0:S();break;case 1:S(M[0]);break;case 2:S(M[0],M[1]);break;case 3:S(M[0],M[1],M[2]);break;default:S.apply(n,M)}})(_)}finally{p(A),u=!1}}}}function x(A){A.source===a&&typeof A.data=="string"&&A.data.indexOf(l)===0&&g(+A.data.slice(l.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})});var ie=1e-6,he=typeof Float32Array<"u"?Float32Array:Array,Oe=Math.random,Oi="zyx";function Xe(e){return e>=0?Math.round(e):e%.5===0?Math.floor(e):Math.round(e)}var ed=Math.PI/180,td=180/Math.PI;var ve={};Lt(ve,{add:()=>so,adjoint:()=>Zs,clone:()=>Ns,copy:()=>Us,create:()=>Rr,determinant:()=>Ys,equals:()=>co,exactEquals:()=>ho,frob:()=>no,fromMat2d:()=>eo,fromMat4:()=>zs,fromQuat:()=>to,fromRotation:()=>Js,fromScaling:()=>$s,fromTranslation:()=>Qs,fromValues:()=>Hs,identity:()=>Ws,invert:()=>js,mul:()=>fo,multiply:()=>zi,multiplyScalar:()=>oo,multiplyScalarAndAdd:()=>lo,normalFromMat4:()=>ro,projection:()=>io,rotate:()=>Ks,scale:()=>Xs,set:()=>Gs,str:()=>ao,sub:()=>uo,subtract:()=>Ni,translate:()=>qs,transpose:()=>Vs});function Rr(){var e=new he(9);return he!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function zs(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Ns(e){var t=new he(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Us(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Hs(e,t,r,i,a,n,s,o,c){var l=new he(9);return l[0]=e,l[1]=t,l[2]=r,l[3]=i,l[4]=a,l[5]=n,l[6]=s,l[7]=o,l[8]=c,l}function Gs(e,t,r,i,a,n,s,o,c,l){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e[4]=n,e[5]=s,e[6]=o,e[7]=c,e[8]=l,e}function Ws(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Vs(e,t){if(e===t){var r=t[1],i=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function js(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=t[4],o=t[5],c=t[6],l=t[7],h=t[8],d=h*s-o*l,u=-h*n+o*c,f=l*n-s*c,v=r*d+i*u+a*f;return v?(v=1/v,e[0]=d*v,e[1]=(-h*i+a*l)*v,e[2]=(o*i-a*s)*v,e[3]=u*v,e[4]=(h*r-a*c)*v,e[5]=(-o*r+a*n)*v,e[6]=f*v,e[7]=(-l*r+i*c)*v,e[8]=(s*r-i*n)*v,e):null}function Zs(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=t[4],o=t[5],c=t[6],l=t[7],h=t[8];return e[0]=s*h-o*l,e[1]=a*l-i*h,e[2]=i*o-a*s,e[3]=o*c-n*h,e[4]=r*h-a*c,e[5]=a*n-r*o,e[6]=n*l-s*c,e[7]=i*c-r*l,e[8]=r*s-i*n,e}function Ys(e){var t=e[0],r=e[1],i=e[2],a=e[3],n=e[4],s=e[5],o=e[6],c=e[7],l=e[8];return t*(l*n-s*c)+r*(-l*a+s*o)+i*(c*a-n*o)}function zi(e,t,r){var i=t[0],a=t[1],n=t[2],s=t[3],o=t[4],c=t[5],l=t[6],h=t[7],d=t[8],u=r[0],f=r[1],v=r[2],p=r[3],g=r[4],x=r[5],A=r[6],_=r[7],E=r[8];return e[0]=u*i+f*s+v*l,e[1]=u*a+f*o+v*h,e[2]=u*n+f*c+v*d,e[3]=p*i+g*s+x*l,e[4]=p*a+g*o+x*h,e[5]=p*n+g*c+x*d,e[6]=A*i+_*s+E*l,e[7]=A*a+_*o+E*h,e[8]=A*n+_*c+E*d,e}function qs(e,t,r){var i=t[0],a=t[1],n=t[2],s=t[3],o=t[4],c=t[5],l=t[6],h=t[7],d=t[8],u=r[0],f=r[1];return e[0]=i,e[1]=a,e[2]=n,e[3]=s,e[4]=o,e[5]=c,e[6]=u*i+f*s+l,e[7]=u*a+f*o+h,e[8]=u*n+f*c+d,e}function Ks(e,t,r){var i=t[0],a=t[1],n=t[2],s=t[3],o=t[4],c=t[5],l=t[6],h=t[7],d=t[8],u=Math.sin(r),f=Math.cos(r);return e[0]=f*i+u*s,e[1]=f*a+u*o,e[2]=f*n+u*c,e[3]=f*s-u*i,e[4]=f*o-u*a,e[5]=f*c-u*n,e[6]=l,e[7]=h,e[8]=d,e}function Xs(e,t,r){var i=r[0],a=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Qs(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Js(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function $s(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function eo(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function to(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=r+r,o=i+i,c=a+a,l=r*s,h=i*s,d=i*o,u=a*s,f=a*o,v=a*c,p=n*s,g=n*o,x=n*c;return e[0]=1-d-v,e[3]=h-x,e[6]=u+g,e[1]=h+x,e[4]=1-l-v,e[7]=f-p,e[2]=u-g,e[5]=f+p,e[8]=1-l-d,e}function ro(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=t[4],o=t[5],c=t[6],l=t[7],h=t[8],d=t[9],u=t[10],f=t[11],v=t[12],p=t[13],g=t[14],x=t[15],A=r*o-i*s,_=r*c-a*s,E=r*l-n*s,S=i*c-a*o,M=i*l-n*o,k=a*l-n*c,R=h*p-d*v,O=h*g-u*v,y=h*x-f*v,T=d*g-u*p,b=d*x-f*p,I=u*x-f*g,G=A*I-_*b+E*T+S*y-M*O+k*R;return G?(G=1/G,e[0]=(o*I-c*b+l*T)*G,e[1]=(c*y-s*I-l*O)*G,e[2]=(s*b-o*y+l*R)*G,e[3]=(a*b-i*I-n*T)*G,e[4]=(r*I-a*y+n*O)*G,e[5]=(i*y-r*b-n*R)*G,e[6]=(p*k-g*M+x*S)*G,e[7]=(g*E-v*k-x*_)*G,e[8]=(v*M-p*E+x*A)*G,e):null}function io(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function ao(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function no(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8])}function so(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function Ni(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function oo(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function lo(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function ho(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function co(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],s=e[4],o=e[5],c=e[6],l=e[7],h=e[8],d=t[0],u=t[1],f=t[2],v=t[3],p=t[4],g=t[5],x=t[6],A=t[7],_=t[8];return Math.abs(r-d)<=ie*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-u)<=ie*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-f)<=ie*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(n-v)<=ie*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(s-p)<=ie*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(o-g)<=ie*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(c-x)<=ie*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(l-A)<=ie*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(h-_)<=ie*Math.max(1,Math.abs(h),Math.abs(_))}var fo=zi,uo=Ni;var q={};Lt(q,{add:()=>Jo,adjoint:()=>_o,clone:()=>vo,copy:()=>mo,create:()=>po,decompose:()=>zo,determinant:()=>wo,equals:()=>rl,exactEquals:()=>tl,frob:()=>Qo,fromQuat:()=>Ho,fromQuat2:()=>Do,fromRotation:()=>Ro,fromRotationTranslation:()=>Gi,fromRotationTranslationScale:()=>No,fromRotationTranslationScaleOrigin:()=>Uo,fromScaling:()=>Po,fromTranslation:()=>To,fromValues:()=>go,fromXRotation:()=>Io,fromYRotation:()=>Bo,fromZRotation:()=>Lo,frustum:()=>Go,getRotation:()=>Oo,getScaling:()=>Wi,getTranslation:()=>Fo,identity:()=>Ui,invert:()=>yo,lookAt:()=>qo,mul:()=>il,multiply:()=>Hi,multiplyScalar:()=>$o,multiplyScalarAndAdd:()=>el,ortho:()=>Zo,orthoNO:()=>ji,orthoZO:()=>Yo,perspective:()=>Wo,perspectiveFromFieldOfView:()=>jo,perspectiveNO:()=>Vi,perspectiveZO:()=>Vo,rotate:()=>Co,rotateX:()=>Eo,rotateY:()=>ko,rotateZ:()=>Mo,scale:()=>So,set:()=>bo,str:()=>Xo,sub:()=>al,subtract:()=>Zi,targetTo:()=>Ko,translate:()=>Ao,transpose:()=>xo});function po(){var e=new he(16);return he!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function vo(e){var t=new he(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function mo(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function go(e,t,r,i,a,n,s,o,c,l,h,d,u,f,v,p){var g=new he(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=i,g[4]=a,g[5]=n,g[6]=s,g[7]=o,g[8]=c,g[9]=l,g[10]=h,g[11]=d,g[12]=u,g[13]=f,g[14]=v,g[15]=p,g}function bo(e,t,r,i,a,n,s,o,c,l,h,d,u,f,v,p,g){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e[4]=n,e[5]=s,e[6]=o,e[7]=c,e[8]=l,e[9]=h,e[10]=d,e[11]=u,e[12]=f,e[13]=v,e[14]=p,e[15]=g,e}function Ui(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xo(e,t){if(e===t){var r=t[1],i=t[2],a=t[3],n=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=n,e[11]=t[14],e[12]=a,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function yo(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=t[4],o=t[5],c=t[6],l=t[7],h=t[8],d=t[9],u=t[10],f=t[11],v=t[12],p=t[13],g=t[14],x=t[15],A=r*o-i*s,_=r*c-a*s,E=r*l-n*s,S=i*c-a*o,M=i*l-n*o,k=a*l-n*c,R=h*p-d*v,O=h*g-u*v,y=h*x-f*v,T=d*g-u*p,b=d*x-f*p,I=u*x-f*g,G=A*I-_*b+E*T+S*y-M*O+k*R;return G?(G=1/G,e[0]=(o*I-c*b+l*T)*G,e[1]=(a*b-i*I-n*T)*G,e[2]=(p*k-g*M+x*S)*G,e[3]=(u*M-d*k-f*S)*G,e[4]=(c*y-s*I-l*O)*G,e[5]=(r*I-a*y+n*O)*G,e[6]=(g*E-v*k-x*_)*G,e[7]=(h*k-u*E+f*_)*G,e[8]=(s*b-o*y+l*R)*G,e[9]=(i*y-r*b-n*R)*G,e[10]=(v*M-p*E+x*A)*G,e[11]=(d*E-h*M-f*A)*G,e[12]=(o*O-s*T-c*R)*G,e[13]=(r*T-i*O+a*R)*G,e[14]=(p*_-v*S-g*A)*G,e[15]=(h*S-d*_+u*A)*G,e):null}function _o(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=t[4],o=t[5],c=t[6],l=t[7],h=t[8],d=t[9],u=t[10],f=t[11],v=t[12],p=t[13],g=t[14],x=t[15],A=r*o-i*s,_=r*c-a*s,E=r*l-n*s,S=i*c-a*o,M=i*l-n*o,k=a*l-n*c,R=h*p-d*v,O=h*g-u*v,y=h*x-f*v,T=d*g-u*p,b=d*x-f*p,I=u*x-f*g;return e[0]=o*I-c*b+l*T,e[1]=a*b-i*I-n*T,e[2]=p*k-g*M+x*S,e[3]=u*M-d*k-f*S,e[4]=c*y-s*I-l*O,e[5]=r*I-a*y+n*O,e[6]=g*E-v*k-x*_,e[7]=h*k-u*E+f*_,e[8]=s*b-o*y+l*R,e[9]=i*y-r*b-n*R,e[10]=v*M-p*E+x*A,e[11]=d*E-h*M-f*A,e[12]=o*O-s*T-c*R,e[13]=r*T-i*O+a*R,e[14]=p*_-v*S-g*A,e[15]=h*S-d*_+u*A,e}function wo(e){var t=e[0],r=e[1],i=e[2],a=e[3],n=e[4],s=e[5],o=e[6],c=e[7],l=e[8],h=e[9],d=e[10],u=e[11],f=e[12],v=e[13],p=e[14],g=e[15],x=t*s-r*n,A=t*o-i*n,_=r*o-i*s,E=l*v-h*f,S=l*p-d*f,M=h*p-d*v,k=t*M-r*S+i*E,R=n*M-s*S+o*E,O=l*_-h*A+d*x,y=f*_-v*A+p*x;return c*k-a*R+g*O-u*y}function Hi(e,t,r){var i=t[0],a=t[1],n=t[2],s=t[3],o=t[4],c=t[5],l=t[6],h=t[7],d=t[8],u=t[9],f=t[10],v=t[11],p=t[12],g=t[13],x=t[14],A=t[15],_=r[0],E=r[1],S=r[2],M=r[3];return e[0]=_*i+E*o+S*d+M*p,e[1]=_*a+E*c+S*u+M*g,e[2]=_*n+E*l+S*f+M*x,e[3]=_*s+E*h+S*v+M*A,_=r[4],E=r[5],S=r[6],M=r[7],e[4]=_*i+E*o+S*d+M*p,e[5]=_*a+E*c+S*u+M*g,e[6]=_*n+E*l+S*f+M*x,e[7]=_*s+E*h+S*v+M*A,_=r[8],E=r[9],S=r[10],M=r[11],e[8]=_*i+E*o+S*d+M*p,e[9]=_*a+E*c+S*u+M*g,e[10]=_*n+E*l+S*f+M*x,e[11]=_*s+E*h+S*v+M*A,_=r[12],E=r[13],S=r[14],M=r[15],e[12]=_*i+E*o+S*d+M*p,e[13]=_*a+E*c+S*u+M*g,e[14]=_*n+E*l+S*f+M*x,e[15]=_*s+E*h+S*v+M*A,e}function Ao(e,t,r){var i=r[0],a=r[1],n=r[2],s,o,c,l,h,d,u,f,v,p,g,x;return t===e?(e[12]=t[0]*i+t[4]*a+t[8]*n+t[12],e[13]=t[1]*i+t[5]*a+t[9]*n+t[13],e[14]=t[2]*i+t[6]*a+t[10]*n+t[14],e[15]=t[3]*i+t[7]*a+t[11]*n+t[15]):(s=t[0],o=t[1],c=t[2],l=t[3],h=t[4],d=t[5],u=t[6],f=t[7],v=t[8],p=t[9],g=t[10],x=t[11],e[0]=s,e[1]=o,e[2]=c,e[3]=l,e[4]=h,e[5]=d,e[6]=u,e[7]=f,e[8]=v,e[9]=p,e[10]=g,e[11]=x,e[12]=s*i+h*a+v*n+t[12],e[13]=o*i+d*a+p*n+t[13],e[14]=c*i+u*a+g*n+t[14],e[15]=l*i+f*a+x*n+t[15]),e}function So(e,t,r){var i=r[0],a=r[1],n=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Co(e,t,r,i){var a=i[0],n=i[1],s=i[2],o=Math.sqrt(a*a+n*n+s*s),c,l,h,d,u,f,v,p,g,x,A,_,E,S,M,k,R,O,y,T,b,I,G,z;return o<ie?null:(o=1/o,a*=o,n*=o,s*=o,c=Math.sin(r),l=Math.cos(r),h=1-l,d=t[0],u=t[1],f=t[2],v=t[3],p=t[4],g=t[5],x=t[6],A=t[7],_=t[8],E=t[9],S=t[10],M=t[11],k=a*a*h+l,R=n*a*h+s*c,O=s*a*h-n*c,y=a*n*h-s*c,T=n*n*h+l,b=s*n*h+a*c,I=a*s*h+n*c,G=n*s*h-a*c,z=s*s*h+l,e[0]=d*k+p*R+_*O,e[1]=u*k+g*R+E*O,e[2]=f*k+x*R+S*O,e[3]=v*k+A*R+M*O,e[4]=d*y+p*T+_*b,e[5]=u*y+g*T+E*b,e[6]=f*y+x*T+S*b,e[7]=v*y+A*T+M*b,e[8]=d*I+p*G+_*z,e[9]=u*I+g*G+E*z,e[10]=f*I+x*G+S*z,e[11]=v*I+A*G+M*z,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Eo(e,t,r){var i=Math.sin(r),a=Math.cos(r),n=t[4],s=t[5],o=t[6],c=t[7],l=t[8],h=t[9],d=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*a+l*i,e[5]=s*a+h*i,e[6]=o*a+d*i,e[7]=c*a+u*i,e[8]=l*a-n*i,e[9]=h*a-s*i,e[10]=d*a-o*i,e[11]=u*a-c*i,e}function ko(e,t,r){var i=Math.sin(r),a=Math.cos(r),n=t[0],s=t[1],o=t[2],c=t[3],l=t[8],h=t[9],d=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*a-l*i,e[1]=s*a-h*i,e[2]=o*a-d*i,e[3]=c*a-u*i,e[8]=n*i+l*a,e[9]=s*i+h*a,e[10]=o*i+d*a,e[11]=c*i+u*a,e}function Mo(e,t,r){var i=Math.sin(r),a=Math.cos(r),n=t[0],s=t[1],o=t[2],c=t[3],l=t[4],h=t[5],d=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*a+l*i,e[1]=s*a+h*i,e[2]=o*a+d*i,e[3]=c*a+u*i,e[4]=l*a-n*i,e[5]=h*a-s*i,e[6]=d*a-o*i,e[7]=u*a-c*i,e}function To(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Po(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ro(e,t,r){var i=r[0],a=r[1],n=r[2],s=Math.sqrt(i*i+a*a+n*n),o,c,l;return s<ie?null:(s=1/s,i*=s,a*=s,n*=s,o=Math.sin(t),c=Math.cos(t),l=1-c,e[0]=i*i*l+c,e[1]=a*i*l+n*o,e[2]=n*i*l-a*o,e[3]=0,e[4]=i*a*l-n*o,e[5]=a*a*l+c,e[6]=n*a*l+i*o,e[7]=0,e[8]=i*n*l+a*o,e[9]=a*n*l-i*o,e[10]=n*n*l+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Io(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Bo(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Lo(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Gi(e,t,r){var i=t[0],a=t[1],n=t[2],s=t[3],o=i+i,c=a+a,l=n+n,h=i*o,d=i*c,u=i*l,f=a*c,v=a*l,p=n*l,g=s*o,x=s*c,A=s*l;return e[0]=1-(f+p),e[1]=d+A,e[2]=u-x,e[3]=0,e[4]=d-A,e[5]=1-(h+p),e[6]=v+g,e[7]=0,e[8]=u+x,e[9]=v-g,e[10]=1-(h+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Do(e,t){var r=new he(3),i=-t[0],a=-t[1],n=-t[2],s=t[3],o=t[4],c=t[5],l=t[6],h=t[7],d=i*i+a*a+n*n+s*s;return d>0?(r[0]=(o*s+h*i+c*n-l*a)*2/d,r[1]=(c*s+h*a+l*i-o*n)*2/d,r[2]=(l*s+h*n+o*a-c*i)*2/d):(r[0]=(o*s+h*i+c*n-l*a)*2,r[1]=(c*s+h*a+l*i-o*n)*2,r[2]=(l*s+h*n+o*a-c*i)*2),Gi(e,t,r),e}function Fo(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Wi(e,t){var r=t[0],i=t[1],a=t[2],n=t[4],s=t[5],o=t[6],c=t[8],l=t[9],h=t[10];return e[0]=Math.sqrt(r*r+i*i+a*a),e[1]=Math.sqrt(n*n+s*s+o*o),e[2]=Math.sqrt(c*c+l*l+h*h),e}function Oo(e,t){var r=new he(3);Wi(r,t);var i=1/r[0],a=1/r[1],n=1/r[2],s=t[0]*i,o=t[1]*a,c=t[2]*n,l=t[4]*i,h=t[5]*a,d=t[6]*n,u=t[8]*i,f=t[9]*a,v=t[10]*n,p=s+h+v,g=0;return p>0?(g=Math.sqrt(p+1)*2,e[3]=.25*g,e[0]=(d-f)/g,e[1]=(u-c)/g,e[2]=(o-l)/g):s>h&&s>v?(g=Math.sqrt(1+s-h-v)*2,e[3]=(d-f)/g,e[0]=.25*g,e[1]=(o+l)/g,e[2]=(u+c)/g):h>v?(g=Math.sqrt(1+h-s-v)*2,e[3]=(u-c)/g,e[0]=(o+l)/g,e[1]=.25*g,e[2]=(d+f)/g):(g=Math.sqrt(1+v-s-h)*2,e[3]=(o-l)/g,e[0]=(u+c)/g,e[1]=(d+f)/g,e[2]=.25*g),e}function zo(e,t,r,i){t[0]=i[12],t[1]=i[13],t[2]=i[14];var a=i[0],n=i[1],s=i[2],o=i[4],c=i[5],l=i[6],h=i[8],d=i[9],u=i[10];r[0]=Math.sqrt(a*a+n*n+s*s),r[1]=Math.sqrt(o*o+c*c+l*l),r[2]=Math.sqrt(h*h+d*d+u*u);var f=1/r[0],v=1/r[1],p=1/r[2],g=a*f,x=n*v,A=s*p,_=o*f,E=c*v,S=l*p,M=h*f,k=d*v,R=u*p,O=g+E+R,y=0;return O>0?(y=Math.sqrt(O+1)*2,e[3]=.25*y,e[0]=(S-k)/y,e[1]=(M-A)/y,e[2]=(x-_)/y):g>E&&g>R?(y=Math.sqrt(1+g-E-R)*2,e[3]=(S-k)/y,e[0]=.25*y,e[1]=(x+_)/y,e[2]=(M+A)/y):E>R?(y=Math.sqrt(1+E-g-R)*2,e[3]=(M-A)/y,e[0]=(x+_)/y,e[1]=.25*y,e[2]=(S+k)/y):(y=Math.sqrt(1+R-g-E)*2,e[3]=(x-_)/y,e[0]=(M+A)/y,e[1]=(S+k)/y,e[2]=.25*y),e}function No(e,t,r,i){var a=t[0],n=t[1],s=t[2],o=t[3],c=a+a,l=n+n,h=s+s,d=a*c,u=a*l,f=a*h,v=n*l,p=n*h,g=s*h,x=o*c,A=o*l,_=o*h,E=i[0],S=i[1],M=i[2];return e[0]=(1-(v+g))*E,e[1]=(u+_)*E,e[2]=(f-A)*E,e[3]=0,e[4]=(u-_)*S,e[5]=(1-(d+g))*S,e[6]=(p+x)*S,e[7]=0,e[8]=(f+A)*M,e[9]=(p-x)*M,e[10]=(1-(d+v))*M,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Uo(e,t,r,i,a){var n=t[0],s=t[1],o=t[2],c=t[3],l=n+n,h=s+s,d=o+o,u=n*l,f=n*h,v=n*d,p=s*h,g=s*d,x=o*d,A=c*l,_=c*h,E=c*d,S=i[0],M=i[1],k=i[2],R=a[0],O=a[1],y=a[2],T=(1-(p+x))*S,b=(f+E)*S,I=(v-_)*S,G=(f-E)*M,z=(1-(u+x))*M,$=(g+A)*M,U=(v+_)*k,Q=(g-A)*k,L=(1-(u+p))*k;return e[0]=T,e[1]=b,e[2]=I,e[3]=0,e[4]=G,e[5]=z,e[6]=$,e[7]=0,e[8]=U,e[9]=Q,e[10]=L,e[11]=0,e[12]=r[0]+R-(T*R+G*O+U*y),e[13]=r[1]+O-(b*R+z*O+Q*y),e[14]=r[2]+y-(I*R+$*O+L*y),e[15]=1,e}function Ho(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=r+r,o=i+i,c=a+a,l=r*s,h=i*s,d=i*o,u=a*s,f=a*o,v=a*c,p=n*s,g=n*o,x=n*c;return e[0]=1-d-v,e[1]=h+x,e[2]=u-g,e[3]=0,e[4]=h-x,e[5]=1-l-v,e[6]=f+p,e[7]=0,e[8]=u+g,e[9]=f-p,e[10]=1-l-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Go(e,t,r,i,a,n,s){var o=1/(r-t),c=1/(a-i),l=1/(n-s);return e[0]=n*2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(a+i)*c,e[10]=(s+n)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*n*2*l,e[15]=0,e}function Vi(e,t,r,i,a){var n=1/Math.tan(t/2);if(e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0){var s=1/(i-a);e[10]=(a+i)*s,e[14]=2*a*i*s}else e[10]=-1,e[14]=-2*i;return e}var Wo=Vi;function Vo(e,t,r,i,a){var n=1/Math.tan(t/2);if(e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0){var s=1/(i-a);e[10]=a*s,e[14]=a*i*s}else e[10]=-1,e[14]=-i;return e}function jo(e,t,r,i){var a=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),c=2/(s+o),l=2/(a+n);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((s-o)*c*.5),e[9]=(a-n)*l*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function ji(e,t,r,i,a,n,s){var o=1/(t-r),c=1/(i-a),l=1/(n-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*o,e[13]=(a+i)*c,e[14]=(s+n)*l,e[15]=1,e}var Zo=ji;function Yo(e,t,r,i,a,n,s){var o=1/(t-r),c=1/(i-a),l=1/(n-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(t+r)*o,e[13]=(a+i)*c,e[14]=n*l,e[15]=1,e}function qo(e,t,r,i){var a,n,s,o,c,l,h,d,u,f,v=t[0],p=t[1],g=t[2],x=i[0],A=i[1],_=i[2],E=r[0],S=r[1],M=r[2];return Math.abs(v-E)<ie&&Math.abs(p-S)<ie&&Math.abs(g-M)<ie?Ui(e):(h=v-E,d=p-S,u=g-M,f=1/Math.sqrt(h*h+d*d+u*u),h*=f,d*=f,u*=f,a=A*u-_*d,n=_*h-x*u,s=x*d-A*h,f=Math.sqrt(a*a+n*n+s*s),f?(f=1/f,a*=f,n*=f,s*=f):(a=0,n=0,s=0),o=d*s-u*n,c=u*a-h*s,l=h*n-d*a,f=Math.sqrt(o*o+c*c+l*l),f?(f=1/f,o*=f,c*=f,l*=f):(o=0,c=0,l=0),e[0]=a,e[1]=o,e[2]=h,e[3]=0,e[4]=n,e[5]=c,e[6]=d,e[7]=0,e[8]=s,e[9]=l,e[10]=u,e[11]=0,e[12]=-(a*v+n*p+s*g),e[13]=-(o*v+c*p+l*g),e[14]=-(h*v+d*p+u*g),e[15]=1,e)}function Ko(e,t,r,i){var a=t[0],n=t[1],s=t[2],o=i[0],c=i[1],l=i[2],h=a-r[0],d=n-r[1],u=s-r[2],f=h*h+d*d+u*u;f>0&&(f=1/Math.sqrt(f),h*=f,d*=f,u*=f);var v=c*u-l*d,p=l*h-o*u,g=o*d-c*h;return f=v*v+p*p+g*g,f>0&&(f=1/Math.sqrt(f),v*=f,p*=f,g*=f),e[0]=v,e[1]=p,e[2]=g,e[3]=0,e[4]=d*g-u*p,e[5]=u*v-h*g,e[6]=h*p-d*v,e[7]=0,e[8]=h,e[9]=d,e[10]=u,e[11]=0,e[12]=a,e[13]=n,e[14]=s,e[15]=1,e}function Xo(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Qo(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}function Jo(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Zi(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function $o(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function el(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function tl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function rl(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],s=e[4],o=e[5],c=e[6],l=e[7],h=e[8],d=e[9],u=e[10],f=e[11],v=e[12],p=e[13],g=e[14],x=e[15],A=t[0],_=t[1],E=t[2],S=t[3],M=t[4],k=t[5],R=t[6],O=t[7],y=t[8],T=t[9],b=t[10],I=t[11],G=t[12],z=t[13],$=t[14],U=t[15];return Math.abs(r-A)<=ie*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(i-_)<=ie*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(a-E)<=ie*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(n-S)<=ie*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(s-M)<=ie*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(o-k)<=ie*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(c-R)<=ie*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(l-O)<=ie*Math.max(1,Math.abs(l),Math.abs(O))&&Math.abs(h-y)<=ie*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(d-T)<=ie*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(u-b)<=ie*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(f-I)<=ie*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(v-G)<=ie*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(p-z)<=ie*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(g-$)<=ie*Math.max(1,Math.abs(g),Math.abs($))&&Math.abs(x-U)<=ie*Math.max(1,Math.abs(x),Math.abs(U))}var il=Hi,al=Zi;var Qe={};Lt(Qe,{add:()=>sh,calculateW:()=>Kl,clone:()=>rh,conjugate:()=>$l,copy:()=>ah,create:()=>Dr,dot:()=>ga,equals:()=>dh,exactEquals:()=>fh,exp:()=>ua,fromEuler:()=>eh,fromMat3:()=>va,fromValues:()=>ih,getAngle:()=>jl,getAxisAngle:()=>Vl,identity:()=>Wl,invert:()=>Jl,len:()=>hh,length:()=>ba,lerp:()=>lh,ln:()=>pa,mul:()=>oh,multiply:()=>da,normalize:()=>Fr,pow:()=>Xl,random:()=>Ql,rotateX:()=>Zl,rotateY:()=>Yl,rotateZ:()=>ql,rotationTo:()=>uh,scale:()=>ma,set:()=>nh,setAxes:()=>vh,setAxisAngle:()=>fa,slerp:()=>or,sqlerp:()=>ph,sqrLen:()=>ch,squaredLength:()=>xa,str:()=>th});var J={};Lt(J,{add:()=>ll,angle:()=>Tl,bezier:()=>_l,ceil:()=>hl,clone:()=>nl,copy:()=>sl,create:()=>nr,cross:()=>Ft,dist:()=>Ol,distance:()=>Qi,div:()=>Fl,divide:()=>Xi,dot:()=>Dt,equals:()=>Bl,exactEquals:()=>Il,floor:()=>cl,forEach:()=>Ul,fromValues:()=>sr,hermite:()=>yl,inverse:()=>gl,len:()=>Br,length:()=>Yi,lerp:()=>bl,max:()=>dl,min:()=>fl,mul:()=>Dl,multiply:()=>Ki,negate:()=>ml,normalize:()=>Ir,random:()=>wl,rotateX:()=>El,rotateY:()=>kl,rotateZ:()=>Ml,round:()=>ul,scale:()=>pl,scaleAndAdd:()=>vl,set:()=>ol,slerp:()=>xl,sqrDist:()=>zl,sqrLen:()=>Nl,squaredDistance:()=>Ji,squaredLength:()=>$i,str:()=>Rl,sub:()=>Ll,subtract:()=>qi,transformMat3:()=>Sl,transformMat4:()=>Al,transformQuat:()=>Cl,zero:()=>Pl});function nr(){var e=new he(3);return he!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function nl(e){var t=new he(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Yi(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function sr(e,t,r){var i=new he(3);return i[0]=e,i[1]=t,i[2]=r,i}function sl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ol(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function ll(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function qi(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Ki(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Xi(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function hl(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function cl(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function fl(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function dl(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function ul(e,t){return e[0]=Xe(t[0]),e[1]=Xe(t[1]),e[2]=Xe(t[2]),e}function pl(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function vl(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function Qi(e,t){var r=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2];return Math.sqrt(r*r+i*i+a*a)}function Ji(e,t){var r=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2];return r*r+i*i+a*a}function $i(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function ml(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function gl(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Ir(e,t){var r=t[0],i=t[1],a=t[2],n=r*r+i*i+a*a;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Dt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ft(e,t,r){var i=t[0],a=t[1],n=t[2],s=r[0],o=r[1],c=r[2];return e[0]=a*c-n*o,e[1]=n*s-i*c,e[2]=i*o-a*s,e}function bl(e,t,r,i){var a=t[0],n=t[1],s=t[2];return e[0]=a+i*(r[0]-a),e[1]=n+i*(r[1]-n),e[2]=s+i*(r[2]-s),e}function xl(e,t,r,i){var a=Math.acos(Math.min(Math.max(Dt(t,r),-1),1)),n=Math.sin(a),s=Math.sin((1-i)*a)/n,o=Math.sin(i*a)/n;return e[0]=s*t[0]+o*r[0],e[1]=s*t[1]+o*r[1],e[2]=s*t[2]+o*r[2],e}function yl(e,t,r,i,a,n){var s=n*n,o=s*(2*n-3)+1,c=s*(n-2)+n,l=s*(n-1),h=s*(3-2*n);return e[0]=t[0]*o+r[0]*c+i[0]*l+a[0]*h,e[1]=t[1]*o+r[1]*c+i[1]*l+a[1]*h,e[2]=t[2]*o+r[2]*c+i[2]*l+a[2]*h,e}function _l(e,t,r,i,a,n){var s=1-n,o=s*s,c=n*n,l=o*s,h=3*n*o,d=3*c*s,u=c*n;return e[0]=t[0]*l+r[0]*h+i[0]*d+a[0]*u,e[1]=t[1]*l+r[1]*h+i[1]*d+a[1]*u,e[2]=t[2]*l+r[2]*h+i[2]*d+a[2]*u,e}function wl(e,t){t=t===void 0?1:t;var r=Oe()*2*Math.PI,i=Oe()*2-1,a=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=i*t,e}function Al(e,t,r){var i=t[0],a=t[1],n=t[2],s=r[3]*i+r[7]*a+r[11]*n+r[15];return s=s||1,e[0]=(r[0]*i+r[4]*a+r[8]*n+r[12])/s,e[1]=(r[1]*i+r[5]*a+r[9]*n+r[13])/s,e[2]=(r[2]*i+r[6]*a+r[10]*n+r[14])/s,e}function Sl(e,t,r){var i=t[0],a=t[1],n=t[2];return e[0]=i*r[0]+a*r[3]+n*r[6],e[1]=i*r[1]+a*r[4]+n*r[7],e[2]=i*r[2]+a*r[5]+n*r[8],e}function Cl(e,t,r){var i=r[0],a=r[1],n=r[2],s=r[3],o=t[0],c=t[1],l=t[2],h=a*l-n*c,d=n*o-i*l,u=i*c-a*o;return h=h+h,d=d+d,u=u+u,e[0]=o+s*h+a*u-n*d,e[1]=c+s*d+n*h-i*u,e[2]=l+s*u+i*d-a*h,e}function El(e,t,r,i){var a=[],n=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],n[0]=a[0],n[1]=a[1]*Math.cos(i)-a[2]*Math.sin(i),n[2]=a[1]*Math.sin(i)+a[2]*Math.cos(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function kl(e,t,r,i){var a=[],n=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],n[0]=a[2]*Math.sin(i)+a[0]*Math.cos(i),n[1]=a[1],n[2]=a[2]*Math.cos(i)-a[0]*Math.sin(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function Ml(e,t,r,i){var a=[],n=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],n[0]=a[0]*Math.cos(i)-a[1]*Math.sin(i),n[1]=a[0]*Math.sin(i)+a[1]*Math.cos(i),n[2]=a[2],e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function Tl(e,t){var r=e[0],i=e[1],a=e[2],n=t[0],s=t[1],o=t[2],c=Math.sqrt((r*r+i*i+a*a)*(n*n+s*s+o*o)),l=c&&Dt(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}function Pl(e){return e[0]=0,e[1]=0,e[2]=0,e}function Rl(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Il(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Bl(e,t){var r=e[0],i=e[1],a=e[2],n=t[0],s=t[1],o=t[2];return Math.abs(r-n)<=ie*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=ie*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-o)<=ie*Math.max(1,Math.abs(a),Math.abs(o))}var Ll=qi,Dl=Ki,Fl=Xi,Ol=Qi,zl=Ji,Br=Yi,Nl=$i,Ul=(function(){var e=nr();return function(t,r,i,a,n,s){var o,c;for(r||(r=3),i||(i=0),a?c=Math.min(a*r+i,t.length):c=t.length,o=i;o<c;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],n(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}})();function Hl(){var e=new he(4);return he!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ea(e){var t=new he(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ta(e,t,r,i){var a=new he(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a}function ra(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ia(e,t,r,i,a){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e}function aa(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function na(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function sa(e){var t=e[0],r=e[1],i=e[2],a=e[3];return Math.sqrt(t*t+r*r+i*i+a*a)}function oa(e){var t=e[0],r=e[1],i=e[2],a=e[3];return t*t+r*r+i*i+a*a}function la(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=r*r+i*i+a*a+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=i*s,e[2]=a*s,e[3]=n*s,e}function Lr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ha(e,t,r,i){var a=t[0],n=t[1],s=t[2],o=t[3];return e[0]=a+i*(r[0]-a),e[1]=n+i*(r[1]-n),e[2]=s+i*(r[2]-s),e[3]=o+i*(r[3]-o),e}function ca(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}var rd=(function(){var e=Hl();return function(t,r,i,a,n,s){var o,c;for(r||(r=4),i||(i=0),a?c=Math.min(a*r+i,t.length):c=t.length,o=i;o<c;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],n(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}})();function Dr(){var e=new he(4);return he!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Wl(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function fa(e,t,r){r=r*.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function Vl(e,t){var r=Math.acos(t[3])*2,i=Math.sin(r/2);return i>ie?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function jl(e,t){var r=ga(e,t);return Math.acos(2*r*r-1)}function da(e,t,r){var i=t[0],a=t[1],n=t[2],s=t[3],o=r[0],c=r[1],l=r[2],h=r[3];return e[0]=i*h+s*o+a*l-n*c,e[1]=a*h+s*c+n*o-i*l,e[2]=n*h+s*l+i*c-a*o,e[3]=s*h-i*o-a*c-n*l,e}function Zl(e,t,r){r*=.5;var i=t[0],a=t[1],n=t[2],s=t[3],o=Math.sin(r),c=Math.cos(r);return e[0]=i*c+s*o,e[1]=a*c+n*o,e[2]=n*c-a*o,e[3]=s*c-i*o,e}function Yl(e,t,r){r*=.5;var i=t[0],a=t[1],n=t[2],s=t[3],o=Math.sin(r),c=Math.cos(r);return e[0]=i*c-n*o,e[1]=a*c+s*o,e[2]=n*c+i*o,e[3]=s*c-a*o,e}function ql(e,t,r){r*=.5;var i=t[0],a=t[1],n=t[2],s=t[3],o=Math.sin(r),c=Math.cos(r);return e[0]=i*c+a*o,e[1]=a*c-i*o,e[2]=n*c+s*o,e[3]=s*c-n*o,e}function Kl(e,t){var r=t[0],i=t[1],a=t[2];return e[0]=r,e[1]=i,e[2]=a,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-a*a)),e}function ua(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=Math.sqrt(r*r+i*i+a*a),o=Math.exp(n),c=s>0?o*Math.sin(s)/s:0;return e[0]=r*c,e[1]=i*c,e[2]=a*c,e[3]=o*Math.cos(s),e}function pa(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=Math.sqrt(r*r+i*i+a*a),o=s>0?Math.atan2(s,n)/s:0;return e[0]=r*o,e[1]=i*o,e[2]=a*o,e[3]=.5*Math.log(r*r+i*i+a*a+n*n),e}function Xl(e,t,r){return pa(e,t),ma(e,e,r),ua(e,e),e}function or(e,t,r,i){var a=t[0],n=t[1],s=t[2],o=t[3],c=r[0],l=r[1],h=r[2],d=r[3],u,f,v,p,g;return f=a*c+n*l+s*h+o*d,f<0&&(f=-f,c=-c,l=-l,h=-h,d=-d),1-f>ie?(u=Math.acos(f),v=Math.sin(u),p=Math.sin((1-i)*u)/v,g=Math.sin(i*u)/v):(p=1-i,g=i),e[0]=p*a+g*c,e[1]=p*n+g*l,e[2]=p*s+g*h,e[3]=p*o+g*d,e}function Ql(e){var t=Oe(),r=Oe(),i=Oe(),a=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*r),e[1]=a*Math.cos(2*Math.PI*r),e[2]=n*Math.sin(2*Math.PI*i),e[3]=n*Math.cos(2*Math.PI*i),e}function Jl(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=r*r+i*i+a*a+n*n,o=s?1/s:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-a*o,e[3]=n*o,e}function $l(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function va(e,t){var r=t[0]+t[4]+t[8],i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[a*3+a]&&(a=2);var n=(a+1)%3,s=(a+2)%3;i=Math.sqrt(t[a*3+a]-t[n*3+n]-t[s*3+s]+1),e[a]=.5*i,i=.5/i,e[3]=(t[n*3+s]-t[s*3+n])*i,e[n]=(t[n*3+a]+t[a*3+n])*i,e[s]=(t[s*3+a]+t[a*3+s])*i}return e}function eh(e,t,r,i){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Oi,n=Math.PI/360;t*=n,i*=n,r*=n;var s=Math.sin(t),o=Math.cos(t),c=Math.sin(r),l=Math.cos(r),h=Math.sin(i),d=Math.cos(i);switch(a){case"xyz":e[0]=s*l*d+o*c*h,e[1]=o*c*d-s*l*h,e[2]=o*l*h+s*c*d,e[3]=o*l*d-s*c*h;break;case"xzy":e[0]=s*l*d-o*c*h,e[1]=o*c*d-s*l*h,e[2]=o*l*h+s*c*d,e[3]=o*l*d+s*c*h;break;case"yxz":e[0]=s*l*d+o*c*h,e[1]=o*c*d-s*l*h,e[2]=o*l*h-s*c*d,e[3]=o*l*d+s*c*h;break;case"yzx":e[0]=s*l*d+o*c*h,e[1]=o*c*d+s*l*h,e[2]=o*l*h-s*c*d,e[3]=o*l*d-s*c*h;break;case"zxy":e[0]=s*l*d-o*c*h,e[1]=o*c*d+s*l*h,e[2]=o*l*h+s*c*d,e[3]=o*l*d-s*c*h;break;case"zyx":e[0]=s*l*d-o*c*h,e[1]=o*c*d+s*l*h,e[2]=o*l*h-s*c*d,e[3]=o*l*d+s*c*h;break;default:throw new Error("Unknown angle order "+a)}return e}function th(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var rh=ea,ih=ta,ah=ra,nh=ia,sh=aa,oh=da,ma=na,ga=Lr,lh=ha,ba=sa,hh=ba,xa=oa,ch=xa,Fr=la,fh=ca;function dh(e,t){return Math.abs(Lr(e,t))>=1-ie}var uh=(function(){var e=nr(),t=sr(1,0,0),r=sr(0,1,0);return function(i,a,n){var s=Dt(a,n);return s<-.999999?(Ft(e,t,a),Br(e)<1e-6&&Ft(e,r,a),Ir(e,e),fa(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Ft(e,a,n),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,Fr(i,i))}})(),ph=(function(){var e=Dr(),t=Dr();return function(r,i,a,n,s,o){return or(e,i,s,o),or(t,a,n,o),or(r,e,t,2*o*(1-o)),r}})(),vh=(function(){var e=Rr();return function(t,r,i,a){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Fr(t,va(t,e))}})();var re={};Lt(re,{add:()=>yh,angle:()=>Uh,ceil:()=>_h,clone:()=>mh,copy:()=>bh,create:()=>ya,cross:()=>Ih,dist:()=>Xh,distance:()=>Sa,div:()=>Kh,divide:()=>Aa,dot:()=>Rh,equals:()=>jh,exactEquals:()=>Vh,floor:()=>wh,forEach:()=>$h,fromValues:()=>gh,inverse:()=>Th,len:()=>Zh,length:()=>Ea,lerp:()=>Bh,max:()=>Sh,min:()=>Ah,mul:()=>qh,multiply:()=>wa,negate:()=>Mh,normalize:()=>Ph,random:()=>Lh,rotate:()=>Nh,round:()=>Ch,scale:()=>Eh,scaleAndAdd:()=>kh,set:()=>xh,signedAngle:()=>Hh,sqrDist:()=>Qh,sqrLen:()=>Jh,squaredDistance:()=>Ca,squaredLength:()=>ka,str:()=>Wh,sub:()=>Yh,subtract:()=>_a,transformMat2:()=>Dh,transformMat2d:()=>Fh,transformMat3:()=>Oh,transformMat4:()=>zh,zero:()=>Gh});function ya(){var e=new he(2);return he!=Float32Array&&(e[0]=0,e[1]=0),e}function mh(e){var t=new he(2);return t[0]=e[0],t[1]=e[1],t}function gh(e,t){var r=new he(2);return r[0]=e,r[1]=t,r}function bh(e,t){return e[0]=t[0],e[1]=t[1],e}function xh(e,t,r){return e[0]=t,e[1]=r,e}function yh(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function _a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function wa(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function Aa(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function _h(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function wh(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Ah(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function Sh(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function Ch(e,t){return e[0]=Xe(t[0]),e[1]=Xe(t[1]),e}function Eh(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function kh(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function Sa(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function Ca(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function Ea(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function ka(e){var t=e[0],r=e[1];return t*t+r*r}function Mh(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Th(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Ph(e,t){var r=t[0],i=t[1],a=r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e}function Rh(e,t){return e[0]*t[0]+e[1]*t[1]}function Ih(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function Bh(e,t,r,i){var a=t[0],n=t[1];return e[0]=a+i*(r[0]-a),e[1]=n+i*(r[1]-n),e}function Lh(e,t){t=t===void 0?1:t;var r=Oe()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Dh(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[2]*a,e[1]=r[1]*i+r[3]*a,e}function Fh(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[2]*a+r[4],e[1]=r[1]*i+r[3]*a+r[5],e}function Oh(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[3]*a+r[6],e[1]=r[1]*i+r[4]*a+r[7],e}function zh(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[4]*a+r[12],e[1]=r[1]*i+r[5]*a+r[13],e}function Nh(e,t,r,i){var a=t[0]-r[0],n=t[1]-r[1],s=Math.sin(i),o=Math.cos(i);return e[0]=a*o-n*s+r[0],e[1]=a*s+n*o+r[1],e}function Uh(e,t){var r=e[0],i=e[1],a=t[0],n=t[1];return Math.abs(Math.atan2(i*a-r*n,r*a+i*n))}function Hh(e,t){var r=e[0],i=e[1],a=t[0],n=t[1];return Math.atan2(r*n-i*a,r*a+i*n)}function Gh(e){return e[0]=0,e[1]=0,e}function Wh(e){return"vec2("+e[0]+", "+e[1]+")"}function Vh(e,t){return e[0]===t[0]&&e[1]===t[1]}function jh(e,t){var r=e[0],i=e[1],a=t[0],n=t[1];return Math.abs(r-a)<=ie*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-n)<=ie*Math.max(1,Math.abs(i),Math.abs(n))}var Zh=Ea,Yh=_a,qh=wa,Kh=Aa,Xh=Sa,Qh=Ca,Jh=ka,$h=(function(){var e=ya();return function(t,r,i,a,n,s){var o,c;for(r||(r=2),i||(i=0),a?c=Math.min(a*r+i,t.length):c=t.length,o=i;o<c;o+=r)e[0]=t[o],e[1]=t[o+1],n(e,e,s),t[o]=e[0],t[o+1]=e[1];return t}})();var ms=Pr(vs()),V=class e{static Sign(t){return t<0?-1:t>0?1:0}static Mat3FromMat4(t){var r=ve.create();return ve.fromMat4(r,t),r}static NormalizeVec3InPlace(t,r){var i=1/Math.sqrt(t[r]*t[r]+t[r+1]*t[r+1]+t[r+2]*t[r+2]);t[r]*=i,t[r+1]*=i,t[r+2]*=i}static GetDefault(t,r,i){return r in t?t[r]:i}static PushOrCreateArray(t,r,i){r in t||(t[r]=[]),t[r].push(i)}static{this.DecoderArray=null}static Base64ToArrayBuffer(t){if(e.DecoderArray==null){let g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.DecoderArray={};for(var r=0;r<g.length;r++)e.DecoderArray[g.charCodeAt(r)]=r}var i=t.length/4*3;t.indexOf("=")>0&&(i-=t.length-t.indexOf("="));for(var a=new ArrayBuffer(i),n=new Uint8Array(a),r=0,s=0;r<i;r+=3){var o=t.charCodeAt(s++),c=t.charCodeAt(s++),l=t.charCodeAt(s++),h=t.charCodeAt(s++),d=e.DecoderArray[o],u=e.DecoderArray[c],f=e.DecoderArray[l],v=e.DecoderArray[h];n[r]=d<<2|u>>4,f!=64&&(n[r+1]=(u&15)<<4|f>>2),v!=64&&(n[r+2]=(f&3)<<6|v)}let p;try{p=ms.inflate(n)}catch{return a}return p.buffer}static DataUrlToBlob(t){let r=t.split(","),i=r[0].match(/:(.*?);/)[1],a=new Uint8Array(e.Base64ToArrayBuffer(r[1]));return new Blob([a],{type:i})}static Base64ToBlob(t,r){let i=new Uint8Array(e.Base64ToArrayBuffer(t));return new Blob([i],{type:r})}static DataUrlToArrayBuffer(t){let r=t.split(",");return e.Base64ToArrayBuffer(r[1])}static Base64ToFloat32Array(t){return t==null?null:typeof t=="string"?new Float32Array(e.Base64ToArrayBuffer(t)):new Float32Array(t)}static Base64ToUInt8Array(t){return t==null?null:typeof t=="string"?new Uint8Array(e.Base64ToArrayBuffer(t)):new Uint8Array(t)}static Base64ToUInt16Array(t){return t==null?null:typeof t=="string"?new Uint16Array(e.Base64ToArrayBuffer(t)):new Uint16Array(t)}static Base64ToUInt32Array(t){return t==null?null:typeof t=="string"?new Uint32Array(e.Base64ToArrayBuffer(t)):new Uint32Array(t)}static GetSearchValue(t){for(var r=location.search.substring(1),i=r.split("&"),a=0;a<i.length;a++){var n=i[a].split("=");if(decodeURIComponent(n[0])==t)return decodeURIComponent(n[1])}return null}static StyleToHtmlHex(t){if(t[0]==1)return null;let r=t[1],i=t[2],a=t[3];return"#"+e.Byte2Hex(r)+e.Byte2Hex(i)+e.Byte2Hex(a)}static Byte2Hex(t){let r="0123456789ABCDEF";return String(r.substr(t>>4&15,1))+r.substr(t&15,1)}static IsPow2(t){var r=Math.log(t)/Math.log(2);return r==Math.floor(r)}static AssertNotNull(t,r){if(t==null)throw new Error(r);return t}};var kt=class{constructor(t=!1){this.object=null,this.countUsers=0,this.cachePermanently=t}AddUser(t){this.countUsers+=1,this.object==null&&this.GenerateObject(t)}RemoveUser(){if(this.countUsers-=1,!this.cachePermanently){var t=this;setTimeout(function(){t.countUsers==0&&(t.object=null)},50)}}GetObject(){return this.object}},gi=class extends kt{constructor(t,r=!1){super(r),this.src=t}GenerateObject(t){this.object=new Image,this.object.addEventListener("load",t),this.object.src=this.src}GetObject(){return this.object==null||!this.object.complete?null:this.object}GetBlob(){return V.DataUrlToBlob(this.src)}},bi=class extends kt{constructor(t,r,i=!1){super(i),this.audio=t,this.src=r}GenerateObject(t){this.object=this.audio,this.object.addEventListener("loadeddata",t);let r=URL.createObjectURL(this.GetBlob());this.object.src=r}GetObject(){return this.object==null?null:this.object}GetBlob(){return V.DataUrlToBlob(this.src)}},xi=class extends kt{constructor(t,r,i=!1){super(i),this.video=t,this.src=r}GenerateObject(t){this.object=this.video,this.object.addEventListener("loadeddata",()=>{t()});let r=URL.createObjectURL(this.GetBlob());this.object.src=r}GetObject(){return this.object==null?null:this.object}GetBlob(){return V.DataUrlToBlob(this.src)}},yi=class extends kt{constructor(t,r,i,a,n,s,o,c=!1){super(c),this.text=t,this.fillStyle=r,this.fontFamily=i,this.fontSizePx=a,this.horizAlign=n,this.vertAlign=s,this.offsetDistance=o}GenerateObject(t){var r=1.2,i=document.createElement("canvas"),a=i.getContext("2d"),n=(this.fontSizePx*window.devicePixelRatio).toString()+"px "+this.fontFamily;a.font=n;var s=a.measureText(this.text).width,o=r*this.fontSizePx*window.devicePixelRatio;i.width=s,i.height=o,a.textAlign="center",a.textBaseline="middle",a.clearRect(0,0,s,o),a.fillStyle=this.fillStyle,a.font=n,a.fillText(this.text,s/2,o/2),this.object=i,this.object.desiredWidthPixels=s,this.object.desiredHeightPixels=o,this.object.proportionTranslateScreenX=-.5*this.horizAlign,this.object.proportionTranslateScreenY=-.5*this.vertAlign/r,this.object.offsetDistance=this.offsetDistance,t()}GetBlob(){throw new Error("Not Implemented")}},Sr=class{constructor(t){this.owners={};this.token=0;this.cachedObjects={},this.callback=t}AddUser(t){t in this.cachedObjects&&this.cachedObjects[t].AddUser(()=>this.callback(t))}RemoveUser(t){t in this.cachedObjects&&this.cachedObjects[t].RemoveUser()}DefineImageFromSrc(t,r,i){this.cachedObjects[t]=new gi(r,i)}DefineImageFromFile(t,r){this.DefineImageFromSrc(t,r,!0)}DefineImageFromBase64(t,r,i){this.DefineImageFromSrc(t,"data:"+r+";base64,"+i,!1)}DefineAudioTrackFromBase64(t,r,i,a){this.cachedObjects[t]=new bi(r,"data:"+i+";base64,"+a,!0)}DefineVideoFromBase64(t,r,i,a){this.cachedObjects[t]=new xi(r,"data:"+i+";base64,"+a,!0)}DefineLabel(t,r,i,a,n,s,o,c){this.cachedObjects[t]=new yi(r,i,a,n,s,o,c,!1)}Acquire(t){if(t in this.owners)return null;let r=this.token.toString();return this.token+=1,this.owners[t]=r,r}Release(t,r){return t in this.owners&&this.owners[t]==r?(delete this.owners[t],!0):!1}GetObject(t){return t in this.cachedObjects?this.cachedObjects[t].GetObject():null}GetBlob(t){return t in this.cachedObjects?this.cachedObjects[t].GetBlob():null}},_i=class{constructor(t,r,i){this.distanceRatio=t;this.angleDelta=r;this.center=i}},at=class e{constructor(t,r,i,a,n,s,o,c,l){this.frameRate=r;this.width=i;this.height=a;this.SetStatus=s;this.SetWarning=o;this.RequestRedraw=c;this.ReportFrameIdChange=l;this.objectCache=null;this.sliderTextBoxLength=0;this.sliderTextBoxPadding=5;this.cameraModeCounterMax=60;this.cameraModeCounter=0;this.mediaElement=null;this.startMedia=!1;this.mediaId=null;this.globalVolume=1;this.seekTarget=null;this.isPlaying=!1;this.startPlayback=!1;this.stopPlayback=!1;this.playbackRate=1;this.firstPerson=!1;this.currentFrameIndex=0;this.lastRedraw=0;this.dataUrl=null;this.isRecording=!1;this.gotoFrame=null;this.frameIdToIndexMap={};this.frameIds=[];this.stopRenderLoop=!1;this.objectCache=n,this.container=document.createElement("div"),this.container.className="scenepic-canvas-container",this.htmlCanvas=document.createElement("canvas"),this.htmlCanvas.style.width=i.toString()+"px",this.htmlCanvas.style.height=a.toString()+"px",this.htmlCanvas.id=t,this.htmlCanvas.tabIndex=1,this.htmlCanvas.className="scenepic-canvas",this.container.appendChild(this.htmlCanvas),this.dropdown=document.createElement("div"),this.dropdown.className="scenepic-dropdown",this.dropdown.addEventListener("click",h=>{h.target==this.dropdown&&(this.dropdown.classList.toggle("is-active"),this.htmlCanvas.focus())}),this.dropdownTable=document.createElement("table"),this.dropdownTable.classList.add("scenepic-dropdown-table"),i<300?this.dropdownTable.classList.add("scenepic-left-table"):this.dropdownTable.classList.add("scenepic-right-table"),this.dropdown.appendChild(this.dropdownTable),this.container.appendChild(this.dropdown),this.htmlCanvas.addEventListener("click",()=>{this.dropdown.classList.remove("is-active"),this.htmlCanvas.focus()}),this.slider=document.createElement("input"),this.slider.type="range",this.slider.min="0",this.slider.max="0",this.slider.valueAsNumber=this.currentFrameIndex,this.slider.className="scenepic-slider",this.slider.addEventListener("change",h=>this.ReportFrameIdChange(this.htmlCanvas.id,this.GetCurrentFrameId())),this.sliderTextBox=document.createElement("span"),this.sliderTextBox.className="scenepic-slider-text",this.sliderTextBox.style.padding=this.sliderTextBoxPadding.toString()+"px",this.sliderContainer=document.createElement("div"),this.sliderContainer.className="scenepic-slider-container",this.sliderContainer.style.visibility="hidden",this.sliderContainer.appendChild(this.sliderTextBox),this.sliderContainer.appendChild(this.slider),this.container.appendChild(this.sliderContainer),this.addFPSUI(),this.addVolumeUI(),this.addCameraModeUI(),this.gotoFrame=parseInt(V.GetSearchValue("frame")),this.pointerCoords=new Map,this.initPointerCoords=new Map}static{this.TIME_PER_REDRAW=1/60}static{this.FPS_DECAY=.5}static{this.FPS_FREQUENCY=200}get Volume(){return this.globalVolume}set Volume(t){this.globalVolume=t,this.UpdateVolume()}get PlaybackRate(){if(this.mediaElement!=null)return this.mediaElement.playbackRate}set PlaybackRate(t){this.mediaElement!=null&&(this.mediaElement.playbackRate=t),this.playbackRate=t,this.fps=0}get IsRecording(){return this.isRecording}set IsRecording(t){this.dataUrl=null,this.isRecording=t}get DataUrl(){return this.dataUrl}addCameraModeUI(){this.cameraModeDisplay=document.createElement("div"),this.cameraModeDisplay.className="scenepic-camera-mode",this.cameraModeDisplay.style.visibility="hidden",this.container.appendChild(this.cameraModeDisplay)}addFPSUI(){let t=document.createElement("tr");this.fpsToggle=document.createElement("input"),this.fpsToggle.type="checkbox",this.fpsToggle.checked=!1,this.fpsToggle.addEventListener("change",()=>this.UpdateFPSDisplay());let r=document.createElement("td");r.style.textAlign="center",r.appendChild(this.fpsToggle);let i=document.createElement("td");i.innerText="FPS",t.appendChild(r),t.appendChild(i),this.dropdownTable.appendChild(t),this.fpsDisplay=document.createElement("div"),this.fpsDisplay.className="scenepic-fps",this.fpsDisplay.style.visibility="hidden",this.container.appendChild(this.fpsDisplay),this.fps=0}addVolumeUI(){this.volumeInput=document.createElement("input"),this.volumeInput.type="range",this.volumeInput.min="0",this.volumeInput.max="1",this.volumeInput.value="0.5",this.volumeInput.step="0.01",this.volumeInput.addEventListener("change",()=>this.UpdateVolume()),this.volumeToggle=document.createElement("input"),this.volumeToggle.type="checkbox",this.volumeToggle.checked=!0,this.volumeToggle.addEventListener("change",()=>this.UpdateVolume()),this.volumeContainer=document.createElement("tr"),this.volumeContainer.style.visibility="collapse";let t=document.createElement("td");t.style.textAlign="center",t.appendChild(this.volumeToggle);let r=document.createElement("td");r.innerText="Audio";let i=document.createElement("td");i.appendChild(this.volumeInput),this.volumeContainer.appendChild(t),this.volumeContainer.appendChild(r),this.volumeContainer.appendChild(i),this.dropdownTable.appendChild(this.volumeContainer)}PinchZoom(t,r){let i=this.pointerCoords.get(this.pid0),a=this.pointerCoords.get(this.pid1),n=this.pid0==r.pointerId?t:i,s=this.pid1==r.pointerId?t:a,o=re.distance(i,a),c=re.distance(n,s),l=Math.atan2(a[1]-i[1],a[0]-i[0]),h=Math.atan2(s[1]-n[1],s[0]-n[0]),d=re.add(re.create(),n,s);return re.scale(d,d,.5),new _i(c/o,h-l,d)}HandlePointerDown(t,r){this.pointerCoords.set(r.pointerId,t),this.initPointerCoords.set(r.pointerId,t),this.pointerCoords.size==1?this.pid0=r.pointerId:this.pointerCoords.size==2&&(this.pid1=r.pointerId)}HandlePointerMove(t,r){this.pointerCoords.size!=0&&this.pointerCoords.set(r.pointerId,t)}HandlePointerUp(t){if(this.pointerCoords.delete(t.pointerId),this.initPointerCoords.delete(t.pointerId),this.pointerCoords.size==1)this.pid0==t.pointerId&&(this.pid0=this.pid1);else if(this.pointerCoords.size==2){let r=this.pointerCoords.keys();this.pid0=r.next().value,this.pid1=r.next().value}}HandleMouseWheel(t){}SetMedia(t){this.mediaId=t,this.mediaElement=this.objectCache.GetObject(t),this.mediaElement!=null?(this.mediaToken=this.objectCache.Acquire(t),this.volumeContainer.style.visibility="inherit",this.UpdateVolume()):console.warn("Invalid mediaId:"+t)}UpdateFPSDisplay(){this.fpsToggle.checked?this.fpsDisplay.style.visibility="visible":this.fpsDisplay.style.visibility="hidden"}UpdateVolume(){this.mediaElement!=null&&(this.globalVolume==null?this.mediaElement.volume=0:this.volumeToggle.checked?this.mediaElement.volume=this.volumeInput.valueAsNumber*this.globalVolume:this.mediaElement.volume=0)}get FrameCount(){return this.frameIds.length}get FirstPerson(){return this.firstPerson}set FirstPerson(t){t!=this.firstPerson&&(this.cameraModeCounter=this.cameraModeCounterMax,this.firstPerson=t)}HandleKeyUp(t){}HandleKeyDown(t){var r=!0,i=!0;switch(t.toLowerCase()){case"arrowleft":case"left":i=this.ShowPreviousFrame();break;case"arrowright":case"right":i=this.ShowNextFrame();break;case"arrowup":case"up":case"arrowdown":case"down":break;case"home":i=this.ShowFrame(0);break;case"end":i=this.ShowFrame(Number.MAX_VALUE);break;default:r=!1;break}return[r,i]}ExecuteCanvasCommands(t){if(Array.isArray(t)){for(var r of t)this.ExecuteCanvasCommands(r);return}"CommandType"in t||this.SetWarning('Expecting "CommandType" in Canvas Command object: '+JSON.stringify(t)),this.ExecuteCanvasCommand(t)}ExecuteCanvasCommand(t){switch(t.CommandType){case"AddFrame":var r=String(t.FrameId);this.AddFrame(r);break;case"FrameCommands":var r=String(t.FrameId);r in this.frameIdToIndexMap?this.ExecuteFrameCommands(r,t.Commands):this.SetWarning("FrameId "+r+" not found. Try AddFrame first.");break;case"SetMedia":var i=String(t.MediaId);this.objectCache.AddUser(i),this.SetMedia(i);break;default:this.SetWarning("Unknown Canvas CommandType "+t.CommandType+" in object: "+JSON.stringify(t));break}}ExecuteFrameCommands(t,r){if(Array.isArray(r)){for(var i of r)this.ExecuteFrameCommands(t,i);return}"CommandType"in r||this.SetWarning('Expecting "CommandType" in Frame Command object: '+JSON.stringify(r));var a=this.frameIdToIndexMap[t];this.ExecuteFrameCommand(r,a)}ExecuteFrameCommand(t,r){switch(t.CommandType){case"ClearFrame":this.ClearFrame(r);break;case"ShowFrame":this.ShowFrame(r);break;default:this.SetWarning("Unknown Frame CommandType "+t.CommandType+" in object: "+JSON.stringify(t));break}}AddFrame(t){if(!(t in this.frameIdToIndexMap)){var r=this.frameIds.length;this.frameIdToIndexMap[t]=r,this.frameIds.push(t),this.AllocateFrame(),this.slider.max=r.toString(),this.sliderContainer.style.visibility=r>0?"visible":"hidden",this.gotoFrame!=null&&this.gotoFrame==r&&(this.ShowFrame(r),this.gotoFrame=null),this.currentFrameIndex==r&&(this.UpdateSliderTextBox(t),this.ReportFrameIdChange(this.htmlCanvas.id,this.GetCurrentFrameId()))}}NotifyMeshUpdated(t){}NotifyTextureUpdated(t){}ClearFrame(t){t>=this.frameIds.length||(this.DeallocateFrame(t),this.PrepareBuffers())}GetCurrentFrameId(){return this.frameIds==null||this.frameIds.length==0?null:this.frameIds[this.currentFrameIndex]}ShowFrame(t){if(this.currentFrameIndex!=t){if(this.mediaElement!=null&&this.mediaToken!=null){let i=t/this.frameRate;if(this.isPlaying){let a=t-this.currentFrameIndex;(a<0||a>3)&&(this.mediaElement.currentTime=i)}else this.mediaElement.currentTime=i}this.currentFrameIndex=Math.min(t,this.frameIds.length-1),this.slider.valueAsNumber=this.currentFrameIndex;var r=this.GetCurrentFrameId();return this.UpdateSliderTextBox(r),this.ReportFrameIdChange(this.htmlCanvas.id,r),this.PrepareBuffers(),!0}}ShowPreviousFrame(){var t=this.currentFrameIndex-1;return t==-1&&(t=this.frameIds.length-1),this.ShowFrame(t)}ShowNextFrame(){var t=this.currentFrameIndex+1;return t>=this.frameIds.length&&(t=0),this.ShowFrame(t)}UpdateSliderTextBox(t){if(this.sliderTextBox.innerHTML=t,t.length>this.sliderTextBoxLength){this.sliderTextBoxLength=t.length;var r=this.sliderTextBox.offsetWidth-2*this.sliderTextBoxPadding;this.sliderTextBox.style.minWidth=r.toString()+"px"}}PrepareBuffers(){}StopRenderLoop(){this.stopRenderLoop=!0}StartRenderLoop(){this.stopRenderLoop=!1,requestAnimationFrame(()=>this.Tick())}Tick(){if(this.stopRenderLoop)return;var t=window.devicePixelRatio,r=Math.floor(this.htmlCanvas.clientWidth*t),i=Math.floor(this.htmlCanvas.clientHeight*t);(this.htmlCanvas.width!=r||this.htmlCanvas.height!=i)&&(this.htmlCanvas.width=r,this.htmlCanvas.height=i);let a=Date.now();if(this.cameraModeCounter>0&&(this.cameraModeDisplay.style.opacity=(this.cameraModeCounter/this.cameraModeCounterMax).toString(),this.cameraModeDisplay.innerText=this.firstPerson?"First Person":"Focus",this.cameraModeCounter-=1),this.startPlayback&&(this.startPlayback=!1,this.fps=0,this.isPlaying=!0,this.startTime=a,this.numFrames=0,this.lastFrameTime=a,this.startMedia=!0),this.stopPlayback&&(this.startMedia=!1,this.stopPlayback=!1,this.isPlaying=!1,this.fpsDisplay.innerText="",this.mediaElement!=null&&this.mediaElement.pause()),this.isPlaying){let n;if(this.mediaElement!=null)n=Math.round(this.mediaElement.currentTime*this.frameRate),n>=this.frameIds.length&&(this.mediaElement.currentTime=0);else{let s=1e3/(this.playbackRate*this.frameRate),c=Date.now()-this.lastFrameTime;for(n=this.currentFrameIndex;c>s;)n+=1,c-=s,this.lastFrameTime+=s,n>=this.frameIds.length&&(n=0)}if(n!=this.currentFrameIndex&&(this.ShowFrame(n),this.numFrames+=1,a-this.startTime>=e.FPS_FREQUENCY)){let o=1e3*this.numFrames/(a-this.startTime);this.fps=this.fps*e.FPS_DECAY+(1-e.FPS_DECAY)*o,this.numFrames=0,this.startTime=a,this.fpsDisplay.innerText=this.fps.toFixed(2)+" fps"}}this.startMedia&&this.mediaElement!=null&&(this.startMedia=!1,this.mediaElement.playbackRate=this.playbackRate,this.mediaElement.play()),requestAnimationFrame(()=>this.Tick()),a-this.lastRedraw>e.TIME_PER_REDRAW&&(this.Render(),this.lastRedraw=a),this.isRecording&&(this.dataUrl=this.htmlCanvas.toDataURL())}StartPlaying(){this.startPlayback=!0,this.stopPlayback=!1}StopPlaying(){this.stopPlayback=!0,this.startPlayback=!1}};var $t=class{static partialCopy(t,r,i,a,n){t=Float32Array.from(t);for(let s=0,o=0;s<t.length;s+=r,o+=n)t.set(i.slice(o,o+n),s+a);return t}static copyPosition(t,r,i){return i==3?r:this.partialCopy(t,i,r,0,3)}static copyNormal(t,r,i){return this.partialCopy(t,i,r,3,3)}static copyRotation(t,r,i){return this.partialCopy(t,i,r,3,4)}static copyColor(t,r,i){return this.partialCopy(t,i,r,i-3,3)}static copyPositionRotation(t,r,i){return i==7?r:this.partialCopy(t,i,r,0,7)}static copyPositionNormal(t,r,i){return i==6?r:this.partialCopy(t,i,r,0,6)}static copyPositionColor(t,r,i){if(i==6)return r;let a=i-3;t=Float32Array.from(t);for(let n=0,s=0;n<t.length;n+=i,s+=6)t.set(r.slice(s,s+3),n),t.set(r.slice(s+3,s+6),n+a);return t}static copyRotationColor(t,r,i){return this.partialCopy(t,i,r,3,7)}static copyNormalColor(t,r,i){return this.partialCopy(t,i,r,3,6)}static Update(t,r,i,a){switch(a){case 1:return this.copyPosition(t,i,r);case 2:return this.copyNormal(t,i,r);case 8:return this.copyRotation(t,i,r);case 4:return this.copyColor(t,i,r);case 9:return this.copyPositionRotation(t,i,r);case 3:return this.copyPositionNormal(t,i,r);case 5:return this.copyPositionColor(t,i,r);case 12:return this.copyRotationColor(t,i,r);case 6:return this.copyNormalColor(t,i,r);case 7:return i;case 13:return i}return t}};var Be=class e{constructor(t,r,i,a,n,s=null,o=!0,c=!0,l=null,h=!1,d=!1){this.VertexOffsetPosition=0;this.VertexOffsetNormal=3;this.VertexOffsetColor=0;this.VertexOffsetTexture=0;this.InstanceOffsetPosition=0;this.InstanceOffsetRotation=0;this.InstanceOffsetColor=0;if(this.vertexBuffer=t,this.bytesPerIndex=r,this.triangleBuffer=i,this.lineBuffer=a,this.wireframeEdgeBuffer=null,this.color=n,this.textureId=s,this.isBillboard=!1,this.isLabel=!1,this.nnTexture=o,this.useTextureAlpha=c,this.cameraSpace=!1,this.layerId=null,l==null?(this.instanceBuffer=null,this.instanceBufferHasRotations=!1,this.instanceBufferHasColors=!1):(this.instanceBuffer=l,this.instanceBufferHasRotations=h,this.instanceBufferHasColors=d),this.ElementsPerVertex=6,this.color==null&&(this.VertexOffsetColor=this.ElementsPerVertex,this.ElementsPerVertex+=3),this.textureId!=null&&(this.VertexOffsetTexture=this.ElementsPerVertex,this.ElementsPerVertex+=2),this.ElementsPerInstance=3,this.instanceBufferHasRotations&&(this.InstanceOffsetRotation=this.ElementsPerInstance,this.ElementsPerInstance+=4),this.instanceBufferHasColors&&(this.InstanceOffsetColor=this.ElementsPerInstance,this.ElementsPerInstance+=3),this.centerOfMass=J.create(),this.CountVertices()>0){for(var u=0;u<this.vertexBuffer.length;u+=this.ElementsPerVertex)this.centerOfMass[0]+=this.vertexBuffer[u+0],this.centerOfMass[1]+=this.vertexBuffer[u+1],this.centerOfMass[2]+=this.vertexBuffer[u+2];this.centerOfMass[0]/=this.CountVertices(),this.centerOfMass[1]/=this.CountVertices(),this.centerOfMass[2]/=this.CountVertices()}}static{this.ElementsPerTriangle=3}static{this.ElementsPerLine=2}CountVertices(){return this.vertexBuffer.length/this.ElementsPerVertex}CountTriangles(){return this.triangleBuffer.byteLength/(this.bytesPerIndex*e.ElementsPerTriangle)}CountLines(){return this.lineBuffer.byteLength/(this.bytesPerIndex*e.ElementsPerLine)}CountWireframeEdges(){return this.wireframeEdgeBuffer!=null?this.wireframeEdgeBuffer.byteLength/(this.bytesPerIndex*e.ElementsPerLine):0}CountInstances(){return this.instanceBuffer!=null?this.instanceBuffer.length/this.ElementsPerInstance:1}Update(t,r){return this.CountInstances()>1?this.ToInstanceBuffer(t,r):this.ToVertexBuffer(t,r)}ToInstanceBuffer(t,r){let i=$t.Update(this.instanceBuffer,this.ElementsPerInstance,t,r),a=new e(this.vertexBuffer,this.bytesPerIndex,this.triangleBuffer,this.lineBuffer,this.color,this.textureId,this.nnTexture,this.useTextureAlpha,i,this.instanceBufferHasRotations,this.instanceBufferHasColors);return a.cameraSpace=this.cameraSpace,a.layerId=this.layerId,a.doubleSided=this.doubleSided,a.isBillboard=this.isBillboard,a.isLabel=this.isLabel,a}ToVertexBuffer(t,r){let i=$t.Update(this.vertexBuffer,this.ElementsPerVertex,t,r),a=new e(i,this.bytesPerIndex,this.triangleBuffer,this.lineBuffer,this.color,this.textureId,this.nnTexture,this.useTextureAlpha,this.instanceBuffer,this.instanceBufferHasRotations,this.instanceBufferHasColors);return a.cameraSpace=this.cameraSpace,a.layerId=this.layerId,a.doubleSided=this.doubleSided,a.isBillboard=this.isBillboard,a.isLabel=this.isLabel,a}static Parse(t){var r=null,i=null,a=!0,n=!0;switch(t.PrimitiveType){case"SingleColorMesh":r=V.Base64ToFloat32Array(t.Color),i=V.GetDefault(t,"TextureId",null),a=V.GetDefault(t,"NearestNeighborTexture",!0),n=V.GetDefault(t,"UseTextureAlpha",!1);case"MultiColorMesh":let f=V.Base64ToFloat32Array(t.VertexBuffer);var s=t.IndexBufferType,o,c,l;s=="UInt16"?(o=2,c=V.Base64ToUInt16Array(t.TriangleBuffer).buffer,l=V.Base64ToUInt16Array(t.LineBuffer).buffer):(o=4,c=V.Base64ToUInt32Array(t.TriangleBuffer).buffer,l=V.Base64ToUInt32Array(t.LineBuffer).buffer);var h=V.Base64ToFloat32Array(t.InstanceBuffer),d=V.GetDefault(t,"InstanceBufferHasRotations",!1),u=V.GetDefault(t,"InstanceBufferHasColors",!1);return new e(f,o,c,l,r,i,a,n,h,d,u);default:throw'Unknown "Primitive" type in mesh: '+JSON.stringify(t)}}GetWireframeEdgeBuffer(){if(this.wireframeEdgeBuffer==null){this.wireframeEdgeBuffer=new ArrayBuffer(this.triangleBuffer.byteLength*2);for(var t=this.bytesPerIndex==2?new Uint16Array(this.triangleBuffer):new Uint32Array(this.triangleBuffer),r=this.bytesPerIndex==2?new Uint16Array(this.wireframeEdgeBuffer):new Uint32Array(this.wireframeEdgeBuffer),i=0;i<t.length;i+=3)r[2*i+5]=r[2*i+0]=t[i+0],r[2*i+2]=r[2*i+1]=t[i+1],r[2*i+4]=r[2*i+3]=t[i+2]}return this.wireframeEdgeBuffer}};var gs={defaultVertex:{type:"x-shader/x-vertex",script:`
// Vertex inputs
attribute vec3 vertexPositionIn;
attribute vec3 vertexNormalIn;
attribute vec3 vertexColorIn;
attribute vec2 vertexTextureIn;

// Instance inputs
attribute vec3 instancePositionIn;
attribute vec4 instanceRotationIn; // Quaternion
attribute vec3 instanceColorIn;

// Where to get color from (0 = per-vertex, 1 = shared-color, 2 = instance-color)
uniform int colorSource;

// Shared Color
uniform vec3 sharedColor;

// Transformation matrices
uniform int useInstanceRotation;
uniform mat4 projMatrix; // Incorporates: model to world to view to screen
uniform mat4 m2vMatrix; // Incorporates: model to world to view
uniform mat3 normMatrix;

// Alpha
uniform float alpha;

// Outputs
varying vec4 vertexColor; // Color with alpha
varying vec2 vertexTextureCoord; // Texture
varying vec3 positionView;
varying vec3 normalView;

void main()
{
    // Rotation by quaternion
    vec3 vertexPosition = vertexPositionIn;
    vec3 vertexNormal = vertexNormalIn;
    if (useInstanceRotation == 1)
    {
        // Apply quaternion rotation to position and normal
        // https://en.wikipedia.org/wiki/Quaternions_and_spatial_rotation
        vertexPosition += 2.0 * cross(instanceRotationIn.xyz, cross(instanceRotationIn.xyz, vertexPosition) + instanceRotationIn.w * vertexPosition);
        vertexNormal += 2.0 * cross(instanceRotationIn.xyz, cross(instanceRotationIn.xyz, vertexNormal) + instanceRotationIn.w * vertexNormal); 
    }
    vertexPosition += instancePositionIn;

    // Transform position and normal
    gl_Position = projMatrix * vec4(vertexPosition, 1.0);
    positionView = (m2vMatrix * vec4(vertexPosition, 1.0)).rgb; // Unprojected version of above, for fragment shading
    normalView = normalize(normMatrix * vertexNormal).rgb;

    // Color etc. information
    if (colorSource == 2) // Per-instance color
    {
        vertexColor.rgb = instanceColorIn;
    }
    else if (colorSource == 1) // Shared color
    {
        vertexColor.rgb = sharedColor;
    }
    else // Per vertex color
    {
        vertexColor.rgb = vertexColorIn;
    }

    // Set alpha
    vertexColor.a = alpha;

    // Copy texture coordinates
    vertexTextureCoord = vertexTextureIn;
}
`},defaultFragment:{type:"x-shader/x-fragment",script:`
precision mediump float;

// Lighting
uniform float lightingMultiplier;
uniform vec3 ambientLightColor;
uniform vec3 directionalLightDir;
uniform vec3 directionalLightColor;

varying vec4 vertexColor;
varying vec2 vertexTextureCoord;
varying vec3 positionView;
varying vec3 normalView;

uniform int shadingType;
uniform sampler2D sampler; // Represents the texture

// Constants
float FresBias = 0.0;
float FresStren = 1.0;
float FresPow = 2.0;
float GaussConstant = 100.0;
float PI = 3.1415926;

float saturate(float f)
{
  return clamp(f, 0.0, 1.0);  
}

float f_lambert(vec3 normal, vec3 light)
{
  return max(0.0, dot(normal, light));
}

float f_cook_torrance(vec3 normal, vec3 viewer, vec3 light, float roughness)
{  
    // Compute intermediary values
    vec3 half_vector = normalize(light + viewer);
    float NdotL = saturate(dot(normal, light));
    float NdotH = saturate(dot(normal, half_vector));
    float NdotV = saturate(dot(normal, viewer));
    float VdotH = saturate(dot(viewer, half_vector));

    // Approximate the Fresnel value
    float F = FresBias + FresStren * pow((1.0 - NdotV), FresPow);
    F = saturate(F);

    // Microfacet distribution
    float alpha = acos(NdotH);
    float D = GaussConstant * exp(-(alpha * alpha) / (roughness * roughness));

    // Geometric attenuation factor
    float G = min(1.0, min((2.0 * NdotH * NdotV / VdotH), (2.0 * NdotH * NdotL / VdotH)));

    return saturate(max(0.001, ((F * D * G) / (PI * NdotV * NdotL))));
}

void main()
{
    if (shadingType == -1) // Vertex shading only, not pixel shading
    {
        gl_FragColor = vertexColor;
        gl_FragColor.rgb *= lightingMultiplier;
    }
    else
    {
        vec3 L = normalize(directionalLightDir);
        vec3 V = normalize(-positionView);
        vec3 N = normalize(normalView);

        // Diffuse color and alpha
        vec3 diffCol;
        float alpha;
        if (shadingType == 0) // Vertex color
        {
            diffCol = vertexColor.rgb;
            alpha = vertexColor.a;
        }
        else if (shadingType == 1 || shadingType == 2) // Texture
        {
            vec4 texCol = texture2D(sampler, vertexTextureCoord);
            diffCol = texCol.rgb;
            alpha = texCol.a * vertexColor.a; // Preserve texture alpha
        }
        else // ERROR: Unknown shader
        {
            diffCol = vec3(1.0, 0.0, 0.0);
            alpha = 1.0;
        }

        // Specular color
        vec3 specCol = vec3(1.0, 1.0, 1.0) * 0.75;
        
        // Lighting
        gl_FragColor.rgb = ambientLightColor * diffCol;
        if (shadingType != 2) // Don't apply this to labels
        {
            gl_FragColor.rgb += directionalLightColor * diffCol * f_lambert(N, L);
            gl_FragColor.rgb += directionalLightColor * specCol * f_cook_torrance(N, V, L, 0.2);
            gl_FragColor.rgb *= lightingMultiplier;
        }
        gl_FragColor.a = alpha;
    }
}
`},pickerVertex:{type:"x-shader/x-vertex",script:`#version 300 es
// Vertex inputs
in vec3 vertexPositionIn;

// Instance inputs
in vec3 instancePositionIn;
in vec4 instanceRotationIn; // Quaternion

// Transformation matrices
uniform int useInstanceRotation;
uniform mat4 projMatrix; // Incorporates: model to world to view to screen
uniform mat4 m2vMatrix; // Incorporates: model to world to view

void main()
{
    // Rotation by quaternion
    vec3 vertexPosition = vertexPositionIn;
    if (useInstanceRotation == 1)
    {
        // Apply quaternion rotation to position and normal
        // https://en.wikipedia.org/wiki/Quaternions_and_spatial_rotation
        vertexPosition += 2.0 * cross(instanceRotationIn.xyz, cross(instanceRotationIn.xyz, vertexPosition) + instanceRotationIn.w * vertexPosition);
    }
    vertexPosition += instancePositionIn;

    // Transform position and normal
    gl_Position = projMatrix * vec4(vertexPosition, 1.0);
}
`},pickerFragment:{type:"x-shader/x-fragment",script:`#version 300 es
precision mediump float;
  
uniform int u_id;
out vec4 o_fragColor;  

void main() {
  float r = float(u_id & 0xFF);
  float g = float((u_id >> 8) & 0xFF);
  float b = float((u_id >> 16) & 0xFF);
  o_fragColor = vec4(vec3(r, g, b) / 255.0, 1.0);
}
`}};function bs(e,t){var r;if(t.type=="x-shader/x-fragment")r=e.createShader(e.FRAGMENT_SHADER);else if(t.type=="x-shader/x-vertex")r=e.createShader(e.VERTEX_SHADER);else return null;if(e.shaderSource(r,t.script),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw console.error(e.getShaderInfoLog(r)),new Error("WebGL shader compilation error");return r}var ut=class{constructor(t,r,i){if(this.vertexShader=bs(t,gs[r]),this.fragmentShader=bs(t,gs[i]),this.program=t.createProgram(),t.attachShader(this.program,this.vertexShader),t.attachShader(this.program,this.fragmentShader),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))throw console.error(t.getProgramInfoLog(this.program)),new Error("WebGL Program linking error");t.useProgram(this.program),this.vertexPositionAttribLoc=t.getAttribLocation(this.program,"vertexPositionIn"),this.vertexNormalAttribLoc=t.getAttribLocation(this.program,"vertexNormalIn"),this.vertexColorAttribLoc=t.getAttribLocation(this.program,"vertexColorIn"),this.vertexTextureAttribLoc=t.getAttribLocation(this.program,"vertexTextureIn"),this.instancePositionAttribLoc=t.getAttribLocation(this.program,"instancePositionIn"),this.instanceRotationAttribLoc=t.getAttribLocation(this.program,"instanceRotationIn"),this.instanceColorAttribLoc=t.getAttribLocation(this.program,"instanceColorIn"),this.useInstanceRotation=t.getUniformLocation(this.program,"useInstanceRotation"),this.projMatrixPtr=t.getUniformLocation(this.program,"projMatrix"),this.m2vMatrixPtr=t.getUniformLocation(this.program,"m2vMatrix"),this.normMatrixPtr=t.getUniformLocation(this.program,"normMatrix"),this.ambientLightColorPtr=t.getUniformLocation(this.program,"ambientLightColor"),this.directionalLightDirPtr=t.getUniformLocation(this.program,"directionalLightDir"),this.directionalLightColorPtr=t.getUniformLocation(this.program,"directionalLightColor"),this.lightingMultiplierPtr=t.getUniformLocation(this.program,"lightingMultiplier"),this.alphaPtr=t.getUniformLocation(this.program,"alpha"),this.colorSourcePtr=t.getUniformLocation(this.program,"colorSource"),this.sharedColorPtr=t.getUniformLocation(this.program,"sharedColor"),this.shadingTypePtr=t.getUniformLocation(this.program,"shadingType"),this.samplerPtr=t.getUniformLocation(this.program,"sampler"),this.idPtr=t.getUniformLocation(this.program,"u_id")}};var Mt=class{constructor(t,r,i,a=null){this.labelWidthNormalized=-1;this.labelHeightNormalized=-1;this.labelTranslateScreenX=0;this.labelTranslateScreenY=0;this.labelTranslateWorldX=0;this.labelTranslateWorldY=0;this.gl=t,this.sp=r,this.m=i,this.color=i.color,this.indexType=i.bytesPerIndex==2?t.UNSIGNED_SHORT:t.UNSIGNED_INT,this.vertexDataBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexDataBuffer),t.bufferData(t.ARRAY_BUFFER,i.vertexBuffer,t.STATIC_DRAW),this.triangleIndexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i.triangleBuffer,t.STATIC_DRAW),this.lineIndexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.lineIndexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i.lineBuffer,t.STATIC_DRAW),this.wireframeEdgeIndexBuffer=null,this.instanceDataBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.instanceDataBuffer),i.instanceBuffer!=null&&t.bufferData(t.ARRAY_BUFFER,i.instanceBuffer,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.hasTexture=a!=null,this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),this.m.isLabel?t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0):t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this.hasTexture?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([1,1,1,1])),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i.nnTexture?t.NEAREST:t.LINEAR),a!=null&&V.IsPow2(a.width)&&V.IsPow2(a.height)?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i.nnTexture?t.NEAREST:t.LINEAR_MIPMAP_NEAREST)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i.nnTexture?t.NEAREST:t.LINEAR)),t.bindTexture(t.TEXTURE_2D,null),this.m2wMatrix=q.create()}Finalize(){var t=this.gl;t.deleteBuffer(this.vertexDataBuffer),t.deleteBuffer(this.triangleIndexBuffer),t.deleteBuffer(this.lineIndexBuffer),this.wireframeEdgeIndexBuffer!=null&&t.deleteBuffer(this.wireframeEdgeIndexBuffer),t.deleteBuffer(this.instanceDataBuffer),this.texture!=null&&t.deleteTexture(this.texture)}ApplyBillboardEffect(t){var r=q.determinant(t),i=r!=0?1/Math.pow(r,1/3):1,a=q.create();q.scale(a,t,[i,i,i]);var n=Qe.create();q.getRotation(n,a),Qe.invert(n,n);var s=q.create();q.fromRotationTranslationScaleOrigin(s,n,[0,0,0],[1,1,1],this.m.centerOfMass),q.multiply(t,t,s)}ApplyLabel(t,r){this.ApplyBillboardEffect(t);var i=E=>this.m.vertexBuffer.subarray(this.m.VertexOffsetPosition+E*this.m.ElementsPerVertex,this.m.VertexOffsetPosition+E*this.m.ElementsPerVertex+3),a=q.create();q.multiply(a,r,t);var n=i(0),s=i(1),o=i(2),c=J.create();J.transformMat4(c,n,a);var l=J.create();J.transformMat4(l,s,a);var h=J.create();J.transformMat4(h,o,a);var d=l[0]-c[0],u=h[1]-l[1],f=this.labelWidthNormalized/d,v=this.labelHeightNormalized/u,p=J.create();J.transformMat4(p,n,t);var g=Math.abs(p[2]),x=J.fromValues(this.labelTranslateScreenX*g/r[0]+this.labelTranslateWorldX,this.labelTranslateScreenY*g/r[5]+this.labelTranslateWorldY,0),A=J.fromValues(f,v,1),_=q.create();q.fromRotationTranslationScale(_,Qe.create(),x,A),q.mul(t,t,_)}RenderBuffer(t,r,i,a,n){let s=this.gl,o=this.sp,c=this.m;if(n&&this.wireframeEdgeIndexBuffer==null){this.wireframeEdgeIndexBuffer=s.createBuffer();var l=c.GetWireframeEdgeBuffer();s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.wireframeEdgeIndexBuffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,l,s.STATIC_DRAW)}var h=q.create(),d=q.create();q.multiply(h,r,this.m2wMatrix),this.m.isBillboard&&this.ApplyBillboardEffect(h),this.m.isLabel&&this.hasTexture&&this.ApplyLabel(h,t),q.multiply(d,t,h),s.uniformMatrix4fv(o.projMatrixPtr,!1,d),s.uniformMatrix4fv(o.m2vMatrixPtr,!1,h);var u=V.Mat3FromMat4(h);ve.invert(u,u),ve.transpose(u,u),s.uniformMatrix3fv(o.normMatrixPtr,!1,u),s.uniform1i(o.samplerPtr,0),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.texture),s.bindBuffer(s.ARRAY_BUFFER,this.vertexDataBuffer),s.enableVertexAttribArray(o.vertexPositionAttribLoc),s.vertexAttribPointer(o.vertexPositionAttribLoc,3,s.FLOAT,!1,c.ElementsPerVertex*4,c.VertexOffsetPosition*4),s.enableVertexAttribArray(o.vertexNormalAttribLoc),s.vertexAttribPointer(o.vertexNormalAttribLoc,3,s.FLOAT,!1,c.ElementsPerVertex*4,c.VertexOffsetNormal*4),c.VertexOffsetColor!=0?(s.enableVertexAttribArray(o.vertexColorAttribLoc),s.vertexAttribPointer(o.vertexColorAttribLoc,3,s.FLOAT,!1,c.ElementsPerVertex*4,c.VertexOffsetColor*4)):s.disableVertexAttribArray(o.vertexColorAttribLoc),c.VertexOffsetTexture!=0?(s.enableVertexAttribArray(o.vertexTextureAttribLoc),s.vertexAttribPointer(o.vertexTextureAttribLoc,2,s.FLOAT,!1,c.ElementsPerVertex*4,c.VertexOffsetTexture*4)):s.disableVertexAttribArray(o.vertexTextureAttribLoc),s.bindBuffer(s.ARRAY_BUFFER,this.instanceDataBuffer),c.instanceBuffer!=null?(s.enableVertexAttribArray(o.instancePositionAttribLoc),s.vertexAttribPointer(o.instancePositionAttribLoc,3,s.FLOAT,!1,c.ElementsPerInstance*4,c.InstanceOffsetPosition*4),s.vertexAttribDivisor(o.instancePositionAttribLoc,1)):(s.disableVertexAttribArray(o.instancePositionAttribLoc),s.vertexAttribDivisor(o.instancePositionAttribLoc,0)),c.instanceBufferHasRotations?(s.enableVertexAttribArray(o.instanceRotationAttribLoc),s.vertexAttribPointer(o.instanceRotationAttribLoc,4,s.FLOAT,!1,c.ElementsPerInstance*4,c.InstanceOffsetRotation*4),s.vertexAttribDivisor(o.instanceRotationAttribLoc,1)):(s.disableVertexAttribArray(o.instanceRotationAttribLoc),s.vertexAttribDivisor(o.instanceRotationAttribLoc,0)),c.instanceBufferHasColors?(s.enableVertexAttribArray(o.instanceColorAttribLoc),s.vertexAttribPointer(o.instanceColorAttribLoc,3,s.FLOAT,!1,c.ElementsPerInstance*4,c.InstanceOffsetColor*4),s.vertexAttribDivisor(o.instanceColorAttribLoc,1)):(s.disableVertexAttribArray(o.instanceColorAttribLoc),s.vertexAttribDivisor(o.instanceColorAttribLoc,0)),s.uniform1i(o.useInstanceRotation,c.instanceBufferHasRotations?1:0);var f=c.instanceBufferHasColors?2:this.color==null?0:1;s.uniform1i(o.colorSourcePtr,f),this.color!=null&&s.uniform3fv(o.sharedColorPtr,this.color),s.uniform1f(o.alphaPtr,i),a&&(s.uniform1i(o.shadingTypePtr,this.m.isLabel?2:this.hasTexture?1:0),s.uniform1f(o.lightingMultiplierPtr,1),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),s.drawElementsInstanced(s.TRIANGLES,c.CountTriangles()*Be.ElementsPerTriangle,this.indexType,0,c.CountInstances())),n&&(s.uniform1i(o.shadingTypePtr,-1),s.uniform1f(o.lightingMultiplierPtr,i==1?.4:.5),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.wireframeEdgeIndexBuffer),s.drawElementsInstanced(s.LINES,c.CountWireframeEdges()*Be.ElementsPerLine,this.indexType,0,c.CountInstances())),s.uniform1i(o.shadingTypePtr,-1),s.uniform1f(o.lightingMultiplierPtr,1),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.lineIndexBuffer),s.drawElementsInstanced(s.LINES,c.CountLines()*Be.ElementsPerLine,this.indexType,0,c.CountInstances()),s.bindBuffer(s.ARRAY_BUFFER,null),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null),s.bindTexture(s.TEXTURE_2D,null)}RenderPicker(t,r,i){let a=this.gl,n=t,s=this.m;a.uniform1i(n.idPtr,this.id);let o=q.create(),c=q.create();q.multiply(o,i,this.m2wMatrix),this.m.isBillboard&&this.ApplyBillboardEffect(o),this.m.isLabel&&this.hasTexture&&this.ApplyLabel(o,r),q.multiply(c,r,o),a.uniformMatrix4fv(n.projMatrixPtr,!1,c),a.uniformMatrix4fv(n.m2vMatrixPtr,!1,o),a.bindBuffer(a.ARRAY_BUFFER,this.vertexDataBuffer),a.enableVertexAttribArray(n.vertexPositionAttribLoc),a.vertexAttribPointer(n.vertexPositionAttribLoc,3,a.FLOAT,!1,s.ElementsPerVertex*4,s.VertexOffsetPosition*4),a.bindBuffer(a.ARRAY_BUFFER,this.instanceDataBuffer),s.instanceBuffer!=null?(a.enableVertexAttribArray(n.instancePositionAttribLoc),a.vertexAttribPointer(n.instancePositionAttribLoc,3,a.FLOAT,!1,s.ElementsPerInstance*4,s.InstanceOffsetPosition*4),a.vertexAttribDivisor(n.instancePositionAttribLoc,1)):(a.disableVertexAttribArray(n.instancePositionAttribLoc),a.vertexAttribDivisor(n.instancePositionAttribLoc,0)),s.instanceBufferHasRotations?(a.enableVertexAttribArray(n.instanceRotationAttribLoc),a.vertexAttribPointer(n.instanceRotationAttribLoc,4,a.FLOAT,!1,s.ElementsPerInstance*4,s.InstanceOffsetRotation*4),a.vertexAttribDivisor(n.instanceRotationAttribLoc,1)):(a.disableVertexAttribArray(n.instanceRotationAttribLoc),a.vertexAttribDivisor(n.instanceRotationAttribLoc,0)),a.uniform1i(n.useInstanceRotation,s.instanceBufferHasRotations?1:0),a.uniform1i(n.shadingTypePtr,this.m.isLabel?2:this.hasTexture?1:0),a.uniform1f(n.lightingMultiplierPtr,1),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),a.drawElementsInstanced(a.TRIANGLES,s.CountTriangles()*Be.ElementsPerTriangle,this.indexType,0,s.CountInstances()),a.bindBuffer(a.ARRAY_BUFFER,null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}};var Cr=class{constructor(t,r,i){this.program=new ut(t,"pickerVertex","pickerFragment");let a=V.AssertNotNull(t.createTexture(),"WebGL returned a null texture");t.bindTexture(t.TEXTURE_2D,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,i,0,t.RGBA,t.UNSIGNED_BYTE,null);let n=V.AssertNotNull(t.createRenderbuffer(),"WebGL returned a null render buffer");t.bindRenderbuffer(t.RENDERBUFFER,n),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,r,i),this.frameBuffer=V.AssertNotNull(t.createFramebuffer(),"WebGL returned a null frame buffer"),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,n),this.data=new Uint8Array(4),t.bindFramebuffer(t.FRAMEBUFFER,null)}Pick(t,r,i,a){let n=t.canvas;t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.viewport(0,0,n.width,n.height),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);let s=this.program;t.useProgram(s.program),r.forEach(function([l,h]){l.RenderPicker(s,a,h)});let o=i[0]*n.width/n.clientWidth,c=n.height-i[1]*n.height/n.clientHeight-1;return t.readPixels(o,c,1,1,t.RGBA,t.UNSIGNED_BYTE,this.data),t.bindFramebuffer(t.FRAMEBUFFER,null),this.data[0]+(this.data[1]<<8)+(this.data[2]<<16)}};var Yf={Color:"eAFjYGiwZwCDBnsACIIBfwMAAAAB",IndexBufferType:"UInt16",LineBuffer:"eAEDAAAAAAEAAAAAAg==",PrimitiveType:"SingleColorMesh",TriangleBuffer:"eAENxEkCQDAQALDYKYqi/v9Tc0hotIRObzDGo8lskeJktdnlODucLiUubo9XjavPDycwAZkMAAAAAw==",VertexBuffer:"eAF1kYENACEIA9nsV3OzX+0fBa2lkJDoaVqqZvba6aiR+0dwZx1XOsCHr7NAR/K/Cw+9ji/TOMdGjhmYKx3gM08W6EjuuZjnOzT3p23605ybU67ClQ7k2t4wz8XpHwu/dD4ziz2hGAAAAAY="},xs={WorldToCamera:q.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,-4,1),FoVYDegrees:45},qf=.01,Kf=20,Xf=Math.PI/180,Qf={BackgroundColor:[0,0,0,1],AmbientLightColor:[.5,.5,.5],DirectionalLightColor:[.5,.5,.5],DirectionalLightDir:[2,-1,1]},wi=class{constructor(t,r){this.meshId=t,this.transform=r}},Er=class{constructor(t,r,i,a,n,s,o,c){this.mesh=t;this.m2wMatrix=r;this.m2vMatrix=i;this.buffer=a;this.opacity=n;this.filled=s;this.wireframe=o;this.viewDistance=c}Render(t,r){this.mesh.doubleSided?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE),this.buffer.RenderBuffer(r,this.m2vMatrix,this.opacity,this.filled,this.wireframe)}ComputeCentroid(){let t=J.create(),r=1/this.mesh.CountVertices();for(let n=0,s=0;n<this.mesh.CountVertices();n++,s+=this.mesh.ElementsPerVertex){let o=J.transformMat4(J.create(),this.mesh.vertexBuffer.subarray(s,s+3),this.m2wMatrix);J.scale(o,o,r),J.add(t,t,o)}if(this.mesh.CountInstances()==1)return t;let i=J.create(),a=1/this.mesh.CountInstances();for(let n=0,s=0;n<this.mesh.CountInstances();n++,s+=this.mesh.ElementsPerInstance){let o=J.add(J.create(),this.mesh.instanceBuffer.subarray(s,s+3),i);J.scale(o,o,a),J.add(i,i,o)}return i}},Ke=class extends at{constructor(r,i,a,n,s,o,c,l,h,d,u){super(r,i,a,n,o,c,l,h,d);this.frameRate=i;this.width=a;this.height=n;this.SetStatus=c;this.SetWarning=l;this.RequestRedraw=h;this.ReportFrameIdChange=d;this.SimulateKeyPress=u;this.allMeshes=null;this.layerSettings={};this.layerIds=[];this.globalFill=!0;this.globalWireframe=!1;this.globalOpacity=1;this.frameInstances=[];this.meshBuffers={};this.pointerAltKeyMultiplier=.2;this.pointerRotationSpeed=.01;this.mouseWheelTranslationSpeed=.005;this.keyDownSpeed=.1;this.thumbStickDeadZoneAmount=.2;this.thumbStickRotationSpeed=.1;this.thumbStickTranslationSpeed=.01;this.touchpadAsButtonThreshold=.5;this.buttonTranslationSpeed=.01;this.buttonScaleSpeed=1.01;this.cameraVelocity=J.fromValues(0,0,0);this.cameraRotationalVelocity=re.fromValues(0,0);this.dirKeyPresses={w:0,a:0,s:0,d:0,q:0,e:0};this.globalFocusPoint=new Float32Array([0,0,0]);this.initialFocusPoints=[];this.currentFocusPoints=[];this.showFocusPoint=!1;this.globalCameraParams=null;this.frameCameraParams=[];this.onCameraTrack=!1;this.frameLayerSettings=[];this.lockViewXY=!1;this.lockViewOrientation=!1;this.orbitCamera=!1;this.lastOrbitTime=null;this.allMeshes=s,this.dropdown.style.visibility="visible",this.InitializeWebGL(),window.addEventListener("webglcontextlost",f=>{this.TearDownWebGL(),f.preventDefault()}),window.addEventListener("webglcontextrestored",f=>{this.InitializeWebGL(),f.preventDefault()}),this.SetCamera(xs),this.globalCameraParams=xs,this.onCameraTrack=!0,this.SetShading(Qf),this.cameraModeDisplay.style.visibility="visible",this.SetLayerSettings({}),this.StartRenderLoop()}InitializeWebGL(){try{this.gl=this.htmlCanvas.getContext("webgl2"),this.gl.getExtension("OES_element_index_uint")}catch{}if(this.gl==null){this.SetWarning("Could not init WebGL");return}this.sp=new ut(this.gl,"defaultVertex","defaultFragment");var r=Be.Parse(Yf);this.focusPointMeshBuffer=new Mt(this.gl,this.sp,r),this.meshPicker=new Cr(this.gl,this.width,this.height),this.PrepareBuffers()}TearDownWebGL(){this.gl=null,this.sp=null,this.focusPointMeshBuffer!=null&&this.focusPointMeshBuffer.Finalize(),this.focusPointMeshBuffer=null,this.PrepareBuffers()}updateCameraVelocityValue(r,i,a){this.dirKeyPresses[r]>this.dirKeyPresses[i]?this.cameraVelocity[a]=this.keyDownSpeed:this.dirKeyPresses[i]>0?this.cameraVelocity[a]=-this.keyDownSpeed:this.cameraVelocity[a]=0}updateCameraVelocity(){this.updateCameraVelocityValue("w","s",0),this.updateCameraVelocityValue("a","d",1),this.updateCameraVelocityValue("q","e",2)}HandlePointerMoveWithTwist(r,i,a){let n=this.pointerCoords.size;if(n==0)return;let s=this.pointerCoords.get(a.pointerId),o=re.subtract(re.create(),r,s);if(a.altKey&&re.scale(o,o,this.pointerAltKeyMultiplier),this.FirstPerson){let h=this.initPointerCoords.get(a.pointerId),d=re.subtract(re.create(),r,h),u=re.length(d),f=10;if(u>f){let v=Math.min(2,(u-f)/f);re.scale(d,d,v/u)}else d=re.create();re.scale(d,d,this.pointerRotationSpeed),this.SetCameraRotationalVelocity(d)}else if(n==2){let h=this.PinchZoom(r,a);var c=this.GetCurrentFocusPointInViewSpace()[2],l=c/h.distanceRatio;this.TranslateCamera(J.fromValues(0,0,l-c));let d=this.ComputeFocusPointRelativeViewSpaceTranslation(s,r);this.TranslateCamera(d),this.RotateCamera(0,0,-h.angleDelta)}else if(a.ctrlKey)this.RotateCamera(0,0,i);else if(this.showFocusPoint)this.SetFocusPointPositionFromPixelCoordinates(r);else if(a.shiftKey){let h=this.ComputeFocusPointRelativeViewSpaceTranslation(s,r);this.TranslateCamera(h)}else n==1&&(re.scale(o,o,this.pointerRotationSpeed),this.RotateCamera(o[1],o[0],0));super.HandlePointerMove(r,a)}HandlePointerUp(r){this.SetCameraRotationalVelocity(re.create()),super.HandlePointerUp(r)}HandleMouseWheel(r){let i=-r.deltaY*this.mouseWheelTranslationSpeed;r.altKey&&(i*=this.pointerAltKeyMultiplier);var a=J.fromValues(0,0,i);this.TranslateCamera(a)}HandleKeyUp(r){if(r=r.toLowerCase(),this.firstPerson&&r in this.dirKeyPresses)this.dirKeyPresses[r]=0,this.updateCameraVelocity();else for(let i in this.dirKeyPresses)this.dirKeyPresses[i]=0}HandleKeyDown(r){var i=super.HandleKeyDown(r);if(i[0])return i;var a=!0;switch(r=r.toLowerCase(),r){case"r":this.ResetView();break;case"l":this.ToggleLockView(!0,!1);break;case"o":this.ToggleLockView(!1,!0);break;case"\\":this.ToggleOrbitCamera();break;case"capslock":this.showFocusPoint=!this.showFocusPoint;break;default:a=!1;break}return this.firstPerson&&r in this.dirKeyPresses&&(this.dirKeyPresses[r]=Date.now(),this.updateCameraVelocity()),[a,!1]}SetLayerSettings(r){for(;this.dropdownTable.childElementCount>2;)this.dropdownTable.removeChild(this.dropdownTable.lastChild);this.layerSettings=r,this.layerIds=[null];for(let l in r)this.layerIds.push(l);var i="1px solid #cccccc",a=document.createElement("tr");a.style.borderBottom=i;for(var n of["Wire","Fill","Opacity","Layer Id"]){var s=document.createElement("th");s.className="scenepic-dropdown-header",s.innerHTML=n,a.appendChild(s)}this.dropdownTable.appendChild(a);var o=(l,h)=>{var d=document.createElement("input");d.type="checkbox",d.checked=this.ShowLayerWireframe(l),d.className="scenepic-table-control",d.addEventListener("change",p=>{this.SetLayerWireframe(l,d.checked),this.PrepareBuffers(),p.stopPropagation()});var u=document.createElement("input");u.type="checkbox",u.checked=this.ShowLayerFilled(l),u.addEventListener("change",p=>{this.SetLayerFilled(l,u.checked),this.PrepareBuffers(),p.stopPropagation()});var f=document.createElement("input");f.type="range",f.min="0",f.max="100",f.value=String(100*this.GetLayerOpacity(l)),f.addEventListener("change",p=>{this.SetLayerOpacity(l,Number(f.value)/100),this.PrepareBuffers(),p.stopPropagation()}),f.style.width="50px",f.style.height="10px";var v=document.createElement("label");return v.appendChild(document.createTextNode(h)),[d,u,f,v]},c=(l,h)=>{var d=document.createElement("tr");h&&(d.style.borderTop=i);var u=(f,v)=>{var p=document.createElement("td");p.appendChild(f),p.className=v,d.appendChild(p)};u(l[0],"scenepic-table-control"),u(l[1],"scenepic-table-control"),u(l[2],"scenepic-table-control"),u(l[3],"scenepic-table-layerid"),this.dropdownTable.appendChild(d)};Object.keys(r).forEach(l=>c(o(l,l),!1)),c(o("<<<GLOBAL>>>","Global"),!0)}ConfigureUserInterface(r){"PointerAltKeyMultiplier"in r&&(this.pointerAltKeyMultiplier=r.PointerAltKeyMultiplier),"PointerRotationSpeed"in r&&(this.pointerRotationSpeed=r.PointerRotationSpeed),"MouseWheelTranslationSpeed"in r&&(this.mouseWheelTranslationSpeed=r.MouseWheelTranslationSpeed),"KeyDownSpeed"in r&&(this.keyDownSpeed=r.KeyDownSpeed),"LayerDropdownVisibility"in r&&(this.dropdown.style.visibility=r.LayerDropdownVisibility)}ParseFocusPoint(r){var i=V.Base64ToFloat32Array(r.Position);if("OrientationAxisAngle"in r){var a=new Float32Array(6);return a.set(i,0),a.set(V.Base64ToFloat32Array(r.OrientationAxisAngle),3),a}else return i}SetGlobalCamera(r){if(r!=null){this.globalCameraParams=r;for(var i=0;i<this.frameCameraParams.length;i++)this.SetPerFrameCamera(i,r);this.SetCamera(r)}}ExecuteCanvasCommand(r){switch(r.CommandType){case"ConfigureUserInterface":this.ConfigureUserInterface(r);break;case"SetCamera":var a=r.Value;this.SetGlobalCamera(a);break;case"SetFocusPoint":var i=this.ParseFocusPoint(r);this.SetGlobalFocusPoint(i);break;case"SetShading":var a=r.Value;this.SetShading(a);break;case"SetLayerSettings":var n=V.GetDefault(r,"Value",null);n!=null&&this.SetLayerSettings(n);break;default:super.ExecuteCanvasCommand(r);break}}ExecuteFrameCommand(r,i){switch(r.CommandType){case"SetFocusPoint":var a=this.ParseFocusPoint(r);this.SetPerFrameFocusPoint(i,a);break;case"SetCamera":var n=r.Value;this.SetPerFrameCamera(i,n);break;case"AddMesh":var o=r.MeshId,s=V.Base64ToFloat32Array(V.GetDefault(r,"Transform",q.create()));this.AddMesh(i,o,s);break;case"RemoveMesh":var o=r.MeshId;this.RemoveMesh(i,o);break;case"SetLayerSettings":var c=V.GetDefault(r,"Value",null);if(c!=null){this.SetPerFrameLayerSettings(i,c);break}default:super.ExecuteFrameCommand(r,i);break}}SetCamera(r){if(r!=null)if(r.hasOwnProperty("WorldToCamera"))this.w2vMatrix=V.Base64ToFloat32Array(r.WorldToCamera),this.v2sMatrix=V.Base64ToFloat32Array(r.Projection);else{console.warn("The legacy SetCamera command is deprecated.");var i=V.Base64ToFloat32Array(r.Center),a=V.Base64ToFloat32Array(r.LookAt),n=V.Base64ToFloat32Array(r.UpDir);this.w2vMatrix=q.create(),this.v2sMatrix=q.create(),q.lookAt(this.w2vMatrix,i,a,n),q.perspective(this.v2sMatrix,r.FoVYDegrees*Xf,this.width/this.height,qf,Kf)}}ResetView(){this.onCameraTrack=!0;var r=this.currentFrameIndex;this.SetCamera(this.frameCameraParams[r]),this.currentFocusPoints[r]=new Float32Array(this.initialFocusPoints[r])}ToggleLockView(r,i){r&&(this.lockViewXY=!this.lockViewXY),i&&(this.lockViewOrientation=!this.lockViewOrientation)}ToggleOrbitCamera(){this.orbitCamera=!this.orbitCamera,this.lastOrbitTime=null}SetPerFrameFocusPoint(r,i){i!=null&&(this.initialFocusPoints[r]=i,this.currentFocusPoints[r]=new Float32Array(i))}SetPerFrameCamera(r,i){i!=null&&(this.frameCameraParams[r]=i)}SetPerFrameLayerSettings(r,i){i!=null&&(this.frameLayerSettings[r]=i)}SetGlobalFocusPoint(r){if(r!=null){this.globalFocusPoint=r;for(var i=0;i<this.initialFocusPoints.length;i++)this.SetPerFrameFocusPoint(i,r)}}SetShading(r){this.bgColor=V.Base64ToFloat32Array(r.BackgroundColor),this.ambientLightColor=V.Base64ToFloat32Array(r.AmbientLightColor),this.directionalLightColor=V.Base64ToFloat32Array(r.DirectionalLightColor),this.directionalLightDir=V.Base64ToFloat32Array(r.DirectionalLightDir),J.normalize(this.directionalLightDir,this.directionalLightDir)}AllocateFrame(){this.frameInstances.push([]),this.initialFocusPoints.push(this.globalFocusPoint),this.currentFocusPoints.push(this.globalFocusPoint),this.frameCameraParams.push(this.globalCameraParams)}DeallocateFrame(r){this.frameInstances[r]=[]}AddMesh(r,i,a){var n=new wi(i,a),s=this.frameInstances[r];s.push(n);let o=this.allMeshes[i];o.layerId!=null&&!(o.layerId in this.layerSettings)&&(this.layerSettings[o.layerId]={},this.SetLayerSettings(this.layerSettings)),this.currentFrameIndex==r&&(i in this.allMeshes||this.SetWarning("Mesh "+i+" does not exist!"),this.PrepareBuffers())}RemoveMesh(r,i){for(var a=this.frameInstances[r],n=0,s=!1;n<a.length;)a[n].meshId==i?(a.splice(n,1),s=!0):n++;s&&this.currentFrameIndex==r&&this.PrepareBuffers()}NotifyMeshUpdated(r){if(this.frameInstances.length!=0){var i=this.frameInstances[this.currentFrameIndex];for(var a of i)a.meshId==r&&(r in this.meshBuffers&&this.meshBuffers[r]!=null&&this.meshBuffers[r].Finalize(),this.meshBuffers[r]=this.GetMeshBuffers(this.allMeshes[r]))}}GetMeshBuffers(r){var i=r.textureId,a=null;if(i!=null){var a=this.objectCache.GetObject(i);if(a==null)return null}return new Mt(this.gl,this.sp,r,a)}NotifyTextureUpdated(r){if(this.frameInstances.length!=0){var i=this.frameInstances[this.currentFrameIndex];for(var a of i){var n=a.meshId,s=this.allMeshes[n];s.textureId==r&&(this.meshBuffers[n]!=null&&this.meshBuffers[n].Finalize(),this.meshBuffers[n]=this.GetMeshBuffers(s))}}}PrepareBuffers(){super.PrepareBuffers();var r=[];if(this.gl!=null&&this.currentFrameIndex<this.frameInstances.length)for(var i of this.frameInstances[this.currentFrameIndex])r.push(i.meshId);var a=[];for(var n of r){var s=this.allMeshes[n];s!=null&&this.IsLayerVisible(s.layerId)&&!(n in this.meshBuffers)&&(a.push(n),s.textureId!=null&&this.objectCache.AddUser(s.textureId))}for(var n in this.meshBuffers){var s=this.allMeshes[n];(!this.IsLayerVisible(s.layerId)||r.indexOf(n)==-1)&&(n in this.meshBuffers&&(this.meshBuffers[n]!=null&&this.meshBuffers[n].Finalize(),delete this.meshBuffers[n]),s.textureId!=null&&this.objectCache.RemoveUser(s.textureId))}for(var n of a){var s=this.allMeshes[n];this.meshBuffers[n]=this.GetMeshBuffers(s)}}GetCurrentFocusPointInViewSpace(){var r=this.currentFocusPoints[this.currentFrameIndex],i=r.subarray(0,3),a=J.create();return J.transformMat4(a,i,this.w2vMatrix),a}ComputeCameraTwist(r,i){let a=this.pointerCoords.get(i.pointerId);if(a==null)return 0;var n=J.create();J.transformMat4(n,this.GetCurrentFocusPointInViewSpace(),this.v2sMatrix);let s=re.fromValues((n[0]+1)*.5*this.width,(-n[1]+1)*.5*this.height),o=Math.atan2(a[1]-s[1],a[0]-s[0]),c=Math.atan2(r[1]-s[1],r[0]-s[0]);return o-c}SetFocusPointPositionFromPixelCoordinates(r){this.lockViewXY||this.lockViewOrientation||(this.pickPoint=r,this.setFocusToPicked=!0)}ComputeFocusPointRelativeViewSpaceTranslation(r,i){var a=Math.abs(this.GetCurrentFocusPointInViewSpace()[2]),n=this.htmlCanvas.getBoundingClientRect(),s=q.create();q.invert(s,this.v2sMatrix);var o=J.fromValues(2*(r[0]/n.width-.5),2*(.5-r[1]/n.height),1),c=J.create();J.transformMat4(c,o,s),J.scale(c,c,a/c[2]);var l=J.fromValues(2*(i[0]/n.width-.5),2*(.5-i[1]/n.height),1),h=J.create();return J.transformMat4(h,l,s),J.scale(h,h,a/h[2]),J.fromValues(c[0]-h[0],c[1]-h[1],0)}RotateCamera(r,i,a){this.onCameraTrack=!1;var n=J.fromValues(r,i,a),s=this.GetCurrentFocusPointInViewSpace(),o=q.create();q.translate(o,o,s),q.rotateZ(o,o,n[2]),q.rotateY(o,o,n[1]),q.rotateX(o,o,n[0]),J.negate(s,s),q.translate(o,o,s),q.multiply(this.w2vMatrix,o,this.w2vMatrix)}SetCameraRotationalVelocity(r){re.copy(this.cameraRotationalVelocity,r)}SwivelCamera(r){this.onCameraTrack=!1;let i=q.create();q.rotateY(i,i,r[0]),q.rotateX(i,i,r[1]),q.multiply(this.w2vMatrix,i,this.w2vMatrix)}MoveCamera(r,i,a){this.onCameraTrack=!1;let n=q.create();q.fromTranslation(n,[i,a,r]),q.multiply(this.w2vMatrix,n,this.w2vMatrix)}ScaleCamera(r){this.onCameraTrack=!1;var i=this.GetCurrentFocusPointInViewSpace(),a=q.create();q.translate(a,a,i),q.scale(a,a,[r,r,r]),J.negate(i,i),q.translate(a,a,i),q.multiply(this.w2vMatrix,a,this.w2vMatrix)}TranslateCamera(r){this.onCameraTrack=!1;var i=q.create();q.fromTranslation(i,r),q.multiply(this.w2vMatrix,i,this.w2vMatrix)}IsLayerVisible(r){var i=this.ShowLayerFilled(r)&&this.globalFill,a=this.ShowLayerWireframe(r)||this.ShowLayerFilled(r)&&this.globalWireframe,n=this.GetLayerOpacity(r)*this.globalOpacity;return(i||a)&&n>0}ToggleLayerFilled(r){if(r>=this.layerIds.length)return;let i=this.layerIds[r],a=this.ShowLayerFilled(i);this.SetLayerFilled(i,!a)}ShowLayerFilled(r){return r=="<<<GLOBAL>>>"?this.globalFill:r==null||!(r in this.layerSettings)?!0:!("filled"in this.layerSettings[r]&&!this.layerSettings[r].filled)}SetLayerFilled(r,i){r!=null&&(r=="<<<GLOBAL>>>"?this.globalFill=i:(r in this.layerSettings||(this.layerSettings[r]={}),this.layerSettings[r].filled=i),this.PrepareBuffers())}ShowLayerWireframe(r){return r=="<<<GLOBAL>>>"?this.globalWireframe:r==null||!(r in this.layerSettings)?!1:!!("wireframe"in this.layerSettings[r]&&this.layerSettings[r].wireframe)}SetLayerWireframe(r,i){r!=null&&(r=="<<<GLOBAL>>>"?this.globalWireframe=i:(r in this.layerSettings||(this.layerSettings[r]={}),this.layerSettings[r].wireframe=i),this.PrepareBuffers())}GetLayerOpacity(r){return r=="<<<GLOBAL>>>"?this.globalOpacity:r==null||!(r in this.layerSettings)||!("opacity"in this.layerSettings[r])?1:this.layerSettings[r].opacity}SetLayerOpacity(r,i){r!=null&&(r=="<<<GLOBAL>>>"?this.globalOpacity=i:(r in this.layerSettings||(this.layerSettings[r]={}),this.layerSettings[r].opacity=i),this.PrepareBuffers())}GetLayerRenderOrder(r){return r==null||!(r in this.layerSettings)||!("renderOrder"in this.layerSettings[r])?1e3:this.layerSettings[r].renderOrder}AllMeshBuffersReady(){if(this.frameInstances.length>0)for(var r of this.frameInstances[this.currentFrameIndex]){var i=r.meshId,a=this.allMeshes[i];if(!(a==null||!this.IsLayerVisible(a.layerId))&&this.meshBuffers[i]==null)return!1}return!0}ShowFrame(r){r=Math.min(r,this.frameIds.length-1);var i=this.currentFocusPoints[this.currentFrameIndex],a=this.currentFocusPoints[r];if(this.frameLayerSettings[r]){let v=this.frameLayerSettings[r];for(let p in v)this.SetLayerFilled(p,v[p].filled),this.SetLayerWireframe(p,v[p].wireframe),this.SetLayerOpacity(p,v[p].opacity),"renderOrder"in v&&(this.layerSettings[p].renderOrder=v[p].renderOrder),this.PrepareBuffers()}var n=q.create();if(q.copy(n,this.w2vMatrix),this.lockViewOrientation&&i.length==6&&a.length==6){var s=v=>{var p=J.length(v),g=J.create();J.normalize(g,v);var x=q.create();return q.fromRotation(x,p,g),x},o=s(i.subarray(3)),c=s(a.subarray(3)),l=o;q.invert(c,c),q.multiply(l,l,c),q.multiply(this.w2vMatrix,this.w2vMatrix,l)}if(this.lockViewXY||this.lockViewOrientation){var h=J.create();J.transformMat4(h,i.subarray(0,3),n);var d=J.create();J.transformMat4(d,a.subarray(0,3),this.w2vMatrix);var u=J.create();J.subtract(u,h,d);var f=q.create();q.fromTranslation(f,u),q.multiply(this.w2vMatrix,f,this.w2vMatrix)}return super.ShowFrame(r)}Render(){this.gl!=null&&this.AllMeshBuffersReady()&&(this.firstPerson&&(this.MoveCamera(this.cameraVelocity[0],this.cameraVelocity[1],this.cameraVelocity[2]),(this.cameraRotationalVelocity[0]!=0||this.cameraRotationalVelocity[1]!=0)&&this.SwivelCamera(this.cameraRotationalVelocity)),this.gl.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],this.bgColor[3]),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.viewport(0,0,this.htmlCanvas.width,this.htmlCanvas.height),this.RenderViewport())}RenderViewport(){let r=this.gl,i=this.v2sMatrix;this.onCameraTrack&&this.SetCamera(this.frameCameraParams[this.currentFrameIndex]);var a=q.create();q.copy(a,this.w2vMatrix),r.useProgram(this.sp.program),r.enable(r.DEPTH_TEST),r.cullFace(r.BACK),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.uniform3fv(this.sp.ambientLightColorPtr,this.ambientLightColor),r.uniform3fv(this.sp.directionalLightColorPtr,this.directionalLightColor),r.uniform3fv(this.sp.directionalLightDirPtr,this.directionalLightDir);let n=[],s=[];if(this.frameInstances.length>0){var o=this.frameInstances[this.currentFrameIndex];for(var c of o){var l=c.meshId,h=this.allMeshes[l];if(h!=null){var d=this.ShowLayerFilled(h.layerId)&&this.globalFill,u=this.ShowLayerWireframe(h.layerId)||this.ShowLayerFilled(h.layerId)&&this.globalWireframe,f=this.GetLayerOpacity(h.layerId)*this.globalOpacity;if(!(!(d||u)||f==0)){var v=this.meshBuffers[l];if(v!=null){var p=q.create();if(h.cameraSpace?q.copy(p,c.transform):q.multiply(p,a,c.transform),h.isLabel){var g=this.objectCache.GetObject(h.textureId);g!=null&&(v.labelWidthNormalized=g.desiredWidthPixels/this.htmlCanvas.width,v.labelHeightNormalized=g.desiredHeightPixels/this.htmlCanvas.height,v.labelTranslateScreenX=g.proportionTranslateScreenX*v.labelWidthNormalized,v.labelTranslateScreenY=g.proportionTranslateScreenY*v.labelHeightNormalized,v.labelTranslateWorldX=V.Sign(g.proportionTranslateScreenX)*g.offsetDistance,v.labelTranslateWorldY=V.Sign(g.proportionTranslateScreenY)*g.offsetDistance)}if(f<1||h.textureId!=null&&(h.useTextureAlpha||h.isLabel)){var x=J.create();J.transformMat4(x,h.centerOfMass,p);var A=x[2],_=this.GetLayerRenderOrder(h.layerId);A+=_*1e4,s.push(new Er(h,c.transform,p,v,f,d,u,A))}else n.push(new Er(h,c.transform,p,v,1,d,u,0))}}}}}r.depthMask(!0),r.disable(r.BLEND),n.forEach($=>$.Render(r,i)),r.depthMask(!1),r.enable(r.BLEND);var E=s.sort(($,U)=>$.viewDistance-U.viewDistance);if(E.forEach($=>$.Render(r,i)),this.showFocusPoint){r.disable(r.DEPTH_TEST);var S=this.currentFocusPoints[this.currentFrameIndex],M=S.subarray(0,3),k=J.create();J.transformMat4(k,M,a);var R=.02*Math.abs(k[2]);q.fromRotationTranslationScale(this.focusPointMeshBuffer.m2wMatrix,Qe.create(),M,new Float32Array([R,R,R])),this.focusPointMeshBuffer.RenderBuffer(i,a,1,!0,!1)}if(this.orbitCamera){var O=new Date;if(this.lastOrbitTime!=null){var y=O.getTime()-this.lastOrbitTime.getTime();this.RotateCamera(0,.0025*y,0)}this.lastOrbitTime=O}if(this.setFocusToPicked&&n.length>0){let $=[];for(let Q=0;Q<n.length;Q++){let L=n[Q];L.mesh.cameraSpace||(L.buffer.id=Q+1,$.push([L.buffer,L.m2vMatrix]))}let U=this.meshPicker.Pick(r,$,this.pickPoint,i);if(U==0){var k=this.GetCurrentFocusPointInViewSpace(),T=q.create(),b=q.create();q.invert(T,this.v2sMatrix),q.invert(b,this.w2vMatrix);var I=this.htmlCanvas.getBoundingClientRect(),G=J.fromValues(2*(this.pickPoint[0]/I.width-.5),2*(.5-this.pickPoint[1]/I.height),1),z=J.create();J.transformMat4(z,G,T),J.scale(z,z,k[2]/z[2]);var S=this.currentFocusPoints[this.currentFrameIndex],M=S.subarray(0,3);J.transformMat4(M,z,b)}else{let Q=n[U-1].ComputeCentroid();var S=this.currentFocusPoints[this.currentFrameIndex];S[0]=Q[0],S[1]=Q[1],S[2]=Q[2]}this.setFocusToPicked=!1}}};var pt=class{constructor(t){this.layerId=t}GetObjectCacheId(){return null}},Ai=class extends pt{constructor(t,r,i,a,n,s){super(s),this.strokeStyle=t,this.lineWidth=r,this.fillStyle=i,this.coordinates=a,this.closePath=n}Draw(t,r,i){r.beginPath(),r.moveTo(this.coordinates[0]*window.devicePixelRatio,this.coordinates[1]*window.devicePixelRatio);for(var a=0;a<this.coordinates.length;a+=2)r.lineTo(this.coordinates[a]*window.devicePixelRatio,this.coordinates[a+1]*window.devicePixelRatio);this.closePath&&r.closePath(),this.fillStyle!=null&&(r.fillStyle=this.fillStyle,r.fill()),this.strokeStyle!=null&&this.lineWidth>0&&(r.strokeStyle=this.strokeStyle,r.lineWidth=this.lineWidth,r.stroke())}},Si=class extends pt{constructor(t,r,i,a,n,s){super(s),this.strokeStyle=t,this.lineWidth=r,this.fillStyle=i,this.center=a,this.radius=n}Draw(t,r,i){r.beginPath(),r.arc(this.center[0]*window.devicePixelRatio,this.center[1]*window.devicePixelRatio,this.radius*window.devicePixelRatio,0,2*Math.PI,!1),this.fillStyle!=null&&(r.fillStyle=this.fillStyle,r.fill()),this.strokeStyle!=null&&this.lineWidth>0&&(r.strokeStyle=this.strokeStyle,r.lineWidth=this.lineWidth,r.stroke())}},Ci=class extends pt{constructor(t,r,i,a,n,s){super(s),this.text=t,this.fillStyle=r,this.sizeInPixels=i,this.fontFamily=a,this.position=n}Draw(t,r,i){r.fillStyle=this.fillStyle;let a=this.sizeInPixels*window.devicePixelRatio,n=this.position[0]*window.devicePixelRatio,s=this.position[1]*window.devicePixelRatio,o=a.toString()+"px "+this.fontFamily;r.font=o,r.fillText(this.text,n,s)}},Ei=class extends pt{constructor(t,r,i,a,n,s){super(s),this.imageId=t,this.positionType=r,this.position=i,this.scale=a,this.smoothed=n}GetObjectCacheId(){return this.imageId}Draw(t,r,i){var a=i.GetObject(this.imageId);if(a!=null){r.imageSmoothingEnabled=r.msImageSmoothingEnabled=this.smoothed;var n=!0,s=t.clientWidth/a.naturalWidth,o=t.clientHeight/a.naturalHeight;switch(this.positionType){case"fill":s=o=Math.max(s,o);break;case"fit":s=o=Math.min(s,o);break;case"stretch":break;case"manual":s=o=this.scale,n=this.position==null;break}var c=a.naturalWidth*s,l=a.naturalHeight*o,h=n?(t.clientWidth-c)/2:this.position[0],d=n?(t.clientHeight-l)/2:this.position[1],u=window.devicePixelRatio;r.drawImage(a,0,0,a.naturalWidth,a.naturalHeight,h*u,d*u,c*u,l*u)}}},ki=class extends pt{constructor(t,r,i,a,n,s){super(s),this.videoId=t,this.positionType=r,this.position=i,this.scale=a,this.smoothed=n}GetObjectCacheId(){return this.videoId}Draw(t,r,i){let a=i.GetObject(this.videoId);if(a==null)return;r.imageSmoothingEnabled=r.msImageSmoothingEnabled=this.smoothed;let n=!0,s=t.clientWidth/a.videoWidth,o=t.clientHeight/a.videoHeight;switch(this.positionType){case"fill":s=o=Math.max(s,o);break;case"fit":s=o=Math.min(s,o);break;case"stretch":break;case"manual":s=o=this.scale,n=this.position==null;break}let c=a.videoWidth*s,l=a.videoHeight*o,h=n?(t.clientWidth-c)/2:this.position[0],d=n?(t.clientHeight-l)/2:this.position[1],u=window.devicePixelRatio;r.drawImage(a,0,0,a.videoWidth,a.videoHeight,h*u,d*u,c*u,l*u)}},vt=class extends at{constructor(r,i,a,n,s,o,c,l,h){super(r,i,a,n,s,o,c,l,h);this.frameRate=i;this.width=a;this.height=n;this.SetStatus=o;this.SetWarning=c;this.RequestRedraw=l;this.ReportFrameIdChange=h;this.context=null;this.layerSettings={};this.layerIds=[];this.globalFill=!0;this.globalOpacity=1;this.framePrimitives=[];this.currentPrimitives=null;this.frameCoordinates=[];this.context=this.htmlCanvas.getContext("2d"),this.backgroundStyle="#000000",this.center=re.fromValues(a,n),re.scale(this.center,this.center,window.devicePixelRatio/2),this.ResetView(),this.StartRenderLoop()}SetLayerSettings(r){for(;this.dropdownTable.childElementCount>2;)this.dropdownTable.removeChild(this.dropdownTable.lastChild);this.layerSettings=r,this.layerIds=[null];for(let l in r)this.layerIds.push(l);var i="1px solid #cccccc",a=document.createElement("tr");a.style.borderBottom=i;for(var n of["Visible","Opacity","Layer Id"]){var s=document.createElement("th");s.className="scenepic-dropdown-header",s.innerHTML=n,a.appendChild(s)}this.dropdownTable.appendChild(a);var o=(l,h)=>{var d=document.createElement("input");d.type="checkbox",d.checked=this.ShowLayerFilled(l),d.addEventListener("change",v=>{this.SetLayerFilled(l,d.checked),this.PrepareBuffers(),v.stopPropagation()});var u=document.createElement("input");u.type="range",u.min="0",u.max="100",u.value=String(100*this.GetLayerOpacity(l)),u.addEventListener("change",v=>{this.SetLayerOpacity(l,Number(u.value)/100),this.PrepareBuffers(),v.stopPropagation()}),u.style.width="50px",u.style.height="10px";var f=document.createElement("label");return f.appendChild(document.createTextNode(h)),[d,u,f]},c=(l,h)=>{var d=document.createElement("tr");h&&(d.style.borderTop=i);var u=(f,v)=>{var p=document.createElement("td");p.appendChild(f),p.className=v,d.appendChild(p)};u(l[0],"scenepic-table-control"),u(l[1],"scenepic-table-control"),u(l[2],"scenepic-table-layerid"),this.dropdownTable.appendChild(d)};Object.keys(r).forEach(l=>c(o(l,l),!1)),c(o("<<<GLOBAL>>>","Global"),!0)}ShowLayerFilled(r){return r=="<<<GLOBAL>>>"?this.globalFill:r==null||!(r in this.layerSettings)?!0:!("filled"in this.layerSettings[r]&&!this.layerSettings[r].filled)}ToggleLayerFilled(r){if(r>=this.layerIds.length)return;let i=this.layerIds[r],a=this.ShowLayerFilled(i);this.SetLayerFilled(i,!a)}SetLayerFilled(r,i){r!=null&&(r=="<<<GLOBAL>>>"?this.globalFill=i:(r in this.layerSettings||(this.layerSettings[r]={}),this.layerSettings[r].filled=i),this.PrepareBuffers())}GetLayerOpacity(r){return r=="<<<GLOBAL>>>"?this.globalOpacity:r==null||!(r in this.layerSettings)||!("opacity"in this.layerSettings[r])?1:this.layerSettings[r].opacity}SetLayerOpacity(r,i){r!=null&&(r=="<<<GLOBAL>>>"?this.globalOpacity=i:(r in this.layerSettings||(this.layerSettings[r]={}),this.layerSettings[r].opacity=i),this.PrepareBuffers())}GetLayerRenderOrder(r){return r==null||!(r in this.layerSettings)||!("renderOrder"in this.layerSettings[r])?-1e3:this.layerSettings[r].renderOrder}ExecuteCanvasCommand(r){switch(r.CommandType){case"SetBackgroundStyle":this.backgroundStyle=String(r.Value);break;case"SetLayerSettings":var i=V.GetDefault(r,"Value",null);i!=null&&this.SetLayerSettings(i);break;case"SetLayers":this.layerIds=r.LayerIds;break;default:super.ExecuteCanvasCommand(r);break}}AddPrimitive(r,i){if(i.layerId==null)this.framePrimitives[r].push(i);else{i.layerId in this.layerSettings||(this.layerSettings[i.layerId]={},this.SetLayerSettings(this.layerSettings));let a=this.GetLayerRenderOrder(i.layerId),n=0,s=null;for(let o of this.framePrimitives[r]){if(o.layerId==s){n+=1;continue}if(o.layerId==i.layerId)break;s=o.layerId;let c=this.GetLayerRenderOrder(o.layerId);if(a<c)break;n+=1}this.framePrimitives[r].splice(n,0,i)}this.currentFrameIndex==r&&this.PrepareBuffers()}SetCoordinates(r,i){this.frameCoordinates[r]=i}GetCoordinate(r,i){let a=i*2,n=a+2;return this.frameCoordinates[r].slice(a,n)}AddLines(r,i,a,n,s){let o=n.length,c=null,l=o,h=0;s!=null&&(c=s[0][0],l=h+s[0][1]);for(let d=0;d<o;++d){let u=i.slice(d*3,d*3+3),f=this.frameCoordinates[r].slice(u[0]*2,u[1]*2),v=u[2]==1,p=V.StyleToHtmlHex(a.slice(d*8,d*8+4)),g=V.StyleToHtmlHex(a.slice(d*8+4,d*8+8)),x=n[d];d==l&&(h+=1,c=s[h][0],l=d+s[h][1]),this.AddPrimitive(r,new Ai(p,x,g,f,v,c))}}AddCircles(r,i,a,n){let s=a.length/8,o=null,c=s,l=0;n!=null&&(o=n[0][0],c=l+n[0][1]);for(let h=0;h<s;++h){let d=i.slice(h*4,h*4+4),u=d.slice(0,2),f=d[2],v=d[3],p=V.StyleToHtmlHex(a.slice(h*8,h*8+4)),g=V.StyleToHtmlHex(a.slice(h*8+4,h*8+8));h==c&&(l+=1,o=n[l][0],c=h+n[l][1]),this.AddPrimitive(r,new Si(p,v,g,u,f,o))}}ExecuteFrameCommand(r,i){switch(r.CommandType){case"SetCoordinates":var a=V.Base64ToFloat32Array(r.CoordinateBuffer);this.SetCoordinates(i,a);break;case"AddImage":var n=r.ImageId,A=r.Index,s=V.GetDefault(r,"PositionType","fit"),_=this.GetCoordinate(i,A),o=V.GetDefault(r,"Scale",1),c=V.GetDefault(r,"Smoothed",!1),E=V.GetDefault(r,"LayerId",null);this.AddPrimitive(i,new Ei(n,s,_,o,c,E));break;case"AddVideo":var A=r.Index,s=V.GetDefault(r,"PositionType","fit"),_=this.GetCoordinate(i,A),o=V.GetDefault(r,"Scale",1),c=V.GetDefault(r,"Smoothed",!1),E=V.GetDefault(r,"LayerId",null);this.AddPrimitive(i,new ki(this.mediaId,s,_,o,c,E));break;case"AddLines":var l=V.Base64ToUInt16Array(r.InfoBuffer),u=V.Base64ToUInt8Array(r.StyleBuffer),h=V.Base64ToFloat32Array(r.WidthBuffer),f=V.GetDefault(r,"LayerIds",null);this.AddLines(i,l,u,h,f);break;case"AddCircles":var d=V.Base64ToFloat32Array(r.InfoBuffer),u=V.Base64ToUInt8Array(r.StyleBuffer),f=V.GetDefault(r,"LayerIds",null);this.AddCircles(i,d,u,f);break;case"AddText":var v=r.Text,p=r.FillStyle,g=r.SizeInPixels,x=r.Font,A=r.Index,_=this.GetCoordinate(i,A),E=V.GetDefault(r,"LayerId",null);this.AddPrimitive(i,new Ci(v,p,g,x,_,E));break;default:super.ExecuteFrameCommand(r,i);break}}AllocateFrame(){this.framePrimitives.push([]),this.frameCoordinates.push(null)}DeallocateFrame(r){this.framePrimitives[r]=[],this.frameCoordinates[r]=null}NotifyTextureUpdated(r){}PrepareBuffers(){super.PrepareBuffers();var r=this.currentFrameIndex,i=this.framePrimitives[r].slice();for(var a of i){var n=a.GetObjectCacheId();n!=null&&this.objectCache.AddUser(n)}if(this.currentPrimitives!=null)for(var a of this.currentPrimitives){var n=a.GetObjectCacheId();n!=null&&this.objectCache.RemoveUser(n)}this.currentPrimitives=i}ResetView(){this.focusPointDelta=re.create(),this.focusPoint=re.copy(re.create(),this.center),this.scale=1,this.angle=0,this.updateTransform(),this.setTransform()}ComputeCameraTwist(r,i){let a=this.pointerCoords.get(i.pointerId);if(a==null)return 0;let n=r[0]-a[0],s=a[1]-r[1],o=n;return Math.abs(s)>Math.abs(n)&&(o=s),2*o/(window.devicePixelRatio*this.htmlCanvas.clientWidth)}updateTransform(){let r=ve.fromTranslation(ve.create(),this.focusPoint),i=ve.fromTranslation(ve.create(),re.negate(re.create(),this.center)),a=ve.fromScaling(ve.create(),re.fromValues(this.scale,this.scale)),n=ve.fromRotation(ve.create(),this.angle);this.transform=ve.create(),ve.multiply(this.transform,i,this.transform),ve.multiply(this.transform,a,this.transform),ve.multiply(this.transform,n,this.transform),ve.multiply(this.transform,r,this.transform)}setTransform(){this.context.setTransform(this.transform[0],this.transform[1],this.transform[3],this.transform[4],this.transform[6],this.transform[7])}Render(){this.context.fillStyle=this.backgroundStyle,this.context.resetTransform();let r=this.htmlCanvas.clientWidth*window.devicePixelRatio,i=this.htmlCanvas.clientHeight*window.devicePixelRatio;if(this.context.fillRect(0,0,r,i),this.setTransform(),this.currentPrimitives!=null)for(var a of this.currentPrimitives){let n=this.GetLayerOpacity(a.layerId)*this.globalOpacity;!(this.ShowLayerFilled(a.layerId)&&this.globalFill)||n==0||(this.context.globalAlpha=n,a.Draw(this.htmlCanvas,this.context,this.objectCache),this.context.globalAlpha=1)}}StartPlaying(){for(let r of this.framePrimitives)for(let i of r){let a=i.GetObjectCacheId();a!=null&&this.objectCache.AddUser(a)}super.StartPlaying()}StopPlaying(){super.StopPlaying();for(let r of this.framePrimitives)for(let i of r){let a=i.GetObjectCacheId();a!=null&&this.objectCache.RemoveUser(a)}}HandleKeyDown(r){var i=super.HandleKeyDown(r);if(i[0])return i;let a=!0;return r=r.toLowerCase(),r==="r"?this.ResetView():a=!1,[a,!1]}pointerCenter(){if(this.pointerCoords.size==1)return this.pointerCoords.get(this.pid0);{let r=this.pointerCoords.get(this.pid0),i=this.pointerCoords.get(this.pid1),a=re.add(re.create(),r,i);return re.scale(a,a,.5),a}}updateFocusPointDelta(){if(this.pointerCoords.size==0)return;let r=this.pointerCenter(),i=re.scale(re.create(),this.focusPoint,1/window.devicePixelRatio);this.focusPointDelta=re.subtract(re.create(),i,r)}HandlePointerDown(r,i){super.HandlePointerDown(r,i),this.updateFocusPointDelta(),this.updateTransform()}HandlePointerUp(r){super.HandlePointerUp(r),this.updateFocusPointDelta(),this.updateTransform()}HandlePointerMoveWithTwist(r,i,a){let n=this.pointerCoords.size;if(!(n==0||n>2)){if(n==2){let s=this.PinchZoom(r,a);this.scale=this.scale*s.distanceRatio,this.angle=this.angle+s.angleDelta,re.add(this.focusPoint,s.center,this.focusPointDelta),re.scale(this.focusPoint,this.focusPoint,window.devicePixelRatio)}else this.angle+=i,i==0&&(re.add(this.focusPoint,r,this.focusPointDelta),re.scale(this.focusPoint,this.focusPoint,window.devicePixelRatio));this.updateTransform(),this.setTransform(),super.HandlePointerMove(r,a)}}HandleMouseWheel(r){let i=Math.pow(1.1,r.deltaY>0?-1:1);this.scale*=i,this.updateTransform(),this.setTransform()}};var kr=class{constructor(t,r,i,a){this.top=t,this.right=r,this.bottom=i,this.left=a}},We=class e{constructor(t=0,r=0,i=0,a=0){this.x=t,this.y=r,this.width=i,this.height=a}get topEdge(){return this.y}get bottomEdge(){return this.y+this.height}get leftEdge(){return this.x}get rightEdge(){return this.x+this.width}Move(t,r){this.x=t,this.y=r}Resize(t,r){this.width=t,this.height=r}Pad(t){return new e(this.x+t,this.y+t,this.width-2*t,this.height-2*t)}Outline(t){t.save(),t.strokeStyle="#000000",t.strokeRect(this.x,this.y,this.width,this.height),t.restore()}DrawText(t,r,i,a){t.save(),t.font=a,t.fillStyle=i;let n=t.measureText(r),s=n.width*window.devicePixelRatio,o=(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)*window.devicePixelRatio,c=this.x+.5*(this.width-s),l=this.y+.5*(this.height+o);t.fillText(r,c,l),t.restore()}},Me=class e{get topEdge(){return this.y}get bottomEdge(){return this.y+this.height}get leftEdge(){return this.x}get rightEdge(){return this.x+this.width}constructor({top:t=new We,right:r=new We,bottom:i=new We,left:a=new We,center:n=new We}={}){this.x=this.y=this.width=this.height=0,this.top=t,this.right=r,this.bottom=i,this.left=a,this.center=n}Move(t,r){this.top.Move(t+this.top.x-this.x,r+this.top.y-this.y),this.bottom.Move(t+this.bottom.x-this.x,r+this.bottom.y-this.y),this.left.Move(t+this.left.x-this.x,r+this.left.y-this.y),this.right.Move(t+this.right.x-this.x,r+this.right.y-this.y),this.center.Move(t+this.center.x-this.x,r+this.center.y-this.y),this.x=t,this.y=r}Outline(t){let r=[this.top,this.bottom,this.left,this.right,this.center];for(let i of r)i.Outline(t)}Layout(t,r){this.top instanceof e&&this.top.Layout(0,0),this.top.Move(0,0),this.left instanceof e&&this.left.Layout(0,0),this.left.Move(0,this.top.bottomEdge),this.right instanceof e&&this.right.Layout(0,0),this.right.Move(this.left.rightEdge,this.top.bottomEdge),this.bottom instanceof e&&this.bottom.Layout(0,0),this.bottom.Move(0,this.height);let i=Math.max(0,t-this.left.width-this.right.width),a=Math.max(Math.max(this.left.height,this.right.height),r-this.top.height-this.bottom.height);this.center instanceof e?this.center.Layout(i,a):this.center.Resize(i,a),this.width=this.left.width+this.center.width+this.right.width,this.height=this.top.height+this.center.height+this.bottom.height,this.center.Move(this.left.rightEdge,this.top.bottomEdge),this.top.Move(.5*(this.width-this.top.width),0),this.left.Move(0,.5*(this.height-this.left.height)),this.right.Move(this.center.rightEdge,.5*(this.height-this.right.height)),this.bottom.Move(.5*(this.width-this.bottom.width),this.center.bottomEdge)}},Mi=class{constructor(t,r,i){this.frame=t,this.strokeStyle=r,this.lineWidth=i}},Ti=class e{static{this.MARKER_RADIUS=4}constructor(t,r,i,a,n){this.name=t,this.values=r,this.strokeStyle=i,this.lineWidth=a,this.minValue=Math.min(...r),this.maxValue=Math.max(...r),this.verticalRules=n}Draw(t,r,i){let a=r.width/this.values.length,n=0,s=r.y+.5*r.height;this.minValue!=this.maxValue&&(s=r.y+r.height,n=r.height/(this.maxValue-this.minValue));for(let l of this.verticalRules){let h=r.x+l.frame*a;t.beginPath(),t.moveTo(h,r.y),t.lineTo(h,r.y+r.height),t.save(),l.strokeStyle!=null&&l.lineWidth>0&&(t.strokeStyle=l.strokeStyle,t.lineWidth=l.lineWidth),t.stroke(),t.restore()}let o=r.x,c=s-(this.values[0]-this.minValue)*n;t.beginPath(),t.moveTo(o,c);for(let l of this.values.slice(1))o+=a,c=s-(l-this.minValue)*n,t.lineTo(o,c);t.save(),this.strokeStyle!=null&&this.lineWidth>0&&(t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth),t.stroke(),t.restore(),o=r.x+a*i,c=s-(this.values[i]-this.minValue)*n,t.beginPath(),t.arc(o,c,e.MARKER_RADIUS*window.devicePixelRatio,0,2*Math.PI,!1),t.save(),this.strokeStyle!=null&&(t.fillStyle=this.strokeStyle),t.fill(),t.restore()}ValueAt(t){return this.values[t]}},er=class e extends at{constructor(r,i,a,n,s,o,c,l,h){super(r,i,a,n,s,o,c,l,h);this.frameRate=i;this.width=a;this.height=n;this.SetStatus=o;this.SetWarning=c;this.RequestRedraw=l;this.ReportFrameIdChange=h;this.context=null;this.sparklines=[];this.margin=null;this.context=this.htmlCanvas.getContext("2d"),this.backgroundStyle="#000000",this.margin=new kr(10,10,10,10),this.nameAlign="left",this.valueAlign="right",this.StartRenderLoop()}static{this.PADDING=7}ExecuteCanvasCommand(r){switch(r.CommandType){case"SetBackgroundStyle":this.backgroundStyle=String(r.Value);break;case"SetTextStyle":this.fontFamily=String(r.FontFamily),this.nameSizeInPixels=Number(r.NameSizeInPixels),this.nameAlign=String(r.NameAlign),this.valueSizeInPixels=Number(r.ValueSizeInPixels),this.valueAlign=String(r.ValueAlign);break;case"SetMargin":let i=r.Value,a=Number(i.Top),n=Number(i.Right),s=Number(i.Bottom),o=Number(i.Left);this.margin=new kr(a,n,s,o);break;case"AddSparkline":let c=String(r.Name),l=V.Base64ToFloat32Array(r.ValueBuffer),h=String(r.StrokeStyle),d=Number(r.LineWidth),u=[];for(let f of r.VerticalRules)u.push(new Mi(Number(f.FrameIndex),String(f.StrokeStyle),Number(f.LineWidth)));if(this.sparklines.length==0)for(let f=0;f<l.length;++f)this.AddFrame(f.toString());this.sparklines.push(new Ti(c,l,h,d,u));break;default:super.ExecuteCanvasCommand(r);break}}AllocateFrame(){}DeallocateFrame(r){}Render(){this.context.fillStyle=this.backgroundStyle,this.context.fillRect(0,0,this.htmlCanvas.clientWidth*window.devicePixelRatio,this.htmlCanvas.clientHeight*window.devicePixelRatio);let r=this.htmlCanvas.clientWidth-this.margin.left-this.margin.right,i=this.htmlCanvas.clientHeight-this.margin.top-this.margin.bottom,a=this.margin.left*window.devicePixelRatio,n=this.margin.top*window.devicePixelRatio;r*=window.devicePixelRatio,i*=window.devicePixelRatio;let s=new Me;s.center=new We;let o=this.nameSizeInPixels+"px "+this.fontFamily,c=this.valueSizeInPixels+"px "+this.fontFamily,l=0,h=0;for(let p of this.sparklines){this.context.font=o;let g=this.context.measureText(p.name).width;this.context.font=c;let x=this.context.measureText(p.minValue.toFixed(2)).width,A=this.context.measureText(p.maxValue.toFixed(2)).width;l=Math.max(g,l),h=Math.max(x,A,h)}l*=window.devicePixelRatio;let d=this.nameSizeInPixels*window.devicePixelRatio;h*=window.devicePixelRatio;let u=this.valueSizeInPixels*window.devicePixelRatio,f=i/this.sparklines.length,v=n;for(let p of this.sparklines){let g=new Me,x=new We(0,0,l,d),A=new Me({left:x});switch(this.nameAlign){case"top":g.top=A;break;case"bottom":g.bottom=A;break;case"left":g.left=A;break;case"right":g.right=A;break}let _=new We(0,0,h,u);switch(this.valueAlign){case"top":g.top instanceof Me?g.top.right=_:g.top=new Me({right:_});break;case"bottom":g.bottom instanceof Me?g.bottom.right=_:g.bottom=new Me({right:_});break;case"left":g.left instanceof Me?g.left.right=_:g.left=new Me({right:_});break;case"right":g.right instanceof Me?g.right.right=_:g.right=new Me({right:_});break}g.Layout(r,f),g.Move(a,v),x.DrawText(this.context,p.name,p.strokeStyle,o),_.DrawText(this.context,p.ValueAt(this.currentFrameIndex).toFixed(2),p.strokeStyle,c),p.Draw(this.context,g.center.Pad(e.PADDING*window.devicePixelRatio),this.currentFrameIndex),v+=f}}};var tr=class{constructor(t,r,i,a,n=!1,s=!1){var o=document.createElement("div");o.className="scenepic",o.id=t,i!=null&&o.setAttribute("style",i),this.wrapper=document.createElement("div"),this.minimized=n,this.header=document.createElement("span"),this.header.className="scenepic-textbox-header",this.title=r,this.header.addEventListener("click",c=>{this.minimized=!this.minimized,this.Update()},!0),o.appendChild(this.header),o.appendChild(this.wrapper),this.contents=document.createElement("div"),this.wrapper.appendChild(this.contents),this.inputBox=document.createElement("textarea"),this.inputBox.innerHTML="",this.inputBox.cols=40,this.inputBox.rows=2,s&&this.wrapper.appendChild(this.inputBox),this.Update(),a.appendChild(o)}SetContents(t,r=!1){r?this.contents.innerHTML+=t:this.contents.innerHTML=t}SetTitle(t){this.title=t,this.Update()}Update(){this.header.style.display=this.title==null||this.title==""?"none":"",this.header.innerHTML=this.title+(this.minimized?" &#9661;":" &#9655;");var t=this.minimized?"none":"inline-block";this.wrapper.style.display=t}SetInputBoxContents(t){this.inputBox.value=t}};var rr=class{constructor(t,r,i){var a=document.createElement("div");a.className="scenepic",r!=null&&a.setAttribute("style",r),this.wrapper=document.createElement("div"),this.header=document.createElement("span"),this.header.className="scenepic-textbox-header",this.title=t,a.appendChild(this.header),a.appendChild(this.wrapper),this.contents=document.createElement("div"),this.wrapper.appendChild(this.contents),this.dropDownMenu=document.createElement("select"),this.dropDownMenu.innerHTML="",this.dropDownMenu.size=2,this.wrapper.appendChild(this.dropDownMenu),this.Update(),i.appendChild(a)}SetItems(t){t.forEach(r=>{var i=document.createElement("option");i.value=r,i.text=r,this.dropDownMenu.appendChild(i)}),this.Update()}SetItemDisabled(t,r){this.dropDownMenu.options[t].disabled=r}SetSelection(t){this.dropDownMenu.selectedIndex=t}SetTitle(t){this.title=t,this.Update()}Update(){this.header.style.display=this.title==null||this.title==""?"none":"",this.header.innerHTML=this.title,this.wrapper.style.display="inline-block"}};var Jf=`
.scenepic {
	font-family: Calibri,Tahoma,Verdana,Segoe,sans-serif;
	font-size: 14px;
}

.scenepic-textbox-header {
    vertical-align:top;
    margin:1px;
    padding:1px;
    border: 2px solid white;
    font-weight: bold;
    display: inline-block;
}

.scenepic-textbox-content {
    margin:1px;
    vertical-align:top;
    padding:1px;
    border: 2px solid #fafafa;
    display: inline-block;
}

.scenepic-status-bar {
    position:fixed;
    bottom:0;
    marginBottom: 30;
    width: 100%;
    background-color: white;
}

.scenepic-canvas-container {
    border: 2px solid lightgrey;
    display: inline-block;
    vertical-align: top;
    position: relative;
}

.scenepic-canvas {
    touch-action: none;
    display: block;
    outline-style: none;
}

.scenepic-slider-container {
  position: absolute;
  background: grey;
  opacity: 0.5;
  top: 5px;
  left: 5px;
  display: flex;
}

.scenepic-slider {
  margin: 5px;
  vertical-align: middle;
  min-width: 100px;
}

.scenepic-slider-text {
  width: auto;
  height: auto;
  color: white;
  vertical-align: middle;
  display: inline-block;
  font-family: monospace;
}

.scenepic-dropdown {
  background: grey;
  opacity: 0.75;
  width: 21px;
  height: 21px;
  box-sizing: content-box;
  cursor: pointer;
  padding: 5px;
  position: absolute;
  margin: 0 auto;
  top: 5px;
  right: 5px;
  user-select: none;
  z-index: 10;
}

.scenepic-dropdown:after {
  content: '';
  height: 0;
  position: absolute;
  width: 0;
  border: 6px solid transparent;
  border-top-color: #000;
  top: 50%;
  right: 10px;
  margin-top: -3px;
}

.scenepic-dropdown.is-active:after {
  border-bottom-color: #000;
  border-top-color: transparent;
  margin-top: -9px;
}

.scenepic-left-table {
  left: 1px
}

.scenepic-right-table {
  right: -1px
}

.scenepic-dropdown-table {
  list-style: none !important;
  margin: 0 !important;
  padding: 0;
  position: absolute;
  top: 100%;
  border: inherit;
  visibility: hidden;
  background-color: white;
  pointer-events: none;
  border-collapse: collapse;
}

.is-active .scenepic-dropdown-table {
  visibility: visible;
  pointer-events: auto;
}

.scenepic-dropdown-header {
  text-align:center;
  padding:3px;
  white-space: nowrap;
}

.scenepic-table-control {
  text-align:center;
}

.scenepic-table-layerid {
  padding-left:5px;
  padding-right:5px;
  white-space: nowrap;
}

.scenepic-progress {
  height: 12px;
  width: 400px;
  position: relative;
  background: #aaa;
  -moz-border-radius: 7px;
  -webkit-border-radius: 7px;
  border-radius: 7px;
  padding: 3px;
  margin: 5px;
  box-shadow: inset 0 -1px 1px rgba(255,255,255,0.3);
}

.scenepic-progress > span {
  display: block;
  height: 100%;
  border-top-right-radius: 8px;
  border-bottom-right-radius: 8px;
  border-top-left-radius: 20px;
  border-bottom-left-radius: 20px;
  background-color: rgb(43,194,83);
  background-image: linear-gradient(
    center bottom,
    rgb(43,194,83) 37%,
    rgb(84,240,84) 69%
  );
  box-shadow: 
    inset 0 2px 9px  rgba(255,255,255,0.3),
    inset 0 -2px 6px rgba(0,0,0,0.4);
  position: relative;
  overflow: hidden;
}

@keyframes blink {
  0% { opacity: 0; }
  50% { opacity: 1; }
  100% { opacity: 0; }
}

.is-blinking {
  animation: blink 2s infinite;
}

.scenepic-controls {
  padding: 5px;
  background: #ddd;
  border-radius: 10px;
  width: 380px;  
}

.scenepic-toggle-button {
  position: relative;
  display: inline-block;
  width: 22px;
  height: 22px;
  vertical-align: middle;
  border: 1px solid #ddd;
  border-radius: 20px;
}

.scenepic-toggle-button:hover {
  border: 1px solid gray;
}

.scenepic-toggle-button:active {
  background-color: gray;
}

/* Hide default HTML checkbox */
.scenepic-toggle-button input {
  opacity: 0;
  width: 0;
  height: 0;
  padding: 0;
  margin: 0;
}

/* The icon */
.scenepic-toggle-button span {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}

label.scenepic-large {
  width: 42px;
  height: 42px;
}

.scenepic-controls button.scenepic-medium {
  width: 32px;
  height: 32px;
}

.scenepic-icon-playpause {
  width: 38px;
  height: 38px;
  box-sizing: content-box;
  border: 2px solid black;
  border-radius: 20px;
  background: url(data:image/gif;base64,R0lGODlhIAAgAIQcAAEBAQMDAwYGBggICAoKCgsLCw0NDQ8PDxISEhQUFBUVFRYWFhkZGRsbGx0dHR8fHyAgICIiIiQkJCUlJScnJykpKSsrKywsLC4uLjAwMDExMTMzM7u7u7u7u7u7u7u7uyH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAB8ALAAAAAAgACAAAAWP4CeOZGmeaKqubOu+7rbBrmZn9IrtfI5ewODF4itVjshkUURpOp+U5WRKrU4lvoh2y+3SIOCweAx5vBzotHqddjXe8Lg83mLY7/g8vrXo+/+Afi4JhIWGhwkKLwiMjY6PNAeSk5STPgaYmZoGSwSen58FSx8DpaaloyICq6ypIwGwAa4kAACzt7i5uru8RSEAOw==)
              no-repeat 5px 3px;
}

input:checked + .scenepic-icon-playpause {
  background: url(data:image/gif;base64,R0lGODlhIAAgAIQUAAICAgQEBAcHBwkJCQwMDA4ODhERERMTExYWFhkZGRsbGx4eHiAgICMjIyUlJSgoKCoqKi0tLTAwMDIyMru7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7uyH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAB8ALAAAAAAgACAAAAWu4CeOZGmeaKqubOu+cCzP6GTftonjquT/PhMQqIoYj0YTEqmCOJ9OExSqelivVhMWq3J4v14TGKxqmM9mExqtYrjfbhMcrlrY73YTHq9S+P9+JoCAKgmGh4YmiIgqCI6PjiaQkCoHlpeWJpiYKgaen54moKAqBaanpiaoqCoErq+uJrCwKgO2t7YmuLgqAr6/vibAwCoBxsfGJsjIKgDOz84m0NA01dbX2Nna2yghADs=)
              no-repeat 2px 3px;
}

.scenepic-icon-soundmute {
  background: url(data:image/gif;base64,R0lGODlhEAAQAIQVAAICAgYGBgkJCQwMDA0NDQ8PDxAQEBMTExQUFBcXFxoaGh0dHR4eHiAgICEhISQkJCcnJygoKCsrKy8vLzIyMru7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7uyH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAB8ALAAAAAAQABAAAAVR4CeOJEmV6DilqcR+EBm9zzPabOM4Il8ywCDjM1wsSIqk8qMQJUmJaPSTGE1HhyzicyBlSYbwx/ApjMQowmegXrdLApEg/pmjAiQ8C/Dq+z8hADs=)
              no-repeat 3px 3px;
}

input:checked + .scenepic-icon-soundmute {
  background: url(data:image/gif;base64,R0lGODlhEAAQAIQUAAICAgUFBQYGBgkJCQwMDA0NDQ8PDxAQEBMTExcXFxoaGh4eHiAgICEhISQkJCcnJygoKCsrKy8vLzExMbu7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7uyH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAB8ALAAAAAAQABAAAAVb4CeOZGme03lKrBqVUWw+kPg8IlSTTi/2jp+jQSw2Rg2GiLhoOhejpqipqFoVo6qomuh6E6OuqIsomxGjskg9OrhFhvdHPioURHYR4W4alAaAKiQBAgKCJQAjIQA7)
              no-repeat 3px 3px;
}

.scenepic-icon-resetcamera {
  background: url(data:image/gif;base64,R0lGODlhIAAgAIABAAAAAP///yH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAEALAAAAAAgACAAAAJujI+py+0Po2QAzFeztvfsn3Wg90lbc2KhulIt9CbaNS+xUcuVy+l3cIuBcsCd70gy4pRJJOcVZBaXFqhxeN1le8XesJnkWomnFNXH7X7BCOmE2LG54+25Io36oR1mfp+qJ4f1FzFo91ZCp7gYUQAAOw==)
              no-repeat -2px -2px;
}

input.scenepic-volume-slider {
  display: inline;
  width: 125px;
  vertical-align: middle;
}

.scenepic-controls button {
  border: none;
  width: 24px;
  height: 24px;
  vertical-align: middle;
  cursor: pointer;
  border: 1px solid #ddd;
  border-radius: 20px;
}

.scenepic-controls button:focus {
  border: none;
  outline: none;
}

.scenepic-controls button:hover {
  border: 1px solid gray;
}

.scenepic-controls button:active {
  background-color: gray;
}

.scenepic-icon-faster {
  background: url(data:image/gif;base64,R0lGODlhEAAQAIQUAAICAgMDAwYGBgkJCQ0NDRAQEBMTExcXFxoaGh4eHiAgICEhISQkJCcnJygoKCsrKy4uLi8vLzExMTIyMru7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7uyH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAB8ALAAAAAAQABAAAAVb4CeOZGlK0qSipghFcBxB5mPf+EM2Tu+MPkdDxCgaR8ajYsFkjppMxSdBbYmoiQ9ia9VyD+Au+PAxmM+jM7rAbo/a7g9hPh/R66OBfs8fmASAgYFWAQCGhgEkIQA7)
              no-repeat 3px 3px;  
}

.scenepic-icon-slower {
  background: url(data:image/gif;base64,R0lGODlhEAAQAIQUAAICAgMDAwYGBgkJCQ0NDRAQEBMTExcXFxoaGh4eHiAgICEhISQkJCcnJygoKCsrKy4uLi8vLzExMTIyMru7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7uyH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAB8ALAAAAAAQABAAAAVX4CeOZGlK0qSipghFcBxB5mPf+EM2Tu//joaIQSwajx/FYslsMhWfhLQlkiY+iCwVqz14t97Dx0Aum8+fgnrNbosI8Lg8ThrY7/iBScDv96kBAIKCASQhADs=)
              no-repeat 3px 3px;  
}

.scenepic-icon-record {
  background: url(data:image/gif;base64,R0lGODlhIAAgAIQYANoAANwAAN4AAOAAAOIAAOQAAOYAAOgAAOoAAOsAAO0AAO8AAPEAAPMAAPUAAPcAAPgAAPkAAPoAAPsAAPwAAP0AAP4AAP8AALu7u7u7u7u7u7u7u7u7u7u7u7u7u7u7uyH5BAEKAB8ALAAAAAAgACAAAAWZ4CeOZGmeaKqubOu+cCzPrmVd+GXTIlX9wCBlJpkYj0ijJAaJOJ9QKOT1qFqvWKvLwe16v91WY0wum80shnrNbrdZi7h8TqezFPi8fr9nJf6AgYKCLAiGh4iJiSwHjY6PkJAsBpSVlpeXLQWbnJ2enC4EoqOkpaMvA6mqq6wDMQKwsbKyMwG2t7i2PB8Avb69u8HCw8TFxschADs=)
              no-repeat -1px -1px;
  margin-right: 5px;
}

.scenepic-fps {
  position: absolute;
  visibility: hidden;
  left: 5px;
  top: 40px;
  font-family: monospace;
  color: yellow;
  font-size: 14px;  
}

.scenepic-camera-mode {
  position: absolute;
  visibility: hidden;
  left: 5px;
  top: 55px;
  font-family: monospace;
  color: magenta;
  font-size: 14px;
}

`,ys=!1;function Pi(){if(!ys){var e=document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(Jf)),e.appendChild(t),ys=!0}}var Es=Pr(_s()),ks=Pr(As()),Ss="___STATUS___",Li="___LOG___",Cs="___HELP___",Tt=class{constructor(t=null){this.canvasDiv=null;this.allMeshes={};this.textPanels=new Map;this.dropDownMenus=new Map;this.canvases=new Map;this.meshKeyframes={};this.canvasGroups={};this.ws=null;this.playbackRate=1;this.media=[];this.isPlaying=!1;this.frameRate=30;this.timePerFrame=1/30;var r=this;this.objectCache=new Sr(h=>{for(var d in r.canvases){var u=r.canvases[d];u.NotifyTextureUpdated(h)}}),Pi(),this.div=document.createElement("div"),this.div.className="scenepic",t!=null?t.appendChild(this.div):document.body.appendChild(this.div),this.statusDiv=document.createElement("div"),this.statusDiv.classList.add("scenepic"),t==null&&this.statusDiv.classList.add("scenepic-status-bar"),this.statusDivNeedsPadding=t==null,t!=null?t.appendChild(this.statusDiv):document.body.appendChild(this.statusDiv);let i=document.createElement("div");i.className="scenepic-controls",this.recordButton=document.createElement("button"),this.recordButton.classList.add("scenepic-icon-record","scenepic-medium"),this.recordButton.addEventListener("click",()=>this.Record()),this.recordButton.title="Record",this.progressDiv=document.createElement("div"),this.progressBar=document.createElement("span"),this.progressBar.style.width="0%",this.progressDiv.style.visibility="hidden",this.progressDiv.classList.add("scenepic-progress"),this.progressDiv.append(this.progressBar),this.statusDiv.append(this.progressDiv),i.appendChild(this.recordButton);let a=this.createToggleButton("Play/Pause","playpause");a[0].classList.add("scenepic-large"),this.playPauseToggle=a[1],this.playPauseToggle.checked=!1,this.playPauseToggle.addEventListener("change",()=>this.PlayVideo());let n=document.createElement("button");n.className="scenepic-icon-faster",n.addEventListener("click",()=>this.faster()),n.title="Faster";let s=document.createElement("button");s.className="scenepic-icon-slower",s.addEventListener("click",()=>this.slower()),s.title="Slower",i.appendChild(s),i.appendChild(a[0]),i.appendChild(n);let o=document.createElement("button");o.classList.add("scenepic-icon-resetcamera","scenepic-medium"),o.addEventListener("click",()=>this.ResetAllViews()),o.title="Reset Camera",i.appendChild(o);let c=this.createToggleButton("Sound/Mute","soundmute");c[0].style.marginLeft="32px",this.volumeToggle=c[1],this.volumeToggle.addEventListener("change",()=>this.UpdateVolume()),this.volumeSlider=document.createElement("input"),this.volumeSlider.className="scenepic-volume-slider",this.volumeSlider.title="Global Volume",this.volumeSlider.type="range",this.volumeSlider.min="0",this.volumeSlider.max="1",this.volumeSlider.value="1",this.volumeSlider.step="0.01",this.volumeSlider.addEventListener("change",()=>this.UpdateVolume()),i.appendChild(c[0]),i.appendChild(this.volumeSlider),this.statusDiv.append(i),this.AddTextPanel(Cs,"Click for Help","font-size:10pt;",this.statusDiv,!0);var l='<span class="scenepic-textbox-content">';l+="space: play/pause<br>",l+="+/-: adjust play speed<br>",l+="shift: translate<br>",l+="ctrl: twist<br>",l+="alt: slow translation/rotation<br>",l+="tab: toggle between first person/focus cameras<br>",l+="alt+#: toggle visibility of layer #<br>",l+="r: reset view",l+='</span><span class="scenepic-textbox-content">',l+="\\: toggle orbit camera<br>",l+="caps: move focus point (modal)<br>",l+="l: lock camera translation to focus point<br>",l+="o: lock camera orientation to focus point<br>",l+="drag: rotate/translate (focus) swivel (first person)<br>",l+="wasdqe: translate (first person)<br>",l+="wheel: translate camera</span>",this.SetTextPanelValue(Cs,l),this.AddTextPanel(Ss,"Status","",this.statusDiv),this.UpdateStatusPadding()}createToggleButton(t,r){let i=document.createElement("label");i.className="scenepic-toggle-button",i.title=t;let a=document.createElement("input");a.type="checkbox",a.checked=!0;let n=document.createElement("span");return n.className="scenepic-icon-"+r,i.appendChild(a),i.appendChild(n),[i,a]}ResetAllViews(){for(let t in this.canvases){let r=this.canvases[t];r instanceof Ke&&r.ResetView()}}UpdateVolume(){let t;this.volumeToggle.checked&&(t=this.volumeSlider.valueAsNumber);for(let r in this.canvases){let i=this.canvases[r];i.Volume=t}}Record(){this.numFramesPerCanvas={},this.canvasZipFolders={},this.maxFrames=0,this.recordingZip=new ks.default;for(let t in this.canvases){this.canvasZipFolders[t]=this.recordingZip.folder(t);let r=this.canvases[t];r.IsRecording=!0,r.FrameCount>this.maxFrames&&(this.maxFrames=r.FrameCount),this.numFramesPerCanvas[t]=r.FrameCount}this.currentRecordingFrame=0,this.progressBar.style.width="0%",this.progressDiv.style.visibility="visible",this.recordButton.classList.add("is-blinking"),setTimeout(()=>this.recordFrame(),1)}recordFrame(){let t="frame_"+String(this.currentRecordingFrame).padStart(4,"0")+".png",r=!0;for(let a in this.canvases){let n=this.canvases[a];if(n.ShowFrame(this.currentRecordingFrame%this.numFramesPerCanvas[a]),n.DataUrl!=null){let s=V.DataUrlToBlob(n.DataUrl);this.canvasZipFolders[a].file(t,s)}else console.warn("Frame "+this.currentRecordingFrame+" undefined for canvas "+a),r=!1}r&&(this.currentRecordingFrame+=1);let i=100*this.currentRecordingFrame/this.maxFrames;if(this.progressBar.style.width=i+"%",this.currentRecordingFrame==this.maxFrames){let a=new Set;this.recordButton.classList.remove("is-blinking");for(let n in this.canvases){let s=this.canvases[n];s.mediaId!=null&&a.add(s.mediaId),s.IsRecording=!1,s.ShowFrame(0)}for(let n of a){let s=this.objectCache.GetBlob(n);this.recordingZip.file(n+"."+s.type,s)}this.recordingZip.generateAsync({type:"blob"}).then(function(n){let s=document.title.replace(" ","_").toLowerCase()+".zip";(0,Es.saveAs)(n,s)}),this.progressDiv.style.visibility="hidden"}else setTimeout(()=>this.recordFrame(),0)}UpdateStatusPadding(){this.statusDivNeedsPadding&&this.div.setAttribute("style",`padding-bottom:${this.statusDiv.offsetHeight}px;`)}SetStatus(t){var r="";r+="<span class='scenepic-textbox-content'>",r+=t,r+="</span>",this.SetTextPanelValue(Ss,r),this.UpdateStatusPadding()}AddLogMessage(t,r){Li in this.textPanels||this.AddTextPanel(Li,"Log",null,this.statusDiv);var i="";i+="<span class='scenepic-textbox-content'>";var a=new Date;i+=`<span style='font-size:50%; color:grey; vertical-align:middle; display: inline-block; font-family:monospace;'>${a.getFullYear()}-${a.getMonth()}-${a.getDay()} ${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}&nbsp;&nbsp;</span>`,i+=`<span style='color:${r};vertical-align:middle; display: inline-block;'>${t}</span>`,i+="</span><br>",this.SetTextPanelValue(Li,i,!0),this.UpdateStatusPadding()}AddWarning(t){this.AddLogMessage("WARNING: "+t,"red")}ConnectToServer(t){this.SetStatus("Connecting to "+t),this.ws=new WebSocket(t),this.ws.onerror=r=>this.AddWarning("WebSockets connection to "+t+" failed to open!"),this.ws.onmessage=r=>this.MessageReceived(r),this.ws.onopen=r=>{this.AddLogMessage("WebSockets connection to "+t+"opened successfully","green"),this.sceneId!=null&&this.SetSceneId(this.sceneId);for(var i in this.canvases){var a=this.canvases[i];this.ReportFrameIdChange(i,a.GetCurrentFrameId())}},this.ws.onclose=r=>this.AddLogMessage("WebSockets connection to "+t+"closed","orange"),this.SetStatus("done")}MessageReceived(t){var r=new Date().getTime(),i=JSON.parse(t.data),a=new Date().getTime();"AckData"in i&&this.ReportReceived(i.AckData);var n=[];"SceneCommand"in i?n=[i.SceneCommand]:"SceneCommands"in i&&(n=i.SceneCommands),this.ExecuteSceneCommands(n);var s="Unknown",o="Unknown",c=a-r,l=new Date().getTime()-a;if("Timings"in i){var h=i.Timings,d=h[0],u=h[1];s=u-d,o=r-u}this.SetStatus("Updated.  Timings: enc:"+s+"ms, tx:"+o+"ms, dec:"+c+"ms, parse:"+l+"ms")}AddTextPanel(t,r,i,a,n=!1,s=!1){if(t in this.textPanels){this.AddWarning("TextPanel id "+t+" already exists in SPScene");return}this.textPanels[t]=new tr(t,r,i,a??this.div,n,s);let o=this.textPanels[t];var c=this;o.inputBox.oninput=()=>c.ReportInputBoxChange(t,o.inputBox.value),o.header.addEventListener("click",()=>this.UpdateStatusPadding()),this.UpdateStatusPadding()}SetTextPanelValue(t,r,i=!1){t in this.textPanels||this.AddWarning("TextPanel id "+t+" not found. Try AddTextPanel first."),this.textPanels[t].SetContents(r,i),this.UpdateStatusPadding()}SetTextPanelTitle(t,r){t in this.textPanels||this.AddWarning("TextPanel id "+t+" not found. Try AddTextPanel first."),this.textPanels[t].SetTitle(r),this.UpdateStatusPadding()}SetTextPanelInputText(t,r){t in this.textPanels||this.AddWarning("TextPanel id "+t+" not found. Try AddTextPanel first."),this.textPanels[t].SetInputBoxContents(r),this.UpdateStatusPadding()}AddDropDownMenu(t,r,i,a){if(t in this.dropDownMenus){this.AddWarning("DropDownMenu id "+t+" already exists in SPScene");return}this.dropDownMenus[t]=new rr(r,i,a??this.div);var n=this;let s=this.dropDownMenus.get(t);s.dropDownMenu.onchange=()=>n.ReportDropDownMenuChange(t,s.dropDownMenu.selectedIndex),s.header.addEventListener("click",()=>this.UpdateStatusPadding()),this.UpdateStatusPadding()}SetDropDownMenuItems(t,r){t in this.dropDownMenus||this.AddWarning("DropDownMenu id "+t+" not found. Try AddDropDownMenu first."),this.dropDownMenus[t].SetItems(r),this.UpdateStatusPadding()}SetDropDownMenuItemDisabled(t,r,i){t in this.dropDownMenus||this.AddWarning("DropDownMenu id "+t+" not found. Try AddDropDownMenu first."),this.dropDownMenus[t].SetItemDisabled(r,i),this.UpdateStatusPadding()}SetDropDownMenuSelection(t,r){t in this.dropDownMenus||this.AddWarning("DropDownMenu id "+t+" not found. Try AddDropDownMenu first."),this.dropDownMenus[t].SetSelection(r),this.UpdateStatusPadding()}GetParentDOMElement(t){var r=t!=null?document.getElementById(t):null;return r==null&&(this.canvasDiv==null&&(this.canvasDiv=document.createElement("div"),this.canvasDiv.className="scenepic",this.div.appendChild(this.canvasDiv)),r=this.canvasDiv),r}RequestRedraw(){}AddCanvas3D(t,r,i,a){if(t in this.canvases){this.AddWarning("Canvas with id "+t+" already exists in SPScene.");return}var n=new Ke(t,this.frameRate,r,i,this.allMeshes,this.objectCache,s=>this.SetStatus(s),s=>this.AddWarning(s),()=>this.RequestRedraw(),(s,o)=>this.ReportFrameIdChange(s,o),(s,o)=>this.HandleKeyDown(s,o,!1,!1,!1,!1,!0));this.InitializeCanvas(n,t,a,!0)}AddCanvas2D(t,r,i,a){if(t in this.canvases){this.AddWarning("Canvas with id "+t+" already exists in SPScene.");return}var n=new vt(t,this.frameRate,r,i,this.objectCache,s=>this.SetStatus(s),s=>this.AddWarning(s),()=>this.RequestRedraw(),(s,o)=>this.ReportFrameIdChange(s,o));this.InitializeCanvas(n,t,a,!0)}AddGraph(t,r,i,a){if(t in this.canvases){this.AddWarning("Canvas with id "+t+" already exists in SPScene.");return}var n=new er(t,this.frameRate,r,i,this.objectCache,s=>this.SetStatus(s),s=>this.AddWarning(s),()=>this.RequestRedraw(),(s,o)=>this.ReportFrameIdChange(s,o));this.InitializeCanvas(n,t,a,!1)}InitializeCanvas(t,r,i,a){this.canvases[r]=t,t.handlesMouse=a,i.appendChild(t.container);var n=t.htmlCanvas;a&&(n.addEventListener("pointerdown",s=>this.HandlePointerDown(s),!0),n.addEventListener("pointerup",s=>this.HandlePointerUp(s),!0),n.addEventListener("pointermove",s=>this.HandlePointerMove(s),!0),n.addEventListener("pointerout",s=>this.HandlePointerUp(s),!0),n.addEventListener("wheel",s=>this.HandleMouseWheel(s),!0)),n.addEventListener("keydown",s=>{this.HandleKeyDown(r,s.key,s.altKey,s.ctrlKey,s.shiftKey,s.metaKey)||s.preventDefault()},!0),n.addEventListener("keyup",s=>{this.HandleKeyUp(r,s)}),n.addEventListener("mousemove",s=>{s.preventDefault()},!0),n.addEventListener("mousedown",s=>{n.focus(),s.preventDefault()},!0),t.slider.oninput=s=>this.SliderChanged(s),t.slider.onkeydown=s=>{this.HandleKeyDown(r,s.key,s.altKey,s.ctrlKey,s.shiftKey,s.metaKey)||s.preventDefault()},n.focus(),n.setAttribute("SPCanvasId",r),t.slider.setAttribute("SPCanvasId",r),this.canvasGroups[r]={},this.canvasGroups[r][r]=!0}DefineMesh(t,r,i,a,n,s,o){try{var c=Be.Parse(i);c.cameraSpace=a,c.layerId=r,c.doubleSided=n,c.isBillboard=s,c.isLabel=o,this.allMeshes[t]=c}catch(d){this.AddWarning(d)}for(var l in this.canvases){var h=this.canvases[l];h.NotifyMeshUpdated(t)}}UpdateMesh(t,r,i,a,n,s,o,c){let l;if(i instanceof Uint16Array){let f=(o-s)/65535;l=new Float32Array(i.length);let v=this.meshKeyframes[t+n];for(let p=0;p<l.length;++p)l[p]=i[p]*f+s+v[p]}else l=i,this.meshKeyframes[t+a]=l;try{var h=this.allMeshes[t];this.allMeshes[r]=h.Update(l,c)}catch(f){this.AddWarning(f)}for(var d in this.canvases){var u=this.canvases[d];u.NotifyMeshUpdated(r)}}ExecuteSceneCommands(t){if(Array.isArray(t)){for(var r of t)this.ExecuteSceneCommands(r);return}switch("CommandType"in t||this.AddWarning('Expecting "CommandType" in Scene Command object: '+JSON.stringify(t)),t.CommandType){case"ConfigureUserInterface":for(var m in this.canvases){var K=this.canvases[m];K instanceof Ke&&K.ConfigureUserInterface(t)}break;case"SetSceneId":this.SetSceneId(t.SceneId);break;case"SetSceneProperties":this.frameRate=Number(t.FrameRate),this.timePerFrame=1/this.frameRate,this.statusDiv.style.visibility=t.StatusBarVisibility;break;case"DefineMesh":var h=String(t.MeshId),i=V.GetDefault(t,"LayerId",null),a=t.Definition,n=V.GetDefault(t,"CameraSpace",!1),s=V.GetDefault(t,"DoubleSided",!1),o=V.GetDefault(t,"IsBillboard",!1),c=V.GetDefault(t,"IsLabel",!1);this.DefineMesh(h,i,a,n,s,o,c);break;case"UpdateMesh":var l=String(t.BaseMeshId),h=String(t.MeshId),d=t.FrameIndex,u=V.GetDefault(t,"KeyframeIndex",d),f=V.GetDefault(t,"MinValue",0),v=V.GetDefault(t,"MaxValue",0),p=t.UpdateFlags,g;"QuantizedBuffer"in t?g=V.Base64ToUInt16Array(t.QuantizedBuffer):g=V.Base64ToFloat32Array(t.VertexBuffer),this.UpdateMesh(l,h,g,d,u,f,v,p);break;case"DefineImage":var x=String(t.ImageId);"Filename"in t?this.objectCache.DefineImageFromFile(x,t.Filename):this.objectCache.DefineImageFromBase64(x,t.Type,t.Data);break;case"DefineVideo":var A=document.createElement("video");A.preload="auto",A.loop=!0;var _=String(t.VideoId);this.media.push(A),this.objectCache.DefineVideoFromBase64(_,A,t.Type,t.Data);break;case"DefineAudioTrack":var E=document.createElement("audio");E.preload="auto",E.loop=!0;var S=String(t.AudioId);this.media.push(E),this.objectCache.DefineAudioTrackFromBase64(S,E,t.Type,t.Data);break;case"DefineLabel":var M=String(t.LabelId),ce=String(t.Text),k=String(t.FillStyle),R=String(t.FontFamily),O=Number(t.FontSizePx),y=Number(t.HorizontalAlign),T=Number(t.VerticalAlign),b=Number(t.OffsetDistance);this.objectCache.DefineLabel(M,ce,k,R,O,y,T,b);break;case"AddCanvas3D":var m=String(t.CanvasId),I=Number(t.Width),G=Number(t.Height),fe=V.GetDefault(t,"HtmlId",null),ae=this.GetParentDOMElement(fe);this.AddCanvas3D(m,I,G,ae);break;case"AddCanvas2D":var m=String(t.CanvasId),I=Number(t.Width),G=Number(t.Height),fe=V.GetDefault(t,"HtmlId",null),ae=this.GetParentDOMElement(fe);this.AddCanvas2D(m,I,G,ae);break;case"AddGraph":var m=String(t.CanvasId),I=Number(t.Width),G=Number(t.Height),fe=V.GetDefault(t,"HtmlId",null),ae=this.GetParentDOMElement(fe);this.AddGraph(m,I,G,ae);break;case"CanvasCommands":var m=String(t.CanvasId);m in this.canvases?this.canvases[m].ExecuteCanvasCommands(t.Commands):this.AddWarning("CanvasId "+m+" not found. Try AddCanvas first.");break;case"LinkCanvasEvents":var z=t.CanvasIds;this.LinkCanvasEvents(z);break;case"AddTextPanel":var Z=String(t.TextPanelId),fe=V.GetDefault(t,"HtmlId",null),$=V.GetDefault(t,"AddInputBox",!1),ae=this.GetParentDOMElement(fe);this.AddTextPanel(Z,"","",ae,!1,$);break;case"DefineGrid":var U=String(t.Width),Q=String(t.GridTemplateRows),L=String(t.GridTemplateColumns);this.canvasDiv.style.display="grid",this.canvasDiv.style.width=U,this.canvasDiv.style.gridTemplateRows=Q,this.canvasDiv.style.gridTemplateColumns=L;break;case"PlaceCanvasInGrid":var m=String(t.CanvasId),D=String(t.GridRow),ee=String(t.GridColumn),K=this.canvases[m];K.container.style.gridRow=D,K.container.style.gridColumn=ee;break;case"SetTextPanelValue":var Z=String(t.TextPanelId),ce=String(t.Value);this.SetTextPanelValue(Z,ce);break;case"SetTextPanelTitle":var Z=String(t.TextPanelId),ce=String(t.Value);this.SetTextPanelTitle(Z,ce);break;case"SetTextPanelInputText":var Z=String(t.TextPanelId),ce=String(t.Value);this.SetTextPanelInputText(Z,ce);break;case"AddDropDownMenu":var ye=String(t.DropDownMenuId),fe=V.GetDefault(t,"HtmlId",null),ne=String(t.Title),ae=this.GetParentDOMElement(fe);this.AddDropDownMenu(ye,ne,"",ae);break;case"SetDropDownMenuItems":var ye=String(t.DropDownMenuId),be=t.Items.map(W=>String(W));this.SetDropDownMenuItems(ye,be);break;case"SetDropDownMenuItemDisabled":var ye=String(t.DropDownMenuId),Ae=Number(t.Index),pe=!!t.Disabled;this.SetDropDownMenuItemDisabled(ye,Ae,pe);break;case"SetDropDownMenuSelection":var ye=String(t.DropDownMenuId),Ae=Number(t.Index);this.SetDropDownMenuSelection(ye,Ae);break;case"SimulateKeyPress":var m=String(t.CanvasId),N=String(t.Key),F=V.GetDefault(t,"Alt",!1),C=V.GetDefault(t,"Ctrl",!1),w=V.GetDefault(t,"Shift",!1),P=V.GetDefault(t,"Meta",!1);this.HandleKeyDown(m,N,F,C,w,P,!1);break;case"ConnectToServer":var H=String(t.URL);this.ConnectToServer(H);break;case"ShutDown":setTimeout(this.ShutDown,0);break;case"NoOp":break;default:this.AddWarning("Unknown Scene CommandType "+t.CommandType+" in object: "+JSON.stringify(t));break}}ShutDown(){for(var t=document.body.children,r=0;r<t.length;++r)document.body.removeChild(t[r]);document.write("Session closed.  Window closing..."),close()}LoadScripts(t){var r=(a,n,s,o)=>{var c=document.createElement("script");c.id=a,c.setAttribute("type","text/javascript"),c.src=n,c.onload=s,c.onerror=o,document.body.appendChild(c)},i=a=>{if(a>=t.length){this.SetStatus("done");return}var n="__loaded-script-"+a.toString()+"__",s=l=>{var h=window.ScriptCommands;h!=null&&this.ExecuteSceneCommands(h);var d=document.getElementById(n);d.remove(),i(a+1)},o=t[a],c=()=>this.AddWarning("Failed to load "+o);this.SetStatus("Loading file "+o+"..."),r(n,o,s,c)};i(0)}SetSceneId(t){this.sceneId=t,this.ReportSceneIdChange(),this.SetStatus("SceneId: "+this.sceneId)}LinkCanvasEvents(t){for(var r=0;r<t.length;r++)for(var i=this.canvasGroups[t[r]],a=0;a<t.length;a++){var n=t[a];n in i||(i[n]=!0)}}GetEventCanvasId(t){return t.target.getAttribute("SPCanvasId")}GetTargetCanvases(t){if(t==null)return null;let r=this.canvasGroups[t],i=Object.keys(r),a=this.canvases[t];return a instanceof Ke?i.map(n=>this.canvases[n]).filter(n=>n instanceof Ke).map(n=>n):a instanceof vt?i.map(n=>this.canvases[n]).filter(n=>n instanceof vt).map(n=>n):null}ReportReceived(t){if(this.ws!=null&&this.ws.readyState==WebSocket.OPEN){var r={Type:"AcknowledgeCommand",AckData:t};this.ws.send(JSON.stringify(r))}}ReportSceneIdChange(){if(this.ws!=null&&this.ws.readyState==WebSocket.OPEN&&this.sceneId!=null){var t={Type:"SceneIdChange",SceneId:this.sceneId};this.ws.send(JSON.stringify(t))}}ReportKeyPress(t,r,i,a,n,s,o){if(this.ws!=null&&this.ws.readyState==WebSocket.OPEN){var c={Type:"KeyPress",Key:t,Alt:r,Ctrl:i,Shift:a,Meta:n,CanvasId:s};o!=null&&(c.FrameId=o),this.ws.send(JSON.stringify(c))}}ReportInputBoxChange(t,r){if(this.ws!=null&&this.ws.readyState==WebSocket.OPEN){var i={Type:"InputBoxChange",TextPanelId:t,Value:r};this.ws.send(JSON.stringify(i))}}ReportDropDownMenuChange(t,r){if(this.ws!=null&&this.ws.readyState==WebSocket.OPEN){var i={Type:"DropDownMenuChange",DropDownMenuId:t,Index:r};this.ws.send(JSON.stringify(i))}}ReportFrameIdChange(t,r){if(this.ws!=null&&this.ws.readyState==WebSocket.OPEN){var i={Type:"FrameIdChange",CanvasId:t,FrameId:r};this.ws.send(JSON.stringify(i))}}HandleKeyUp(t,r){let i=this.GetTargetCanvases(t);i?.forEach(a=>a.HandleKeyUp(r.key))}HandleKeyDown(t,r,i,a,n,s,o=!0){var c=!0,l=this.GetTargetCanvases(t);if(l==null)return;var h=!1,d=new Date().getTime();let u=!1;if(!i&&!a&&!n&&!s){switch(r){case" ":this.playPauseToggle.checked=!this.playPauseToggle.checked,this.PlayVideo(),c=!1;break;case"-":case"_":this.slower();break;case"=":case"+":this.faster();break;case"Tab":u=!0;break}for(var f of l){u&&(f.FirstPerson=!f.FirstPerson);var v=f.HandleKeyDown(r),p=v[0],g=v[1];g&&(h=!0),p&&(c=!1)}}if(i){let _=Number.parseInt(r);for(var f of l)f.ToggleLayerFilled(_)}if(h){var x=new Date().getTime()-d;this.SetStatus("Updated.  Timings: "+x+"ms")}if(o){var f=this.canvases[t],A=f.GetCurrentFrameId();this.ReportKeyPress(r,i,a,n,s,t,A)}return c}updatePlaybackRate(){for(let t in this.canvases){let r=this.canvases[t];r.PlaybackRate=this.playbackRate}}faster(){this.playbackRate=Math.min(2,this.playbackRate*1.2),this.updatePlaybackRate()}slower(){this.playbackRate=Math.max(.03,this.playbackRate/1.2),this.updatePlaybackRate()}PlayVideo(){if(this.playPauseToggle.checked){for(var t in this.canvases)this.canvases[t].StartPlaying();this.isPlaying=!0,this.media.length>1&&this.sync(0)}else{this.isPlaying=!1;for(var t in this.canvases)this.canvases[t].StopPlaying()}}sync(t){let r=this.media[t],i=r.currentTime;for(let a of this.media)a!=r&&(Math.abs(a.currentTime-i)<this.timePerFrame||a.readyState===4&&(a.currentTime=i));this.isPlaying&&requestAnimationFrame(()=>this.sync(t))}SliderChanged(t){var r=t.target,i=r.valueAsNumber,a=this.GetTargetCanvases(this.GetEventCanvasId(t));a?.forEach(n=>n.ShowFrame(i))}HandlePointerDown(t){var r=this.GetEventCanvasId(t),i=this.GetTargetCanvases(r);if(i==null)return;var a=this.canvases[r],n=a.htmlCanvas.getBoundingClientRect();let s=re.fromValues(t.clientX-n.left,t.clientY-n.top);i.forEach(o=>o.HandlePointerDown(s,t)),this.HandlePointerMove(t)}HandlePointerUp(t){var r=this.GetTargetCanvases(this.GetEventCanvasId(t));r?.forEach(i=>i.HandlePointerUp(t))}HandlePointerMove(t){let r=this.GetEventCanvasId(t),i=this.GetTargetCanvases(r);if(i==null)return;let a=this.canvases[r],n=a.htmlCanvas.getBoundingClientRect(),s=re.fromValues(t.clientX-n.left,t.clientY-n.top),o=t.ctrlKey?a.ComputeCameraTwist(s,t):0;i.forEach(c=>c.HandlePointerMoveWithTwist(s,o,t)),t.preventDefault()}HandleMouseWheel(t){var r=this.GetTargetCanvases(this.GetEventCanvasId(t));r!=null&&(r.forEach(i=>i.HandleMouseWheel(t)),t.preventDefault())}};function Ms(e,t,r=100){let i=null;e!=null?(i=document.getElementById(e),i==null?(console.warn(e+" does not exist in the DOM, retrying"),setTimeout(()=>{Ms(e,t,r*2)},r)):new Tt(i).ExecuteSceneCommands(t)):new Tt().ExecuteSceneCommands(t)}window.scenepic=Ms;})();
/*! Bundled license information:

jszip/dist/jszip.min.js:
  (*!
  
  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>
  
  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.
  
  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  *)
*/
//# sourceMappingURL=scenepic.min.js.map
